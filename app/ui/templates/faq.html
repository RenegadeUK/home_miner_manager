{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Frequently Asked Questions</h2>
    </div>
    
    <!-- Search Bar -->
    <div class="faq-search">
        <label for="faq-search" class="sr-only">Search FAQ</label>
        <input type="text" id="faq-search" placeholder="üîç Search FAQ..." class="search-input" aria-label="Search frequently asked questions">
        <button onclick="clearSearch()" class="btn btn-sm btn-secondary" style="margin-left: 0.5rem;" aria-label="Clear search">Clear</button>
    </div>
    
    <!-- Quick Links -->
    <div class="faq-quick-links">
        <button onclick="expandAll()" class="btn btn-sm btn-primary" aria-label="Expand all FAQ sections">Expand All</button>
        <button onclick="collapseAll()" class="btn btn-sm btn-secondary" aria-label="Collapse all FAQ sections">Collapse All</button>
    </div>
    
    <div class="faq-container">
        
        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> General
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>What miners are supported?</h4>
                <p>The platform supports:</p>
                <ul>
                    <li><strong>Avalon Nano 3/3S</strong> - via cgminer TCP API (port 4028)</li>
                    <li><strong>Bitaxe 601</strong> - via REST API</li>
                    <li><strong>NerdQaxe++</strong> - via REST API</li>
                    <li><strong>NMMiner ESP32</strong> - via UDP telemetry broadcasts (port 12345)</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>How do I add a new miner?</h4>
                <p>Navigate to <strong>Miners ‚Üí Add Miner</strong>, select the miner type, enter the IP address, and configure any type-specific settings. The system will automatically detect available modes and capabilities.</p>
            </div>

            <div class="faq-item">
                <h4>Can I switch mining modes remotely?</h4>
                <p>Yes! For Avalon Nano (low/med/high), Bitaxe (eco/standard/turbo/oc), and NerdQaxe++ miners, you can change operating modes from the miner detail page. NMMiner ESP32 devices have limited remote configuration.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Pool Management
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>How do I set up logical pools?</h4>
                <p>Go to <strong>Pools ‚Üí Add Pool</strong> and create your pool configurations. Each pool needs a URL, port, username (wallet address), and password. You can then assign these pools to miners individually.</p>
            </div>

            <div class="faq-item">
                <h4>What's the difference between logical pools and physical pool slots?</h4>
                <p>Logical pools are stored in the system and can be assigned to any miner. Physical pools are the actual pool configurations stored on the miner hardware (e.g., Avalon has 3 slots, NMMiner has 2). The system maps your logical pools to these physical slots when applying configurations.</p>
            </div>

            <div class="faq-item">
                <h4>How does pool health monitoring work?</h4>
                <p>The system checks each enabled pool every 5 minutes by:</p>
                <ul>
                    <li><strong>Connectivity Test</strong> - TCP connection to pool URL/port with 5-second timeout</li>
                    <li><strong>Response Time</strong> - Measures connection latency in milliseconds</li>
                    <li><strong>Reject Rate</strong> - Calculates percentage of rejected shares from all miners using this pool</li>
                </ul>
                <p>Each pool receives a <strong>Health Score</strong> (0-100) based on: <strong>Reachability (40pts)</strong>, <strong>Response Time (30pts)</strong> &lt;50ms=30pts, 50-150ms=20pts, 150-300ms=10pts, &gt;300ms=0pts, and <strong>Reject Rate (30pts)</strong> &lt;1%=30pts, 1-3%=20pts, 3-5%=10pts, &gt;5%=0pts. Recent failures apply -10pt penalties.</p>
            </div>

            <div class="faq-item">
                <h4>What is intelligent pool failover?</h4>
                <p>Intelligent failover automatically switches miners to healthier pools when problems are detected. The system triggers failover when:</p>
                <ul>
                    <li>Pool is <strong>unreachable</strong> for 2+ consecutive checks (10+ minutes)</li>
                    <li>Pool <strong>health score &lt;30</strong> for 3+ consecutive checks (15+ minutes)</li>
                    <li>Pool <strong>reject rate &gt;10%</strong> for 3+ consecutive checks</li>
                </ul>
                <p>When triggered, the system finds the best alternative pool by scoring all other enabled pools (health_score - failures*5), requiring health &gt;70 and current reachability. If a suitable pool is found, the miner automatically switches with event logging.</p>
            </div>

            <div class="faq-item">
                <h4>How do I enable/disable automatic failover?</h4>
                <p>Go to <strong>Pools ‚Üí Pool Health</strong> and use the toggle switch. Automatic failover is <strong>enabled by default</strong>. When disabled, you can still trigger manual failovers from the Pool Health page or miner detail pages. Health monitoring continues even when failover is disabled.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Automation Rules
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>How do automation rules work?</h4>
                <p>Rules evaluate every 60 seconds and trigger actions when conditions are met. You can create rules based on energy pricing, time windows, miner status, or pool failures.</p>
            </div>

            <div class="faq-item">
                <h4>Can I duplicate an existing rule?</h4>
                <p>Yes! Click the <strong>Duplicate</strong> button next to any rule. The copy will open in edit mode with "(Copy)" appended to the name, and will be disabled by default so you can adjust it before enabling.</p>
            </div>

            <div class="faq-item">
                <h4>What automation triggers are available?</h4>
                <p>Currently supported triggers:</p>
                <ul>
                    <li><strong>Price threshold</strong> - when energy price goes above/below a value</li>
                    <li><strong>Time window</strong> - during specific hours</li>
                    <li><strong>Miner status</strong> - when a miner goes offline or overheats</li>
                    <li><strong>Pool failure</strong> - when pool becomes unreachable</li>
                </ul>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Energy Pricing (Octopus Agile)
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>Do I need an Octopus Agile API key?</h4>
                <p>No! The system uses the public Octopus Agile tariff API which doesn't require authentication. Just select your region (A-P) in Settings ‚Üí Energy Pricing.</p>
            </div>

            <div class="faq-item">
                <h4>How often are energy prices updated?</h4>
                <p>Prices are fetched every 30 minutes automatically. The system retrieves the next 48 hours of pricing data when available (usually published by 4pm each day).</p>
            </div>

            <div class="faq-item">
                <h4>Can I automate miners based on electricity price?</h4>
                <p>Absolutely! Create an automation rule with a price threshold trigger. For example: "Turn off miners when price exceeds 20p/kWh" or "Switch to low power mode during expensive periods".</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Pool Integrations
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>What is Solopool integration?</h4>
                <p>The system can display statistics from <strong>solopool.org</strong> for Bitcoin (BTC), Bitcoin Cash (BCH), and DigiByte (DGB) solo mining. It shows current round luck, workers online, recent blocks, and total paid amounts with GBP conversions.</p>
            </div>

            <div class="faq-item">
                <h4>How do I enable Braiins Pool stats?</h4>
                <p>Go to <strong>Settings ‚Üí Braiins Pool</strong>, enable the integration, and enter your API token (available from your Braiins Pool account settings). The dashboard will then display your workers, hashrate, and rewards.</p>
            </div>

            <div class="faq-item">
                <h4>Do pool integrations require my miners to be managed here?</h4>
                <p>No! The pool statistics are fetched directly from the pool APIs using your wallet address or API token. Your miners can be mining to these pools from anywhere.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Cryptocurrency Prices
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>Where do the GBP price conversions come from?</h4>
                <p>The system uses a multi-API fallback strategy, trying <strong>CoinGecko</strong> first, then <strong>CoinCap</strong>, then <strong>Binance</strong>. This ensures prices are available even if one API is rate-limited or offline.</p>
            </div>

            <div class="faq-item">
                <h4>How often are crypto prices updated?</h4>
                <p>Prices are cached and updated every <strong>10 minutes</strong> to avoid rate limits. The colored dot next to each price indicates freshness:</p>
                <ul>
                    <li><strong>Green <span style="color: #28a745;">‚óè</span></strong> - Fresh data (under 30 minutes old)</li>
                    <li><strong>Amber <span style="color: #ffc107;">‚óè</span></strong> - Aging data (30 mins - 2 hours)</li>
                    <li><strong>Red <span style="color: #dc3545;">‚óè</span></strong> - Stale data (over 2 hours old)</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>Why don't I see GBP conversions?</h4>
                <p>If conversions aren't showing, check the <strong>Logs</strong> page for API errors. The system will log any failures from CoinGecko, CoinCap, or Binance. Cache indicators will turn red if prices haven't updated in over 2 hours.</p>
            </div>

            <div class="faq-item">
                <h4>What's the price ticker in the header?</h4>
                <p>The top-right corner displays current prices for all active coins (BTC, BCH, DGB) with cache age indicators. It refreshes every 30 seconds and is hidden on mobile devices to save space.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Telemetry & Monitoring
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>How often is telemetry collected?</h4>
                <p>Standard miners (Avalon, Bitaxe, NerdQaxe++) are polled every <strong>30 seconds</strong>. NMMiner ESP32 devices broadcast their telemetry autonomously via UDP every few seconds.</p>
            </div>

            <div class="faq-item">
                <h4>How long is telemetry data stored?</h4>
                <p>Telemetry older than <strong>48 hours</strong> is automatically purged to keep the database lean. The purge task runs every 6 hours.</p>
            </div>

            <div class="faq-item">
                <h4>What do the log event colors mean?</h4>
                <p>Event badges use color coding:</p>
                <ul>
                    <li><strong>Red</strong> - Errors (connection failures, API errors)</li>
                    <li><strong>Amber</strong> - Warnings (rate limits, timeouts)</li>
                    <li><strong>Blue</strong> - Informational events</li>
                    <li><strong>Green</strong> - Success/normal operations</li>
                </ul>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> NMMiner ESP32 Specifics
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>How does NMMiner configuration work?</h4>
                <p>NMMiner uses UDP broadcasts for both telemetry (port 12345) and configuration (port 12347). To update pool settings, the system sends a JSON config packet to all devices or a specific IP.</p>
            </div>

            <div class="faq-item">
                <h4>Can I configure multiple NMMiner devices at once?</h4>
                <p>Yes! Using IP address <strong>0.0.0.0</strong> sends the configuration to all NMMiner devices on the network simultaneously.</p>
            </div>

            <div class="faq-item">
                <h4>Why can't I change NMMiner power settings?</h4>
                <p>NMMiner ESP32 devices don't expose power metrics or tuning controls via their UDP protocol. They're "lottery miners" optimized for low power consumption and don't support mode switching like other miner types.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Docker & Configuration
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>Where is my data stored?</h4>
                <p>All persistent data lives in the <strong>/config</strong> volume mount:</p>
                <ul>
                    <li><strong>config.yaml</strong> - Application settings</li>
                    <li><strong>data.db</strong> - SQLite database (miners, pools, telemetry, events)</li>
                    <li><strong>logs/</strong> - Application log files</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>What environment variables are supported?</h4>
                <p>The container accepts:</p>
                <ul>
                    <li><strong>WEB_PORT</strong> - HTTP port (default: 8080)</li>
                    <li><strong>TZ</strong> - Timezone (e.g., Europe/London)</li>
                    <li><strong>PUID/PGID</strong> - User/group ID for file permissions</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>How do I backup my configuration?</h4>
                <p>Simply backup the <strong>/config</strong> directory. The data.db file contains all your miners, pools, automation rules, and historical telemetry.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Energy Optimization
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>What are the price thresholds and why were they chosen?</h4>
                <p>The system uses a <strong>15p/kWh default threshold</strong> for auto-optimization decisions, based on UK electricity pricing patterns:</p>
                <ul>
                    <li><strong>Off-Peak (5-12p)</strong> - Typically 11pm-7am, windiest periods, cheapest rates</li>
                    <li><strong>Normal (12-18p)</strong> - Mid-day and evening shoulder periods</li>
                    <li><strong>Peak (20-35p+)</strong> - 4-7pm weekdays, highest demand, most expensive</li>
                </ul>
                <p>For small ASIC miners (100-600W), mining becomes unprofitable above 20-25p/kWh due to energy costs exceeding potential rewards. The 15p threshold is a middle ground that:</p>
                <ul>
                    <li>Catches expensive periods (>15p) before they become deeply unprofitable</li>
                    <li>Allows mining during moderate pricing (10-15p) when still marginally profitable</li>
                    <li>Maximizes mining time during genuinely cheap periods (<10p)</li>
                </ul>
                <p>The visual color coding uses different thresholds for awareness:</p>
                <ul>
                    <li><strong>Green (<10p)</strong> - Definitely mine, excellent profitability</li>
                    <li><strong>Amber (10-25p)</strong> - Profitable but watch closely</li>
                    <li><strong>Red (>25p)</strong> - Barely profitable, consider stopping</li>
                </ul>
                <p><em>You can customize the action threshold (default 15p) in Energy Optimization settings to match your strategy.</em></p>
            </div>

            <div class="faq-item">
                <h4>What's the difference between Auto-Optimization and Automation Rules?</h4>
                <p><strong>Auto-Optimization</strong> is a simple, hands-off feature that checks energy prices every 30 minutes and automatically switches miner modes (high power when cheap, low power when expensive). It's designed for simplicity with a single configurable threshold.</p>
                <p><strong>Automation Rules</strong> are more advanced and flexible, allowing complex conditions (time windows, miner status, pool failures) and multiple actions (mode changes, pool switching, notifications). You can create sophisticated strategies with multiple rules.</p>
                <p><strong>Important:</strong> To prevent conflicts, you cannot enable Auto-Optimization if you have any enabled automation rules with price-based triggers. The system will warn you and require disabling those rules first.</p>
            </div>

            <div class="faq-item">
                <h4>How does auto-optimization decide when to switch modes?</h4>
                <p>Every 30 minutes, the system:</p>
                <ol>
                    <li>Fetches the current Octopus Agile price for your region</li>
                    <li>Compares it to your configured threshold (default 15p/kWh)</li>
                    <li>If price is <strong>below threshold</strong>: Switches to high power mode (Avalon high, Bitaxe turbo, NerdQaxe turbo)</li>
                    <li>If price is <strong>above threshold</strong>: Switches to low power mode (Avalon low, Bitaxe eco, NerdQaxe eco)</li>
                    <li>Only applies changes if the miner is not already in the target mode</li>
                </ol>
                <p>The system logs each mode change with the price context so you can track behavior.</p>
            </div>

            <div class="faq-item">
                <h4>Can I use auto-optimization with NMMiner devices?</h4>
                <p>No. NMMiner ESP32 devices are "lottery miners" with fixed low power consumption and no mode switching capabilities. Auto-optimization only works with Avalon Nano, Bitaxe, and NerdQaxe++ miners that support different power modes.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Pool Strategies
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>What are pool strategies and when should I use them?</h4>
                <p>Pool strategies automate how your miners are distributed across multiple pools. There are two types:</p>
                <ul>
                    <li><strong>Round Robin</strong> - All miners rotate through pools at fixed intervals (e.g., every 60 minutes). Best for solo mining rotation, equal distribution over time, or comparing pool performance.</li>
                    <li><strong>Load Balance</strong> - Miners are intelligently distributed across pools based on health scores, latency, and reject rates. Best for maximizing efficiency, ensuring reliability, and prioritizing specific pools.</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>Can I run multiple strategies at once?</h4>
                <p>Yes! You can enable multiple strategies simultaneously. Each strategy can be assigned to specific miners, allowing you to run different strategies for different groups of miners. However, each individual miner can only be assigned to one strategy at a time to prevent conflicts.</p>
            </div>

            <div class="faq-item">
                <h4>How do I assign miners to a strategy?</h4>
                <p>When creating or editing a strategy, you'll see a <strong>Miner Selection</strong> section. Check the boxes for the miners you want to include in that strategy. If you leave all unchecked, the strategy will apply to all miners that aren't assigned to other enabled strategies.</p>
            </div>

            <div class="faq-item">
                <h4>What happens if I try to assign a miner to two strategies?</h4>
                <p>The system will prevent this with an error message. If you want to move a miner from one strategy to another, you need to either: 1) Edit the first strategy and remove that miner, or 2) Disable the first strategy, then assign the miner to the new strategy.</p>
            </div>

            <div class="faq-item">
                <h4>Why do I only see certain pools when creating a strategy?</h4>
                <p>If you have <strong>Avalon Nano miners</strong>, the pool list is filtered to show only pools configured in their 3 physical pool slots. Avalon Nanos can only switch between their pre-configured slots (unlike Bitaxe/NerdQaxe which can switch to any pool). The system syncs these pool slots automatically every 15 minutes and on startup.</p>
            </div>

            <div class="faq-item">
                <h4>How do I execute a strategy immediately?</h4>
                <p>On the Pool Strategies page, click <strong>"Execute Now"</strong> next to any enabled strategy. This triggers an immediate pool switch based on the strategy's rules without waiting for the next scheduled check (which runs every minute).</p>
            </div>

            <div class="faq-item">
                <h4>What happens if a strategy tries to switch to an unhealthy pool?</h4>
                <p>Load Balance strategies automatically avoid pools with low health scores (&lt;70). Round Robin strategies will attempt the switch regardless, but if intelligent failover is enabled, miners will be moved to healthier pools within minutes.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Network Discovery
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>How does network discovery work?</h4>
                <p>Network discovery automatically scans your local network for compatible miners. It checks each IP in the specified range for:</p>
                <ul>
                    <li><strong>Avalon Nano</strong> - Tests for cgminer API on port 4028</li>
                    <li><strong>Bitaxe/NerdQaxe</strong> - Tests for REST API endpoints (system/info)</li>
                </ul>
                <p>NMMiner devices are discovered via UDP broadcasts, not network scanning.</p>
            </div>

            <div class="faq-item">
                <h4>How do I set up automatic discovery?</h4>
                <p>Go to <strong>Settings ‚Üí Discovery</strong> to configure:</p>
                <ul>
                    <li><strong>Network ranges</strong> - Add CIDR notation networks (e.g., 192.168.1.0/24)</li>
                    <li><strong>Auto-add toggle</strong> - Automatically add discovered miners to your managed list</li>
                    <li><strong>Scan interval</strong> - How often to scan (1-168 hours, default 24 hours)</li>
                </ul>
                <p>You can also trigger manual scans per network at any time.</p>
            </div>

            <div class="faq-item">
                <h4>Will discovery find miners on different subnets?</h4>
                <p>Only if those subnets are reachable from the Docker container and you've configured those network ranges. Discovery cannot cross network boundaries that the container can't route to.</p>
            </div>

            <div class="faq-item">
                <h4>How long does a network scan take?</h4>
                <p>Scan time depends on the network size. A /24 network (254 addresses) typically takes 2-5 minutes. The system uses concurrent requests with timeouts to speed up scanning.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Overclocking & Profiles
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>What are overclocking profiles?</h4>
                <p>Profiles save custom tuning settings (frequency, voltage, mode) for miners that support advanced tuning. You can create, save, and apply profiles to quickly switch between different performance configurations.</p>
            </div>

            <div class="faq-item">
                <h4>Which miners support overclocking profiles?</h4>
                <ul>
                    <li><strong>Avalon Nano</strong> - Mode selection (low/med/high), voltage tuning via config</li>
                    <li><strong>Bitaxe</strong> - Frequency, voltage, mode (eco/standard/turbo/oc)</li>
                    <li><strong>NerdQaxe++</strong> - Frequency, voltage, mode tuning</li>
                    <li><strong>NMMiner</strong> - Not supported (fixed configuration)</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>Can I apply a profile to multiple miners at once?</h4>
                <p>Yes! On the Miners page, use the checkboxes to select multiple miners, then choose <strong>"Apply Profile"</strong> from the bulk actions menu. The profile will be applied to all compatible selected miners.</p>
            </div>

            <div class="faq-item">
                <h4>What firmware versions are displayed?</h4>
                <p>The system tracks firmware versions from miner telemetry when available. This information is shown on the miner detail pages and helps you know which miners might need updates.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Performance Analytics
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>What is the health score?</h4>
                <p>Each miner gets a health score (0-100) calculated from:</p>
                <ul>
                    <li><strong>Uptime (25pts)</strong> - Based on last seen timestamp</li>
                    <li><strong>Temperature (30pts)</strong> - 95¬∞C threshold for Avalon Nano, 75¬∞C for others</li>
                    <li><strong>Reject Rate (25pts)</strong> - Lower is better (&lt;2% ideal)</li>
                    <li><strong>Hashrate Stability (20pts)</strong> - Consistency over time</li>
                </ul>
                <p>Scores above 80 are excellent (green), 60-80 are good (amber), below 60 need attention (red).</p>
            </div>

            <div class="faq-item">
                <h4>How do I compare miner performance?</h4>
                <p>Go to <strong>Analytics ‚Üí Performance</strong> to see comparative charts showing all miners' hashrates, temperatures, power consumption, and efficiency side-by-side. You can switch between day/week/month views and export data as CSV.</p>
            </div>

            <div class="faq-item">
                <h4>Why do hashrate units differ between charts?</h4>
                <p>Each miner displays its natural hashrate unit (GH/s for Avalon Nano, TH/s for Bitaxe). The analytics page shows each miner independently to avoid confusing unit conversions. This gives you accurate, miner-appropriate metrics.</p>
            </div>

            <div class="faq-item">
                <h4>How is energy consumption calculated?</h4>
                <p>Total kWh is calculated by integrating power usage (watts) over the selected time range. The formula: <code>kWh = (average_watts √ó hours) / 1000</code>. This appears on the per-miner analytics pages and updates based on your selected timeframe (6h/24h/3d/7d).</p>
            </div>

            <div class="faq-item">
                <h4>What are hardware health predictions?</h4>
                <p>The prediction system uses statistical analysis of historical telemetry trends to forecast potential issues:</p>
                <ul>
                    <li><strong>Temperature issues</strong> - Rising temperature trends</li>
                    <li><strong>Hashrate decline</strong> - Gradual performance degradation</li>
                    <li><strong>Power anomalies</strong> - Unusual power consumption patterns</li>
                    <li><strong>Reject rate problems</strong> - Increasing share rejections</li>
                    <li><strong>Disconnection patterns</strong> - Frequent offline events</li>
                </ul>
                <p>Predictions are shown on the dashboard and miner detail pages when available (requires 7+ days of data).</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Bulk Operations
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>What bulk operations are available?</h4>
                <p>From the Miners page, select multiple miners with checkboxes and perform:</p>
                <ul>
                    <li><strong>Enable/Disable</strong> - Start or stop telemetry collection</li>
                    <li><strong>Set Mode</strong> - Change power mode (low/med/high or eco/standard/turbo)</li>
                    <li><strong>Switch Pool</strong> - Move all miners to a specific pool</li>
                    <li><strong>Restart</strong> - Reboot selected miners</li>
                    <li><strong>Apply Profile</strong> - Apply saved overclocking profile</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>Can I bulk-operate on different miner types?</h4>
                <p>Yes, but mode-specific actions only apply to compatible miners. For example, setting "turbo" mode will work on Bitaxe/NerdQaxe but be ignored by Avalon Nano (which uses low/med/high). The system handles type differences automatically.</p>
            </div>

            <div class="faq-item">
                <h4>Are bulk operations applied immediately?</h4>
                <p>Yes! Bulk operations execute immediately on all selected miners. You'll see a summary of successes and failures. Large operations (10+ miners) may take several seconds to complete.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Notifications & Alerts
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>What notification channels are supported?</h4>
                <p>The system can send alerts via:</p>
                <ul>
                    <li><strong>Telegram</strong> - Bot API integration (requires bot token and chat ID)</li>
                    <li><strong>Discord</strong> - Webhook integration (requires webhook URL)</li>
                </ul>
                <p>Configure channels at <strong>Notifications ‚Üí Setup</strong>.</p>
            </div>

            <div class="faq-item">
                <h4>What alert types are available?</h4>
                <p>You can receive notifications for:</p>
                <ul>
                    <li><strong>Miner Offline</strong> - When a miner becomes unreachable</li>
                    <li><strong>High Temperature</strong> - When temperature exceeds thresholds</li>
                    <li><strong>High Reject Rate</strong> - When share rejections spike</li>
                    <li><strong>Pool Failure</strong> - When a pool becomes unhealthy</li>
                    <li><strong>Low Hashrate</strong> - When hashrate drops significantly</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>How often are alerts checked?</h4>
                <p>The alert system runs every <strong>5 minutes</strong>, checking all enabled alert configurations against current miner/pool status. Alerts respect cooldown periods to avoid spam (e.g., won't re-alert for the same miner offline within 30 minutes).</p>
            </div>

            <div class="faq-item">
                <h4>Can I test notifications before enabling them?</h4>
                <p>Yes! Each notification channel has a <strong>"Send Test"</strong> button that sends a test message to verify your configuration is working correctly.</p>
            </div>
            </div>
        </div>

        <div class="faq-section">
            <h3 class="faq-section-title" onclick="toggleSection(this)">
                <span class="toggle-icon">‚ñ∂</span> Troubleshooting
            </h3>
            <div class="faq-section-content">
            
            <div class="faq-item">
                <h4>A miner shows as offline but it's running</h4>
                <p>Check:</p>
                <ul>
                    <li>IP address is correct and reachable from the Docker container</li>
                    <li>Miner's API is enabled (cgminer API for Avalon, web interface for Bitaxe/NerdQaxe)</li>
                    <li>No firewall blocking the connection</li>
                    <li>For NMMiner: UDP broadcasts are on the same network segment</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>Automation rules aren't triggering</h4>
                <p>Verify:</p>
                <ul>
                    <li>Rule is <strong>enabled</strong></li>
                    <li>Trigger conditions are correctly configured (check price thresholds, time formats)</li>
                    <li>Target miners/pools exist and are valid</li>
                    <li>Check Logs page for rule evaluation errors</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>Dashboard tiles not showing</h4>
                <p>If pool integration tiles are missing:</p>
                <ul>
                    <li>Ensure integration is enabled in Settings</li>
                    <li>Verify API tokens/credentials are correct</li>
                    <li>Check at least one miner is using pools from that provider</li>
                    <li>Review Logs for API connection errors</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>Pool strategy shows "Pool Slots Syncing" warning</h4>
                <p>This appears when you have Avalon Nano miners but their pool slots haven't been synced yet. The system syncs pool slots automatically:</p>
                <ul>
                    <li>On startup (immediate)</li>
                    <li>Every 15 minutes (scheduled)</li>
                </ul>
                <p>Wait a few minutes or restart the container to trigger an immediate sync. Pool strategies require synced slots to know which pools are available on your Avalon Nanos.</p>
            </div>

            <div class="faq-item">
                <h4>Network discovery isn't finding my miners</h4>
                <p>Check:</p>
                <ul>
                    <li>Network range includes your miner's IP (use /24 for full subnet)</li>
                    <li>Miners are powered on and network-accessible from container</li>
                    <li>For Avalon Nano: cgminer API is enabled (default port 4028)</li>
                    <li>For Bitaxe/NerdQaxe: Web interface is accessible</li>
                    <li>No VLANs or firewall rules blocking discovery</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>Notifications not being sent</h4>
                <p>Verify:</p>
                <ul>
                    <li>Notification channel is enabled in Settings</li>
                    <li>Channel credentials are correct (test with "Send Test" button)</li>
                    <li>Alert configuration is enabled and conditions are being met</li>
                    <li>Check alert cooldown periods (may prevent duplicate alerts)</li>
                    <li>Review Logs for notification delivery errors</li>
                </ul>
            </div>

            <div class="faq-item">
                <h4>Analytics charts showing no data</h4>
                <p>Charts require historical telemetry data. If you just added a miner, wait 10-15 minutes for enough data points to be collected. Historical data is purged after 48 hours, so very old data won't appear.</p>
            </div>
            </div>
        </div>

    </div>
</div>

<style>
.faq-container {
    padding: 2rem;
}

.faq-section {
    margin-bottom: 3rem;
}

.faq-section h3 {
    color: var(--accent);
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border);
}

.faq-item {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: var(--bg-tertiary);
    border-radius: 8px;
    border-left: 3px solid var(--accent);
}

.faq-item h4 {
    color: var(--text-primary);
    font-size: 1.1rem;
    margin-bottom: 0.75rem;
}

.faq-item p {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 0.5rem;
}

.faq-item ul {
    margin-left: 1.5rem;
    margin-top: 0.5rem;
    color: var(--text-secondary);
}

.faq-item ul li {
    margin-bottom: 0.5rem;
    line-height: 1.5;
}

.faq-item strong {
    color: var(--text-primary);
}

/* Search Bar */
.faq-search {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
}

.search-input {
    width: 100%;
    max-width: 500px;
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 1rem;
    background-color: var(--bg-secondary);
    color: var(--text-primary);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
}

.faq-quick-links {
    padding: 0.75rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    background-color: var(--bg-secondary);
}

/* Collapsible Sections */
.faq-section-title {
    cursor: pointer;
    user-select: none;
    padding: 0.5rem 0;
    display: flex;
    align-items: center;
    transition: color 0.2s ease;
}

.faq-section-title:hover {
    color: var(--primary-color);
}

.toggle-icon {
    display: inline-block;
    margin-right: 0.5rem;
    font-size: 0.8em;
    transition: transform 0.3s ease;
}

.faq-section-title.expanded .toggle-icon {
    transform: rotate(90deg);
}

.faq-section-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.faq-section-content.expanded {
    max-height: 10000px;
}

.faq-item.hidden {
    display: none;
}

.highlight {
    background-color: yellow;
    font-weight: bold;
}

@media (max-width: 768px) {
    .faq-container {
        padding: 1rem;
    }
    
    .faq-item {
        padding: 1rem;
    }
    
    .faq-section h3 {
        font-size: 1.25rem;
    }
}
</style>

<script>
// Toggle individual section
function toggleSection(element) {
    const content = element.nextElementSibling;
    element.classList.toggle('expanded');
    content.classList.toggle('expanded');
}

// Expand all sections
function expandAll() {
    document.querySelectorAll('.faq-section-title').forEach(title => {
        title.classList.add('expanded');
        title.nextElementSibling.classList.add('expanded');
    });
}

// Collapse all sections
function collapseAll() {
    document.querySelectorAll('.faq-section-title').forEach(title => {
        title.classList.remove('expanded');
        title.nextElementSibling.classList.remove('expanded');
    });
}

// Search functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('faq-search');
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const sections = document.querySelectorAll('.faq-section');
        
        if (searchTerm === '') {
            // Reset view when search is cleared
            document.querySelectorAll('.faq-item').forEach(item => {
                item.classList.remove('hidden');
                // Remove highlights
                item.innerHTML = item.innerHTML.replace(/<span class="highlight">(.*?)<\/span>/gi, '$1');
            });
            collapseAll();
            return;
        }
        
        let hasResults = false;
        
        sections.forEach(section => {
            const sectionTitle = section.querySelector('.faq-section-title');
            const items = section.querySelectorAll('.faq-item');
            let sectionHasMatch = false;
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                
                if (text.includes(searchTerm)) {
                    item.classList.remove('hidden');
                    sectionHasMatch = true;
                    hasResults = true;
                    
                    // Highlight matching text
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    item.innerHTML = item.innerHTML.replace(/<span class="highlight">(.*?)<\/span>/gi, '$1');
                    item.innerHTML = item.innerHTML.replace(regex, '<span class="highlight">$1</span>');
                } else {
                    item.classList.add('hidden');
                }
            });
            
            // Expand sections with matches
            if (sectionHasMatch) {
                sectionTitle.classList.add('expanded');
                sectionTitle.nextElementSibling.classList.add('expanded');
            } else {
                sectionTitle.classList.remove('expanded');
                sectionTitle.nextElementSibling.classList.remove('expanded');
            }
        });
    });
});

function clearSearch() {
    const searchInput = document.getElementById('faq-search');
    searchInput.value = '';
    searchInput.dispatchEvent(new Event('input'));
}
</script>
{% endblock %}
