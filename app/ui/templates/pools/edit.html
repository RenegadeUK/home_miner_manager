{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Edit Pool</h2>
    </div>
    
    <form id="edit-pool-form" class="form">
        <input type="hidden" id="pool-id" value="{{ pool.id }}">
        
        <div class="form-group">
            <label for="name">Pool Name</label>
            <input type="text" id="name" name="name" required value="{{ pool.name }}">
        </div>
        
        <div class="form-group">
            <label for="url">Pool URL / IP Address</label>
            <input type="text" id="url" name="url" required placeholder="pool.example.com or 192.168.1.100" value="{{ pool.url }}">
            <small>Enter hostname or IP address (without protocol or port)</small>
        </div>
        
        <div class="form-group">
            <label for="port">Port</label>
            <input type="number" id="port" name="port" required value="{{ pool.port }}">
        </div>
        
        <div class="form-group">
            <label for="user">Username/Worker</label>
            <input type="text" id="user" name="user" required value="{{ pool.user }}">
        </div>
        
        <div class="form-group">
            <label for="password">Password</label>
            <input type="text" id="password" name="password" required value="{{ pool.password }}">
        </div>
        
        <div class="form-group">
            <label>
                <input type="checkbox" id="enabled" name="enabled" {% if pool.enabled %}checked{% endif %}>
                Enabled
            </label>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <a href="/pools" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.getElementById('edit-pool-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const poolId = document.getElementById('pool-id').value;
    const data = {
        name: document.getElementById('name').value,
        url: document.getElementById('url').value,
        port: parseInt(document.getElementById('port').value),
        user: document.getElementById('user').value,
        password: document.getElementById('password').value,
        enabled: document.getElementById('enabled').checked
    };
    
    try {
        const response = await fetch(`/api/pools/${poolId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        if (!response.ok) {
            throw new Error('Failed to update pool');
        }
        
        window.location.href = '/pools';
    } catch (error) {
        alert('Error updating pool: ' + error.message);
    }
});
</script>
{% endblock %}
