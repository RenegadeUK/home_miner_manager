import{u as S,k as E,r as n,a as M,j as e,C as F,d as I,f as q,L as o,A as L,B as y,v as T}from"./index-6k8Cl_mh.js";import{u as _}from"./useMutation-BCtpQNq2.js";import{I as k}from"./info-BSJZ6lrJ.js";const D=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(?:\.|$)){4}$/,h={avalon_nano:"Avalon Nano 3 / 3S",bitaxe:"Bitaxe 601",nerdqaxe:"NerdQaxe++",nmminer:"NMMiner ESP32"},B={avalon_nano:{badge:"success",title:"Avalon Nano · Dynamic Pool Control",bullets:["Full remote pool management via cgminer TCP API","Agile strategy can switch pools automatically","Requires admin password (default 'admin') to push pool changes"],showPassword:!0},bitaxe:{badge:"success",title:"Bitaxe · Full Control",bullets:["Supports dynamic pool switching to any configured pool","Power and frequency tuning available","Multiple performance profiles supported"]},nerdqaxe:{badge:"success",title:"NerdQaxe++ · Full Control",bullets:["Supports dynamic pool switching and tuning","Automation engine can apply band-based profiles","Tracks temperature, power, and reject metrics"]},nmminer:{badge:"info",title:"NMMiner ESP32 · UDP Telemetry",bullets:["Telemetry is broadcast over UDP every few seconds","Pool configuration is sent via UDP port 12347","Limited automation—no power metrics or tuning data"]}};function U(){const b=S(),f=E(),[c,j]=n.useState(""),[s,v]=n.useState(""),[i,N]=n.useState(""),[u,w]=n.useState(""),[m,P]=n.useState(""),[x,l]=n.useState(null),{data:A=[],isLoading:g}=M({queryKey:["miner-types"],queryFn:async()=>{const r=await fetch("/api/miners/types");if(!r.ok)throw new Error("Failed to load miner types");return(await r.json()).types||[]}}),a=n.useMemo(()=>s?B[s]:void 0,[s]),p=_({mutationFn:async r=>{const t=await fetch("/api/miners/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok){const d=await t.json().catch(()=>({}));throw new Error(d.detail||"Failed to add miner")}return t.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["miners"]}),b("/miners")}}),C=async r=>{if(r.preventDefault(),l(null),!c.trim()||!s||!i.trim()){l("Name, miner type, and IP address are required.");return}if(!D.test(i.trim())){l("Enter a valid IPv4 address (e.g., 192.168.0.42).");return}const t={name:c.trim(),miner_type:s,ip_address:i.trim(),port:u?parseInt(u,10):null};s==="avalon_nano"&&m.trim()&&(t.config={admin_password:m.trim()});try{await p.mutateAsync(t)}catch(d){l(d instanceof Error?d.message:"Failed to add miner")}};return e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs(F,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{className:"text-sm uppercase tracking-wider text-blue-300",children:"Miners"}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Add New Miner"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Provide the device details below. Pool presets and automation logic come straight from your existing configuration."})]})}),e.jsx(q,{children:e.jsxs("form",{className:"space-y-6",onSubmit:C,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",children:"Miner Name"}),e.jsx("input",{id:"name",type:"text",value:c,onChange:r=>j(r.target.value),placeholder:"e.g., Avalon Nano #1",className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"miner-type",children:"Miner Type"}),e.jsxs("select",{id:"miner-type",value:s,onChange:r=>v(r.target.value),disabled:g,className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40 disabled:opacity-60",required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:g?"Loading miner types…":"Select miner type"}),A.filter(r=>h[r]).map(r=>e.jsx("option",{value:r,children:h[r]},r))]}),a&&e.jsxs("div",{className:`mt-3 rounded-lg border px-4 py-3 text-sm ${a.badge==="success"?"border-green-500/30 bg-green-500/5 text-green-200":"border-blue-400/40 bg-blue-400/5 text-blue-100"}`,children:[e.jsxs("p",{className:"font-semibold flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),a.title]}),e.jsx("ul",{className:"mt-2 list-disc space-y-1 pl-5 text-gray-200",children:a.bullets.map(r=>e.jsx("li",{children:r},r))})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"ip-address",children:"IP Address"}),e.jsx("input",{id:"ip-address",type:"text",value:i,onChange:r=>N(r.target.value),placeholder:"192.168.1.120",pattern:"^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(?:\\\\.|$)){4}$",className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use the static IP configured on the miner."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"port",children:"Port (optional)"}),e.jsx("input",{id:"port",type:"number",value:u,onChange:r=>w(r.target.value),min:1,max:65535,placeholder:"Default per miner type",className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40"})]})]}),(a==null?void 0:a.showPassword)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"admin-password",children:"Avalon Nano Admin Password"}),e.jsx("input",{id:"admin-password",type:"password",value:m,onChange:r=>P(r.target.value),placeholder:"Default is 'admin'",className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Needed for remote pool configuration. Leave blank to use the device default."})]}),x&&e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:x})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(y,{type:"submit",disabled:p.isPending,className:"min-w-[140px]",children:p.isPending?"Adding Miner…":"Add Miner"}),e.jsx(y,{type:"button",variant:"secondary",asChild:!0,children:e.jsx(T,{to:"/miners",children:"Cancel"})})]})]})})]})})})}export{U as default};
