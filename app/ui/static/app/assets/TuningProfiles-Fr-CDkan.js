import{k as re,r as u,a as B,j as e,a5 as ne,O as te,C as Q,d as V,e as H,f as z,L as x,n as q,o as M,p as E,q as k,s as C,a6 as N,J as ae,w as K,x as R,y as Y,z as Z,Z as le,I as J,B as h,a0 as de,A as ie,a7 as oe,a4 as ce}from"./index-BGy3dVUV.js";import{u as T}from"./useMutation-D798RsZJ.js";import{L as w}from"./loader-2-CxE49JNx.js";import{T as ue}from"./trash-2-C_6GmbKT.js";const D=[{value:"avalon_nano",label:"Avalon Nano 3/3S"},{value:"bitaxe",label:"Bitaxe 601"},{value:"nerdqaxe",label:"NerdQaxe++"}],A={name:"",minerType:"",description:"",mode:"standard",frequency:"",voltage:""};function Ne(){const r=re(),[l,t]=u.useState(""),[d,m]=u.useState(null),[o,c]=u.useState(!1),[a,n]=u.useState(A),[G,p]=u.useState(null),[g,S]=u.useState(null),[P,j]=u.useState(""),[_,F]=u.useState(null),f=B({queryKey:["tuning-profiles",l],queryFn:()=>N.getProfiles(l||void 0)}),y=B({queryKey:["miners-for-apply"],queryFn:()=>ce.getAll(),enabled:!!g}),b=(s,i)=>{m({tone:s,message:i}),window.setTimeout(()=>m(null),5e3)},v=s=>{if(s instanceof de){if(s.data&&typeof s.data=="object"){const i=s.data.detail;if(typeof i=="string")return i}return s.message}return s instanceof Error?s.message:"Something went wrong"},I=T({mutationFn:N.createProfile,onSuccess:()=>{b("success","Tuning profile created"),r.invalidateQueries({queryKey:["tuning-profiles"]}),c(!1),n(A)},onError:s=>p(v(s))}),L=T({mutationFn:s=>N.deleteProfile(s),onSuccess:()=>{b("success","Profile deleted"),r.invalidateQueries({queryKey:["tuning-profiles"]})},onError:s=>b("error",v(s)),onSettled:()=>F(null)}),O=T({mutationFn:({profileId:s,minerId:i})=>N.applyProfile(s,i),onSuccess:s=>{b("success",s.message||"Profile applied successfully"),S(null),j("")},onError:s=>b("error",v(s))}),U=u.useMemo(()=>!g||!y.data?[]:y.data.filter(s=>s.type===g.miner_type),[g,y.data]),W=()=>{if(p(null),!a.name.trim()){p("Profile name is required");return}if(!a.minerType){p("Select a miner type");return}const s={};if(a.minerType==="avalon_nano"?s.mode=a.mode||"med":(a.mode&&(s.mode=a.mode),a.frequency&&(s.frequency=Number(a.frequency)),a.voltage&&(s.voltage=Number(a.voltage))),Object.keys(s).length===0){p("Configure at least one setting");return}I.mutate({name:a.name.trim(),miner_type:a.minerType,description:a.description.trim()||null,settings:s})},X=s=>{s.is_system||window.confirm(`Delete tuning profile "${s.name}"?`)&&(F(s.id),L.mutate(s.id))},ee=()=>{!g||!P||O.mutate({profileId:g.id,minerId:Number(P)})},se=()=>{if(f.isLoading)return e.jsx(he,{});if(f.isError)return e.jsx(fe,{message:v(f.error),onRetry:()=>f.refetch()});const s=f.data??[];return s.length===0?e.jsx("div",{className:"rounded-2xl border border-dashed border-border/60 bg-muted/5 p-10 text-center text-sm text-muted-foreground",children:"No tuning profiles found. Create a profile to get started."}):e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[s.map(i=>e.jsx(me,{profile:i,onApply:()=>{S(i),j("")},onDelete:()=>X(i),deleteDisabled:i.is_system||_===i.id,isDeleting:_===i.id&&L.isPending},i.id)),e.jsxs("button",{type:"button",onClick:()=>{c(!0),p(null)},className:"flex min-h-[220px] flex-col items-center justify-center rounded-2xl border border-dashed border-border/70 bg-muted/5 text-sm text-muted-foreground transition hover:border-blue-500 hover:text-blue-200",children:[e.jsx(ae,{className:"mb-2 h-6 w-6"}),"Create profile"]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(ne,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"Tuning Profiles"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Save and reuse safe tuning presets across Avalon Nano, Bitaxe, and NerdQaxe miners. Apply profiles with two clicks and keep your fleet consistent."})]}),d&&e.jsx("div",{className:te("rounded-xl border px-4 py-3 text-sm",d.tone==="success"&&"border-emerald-500/40 bg-emerald-500/10 text-emerald-100",d.tone==="error"&&"border-red-500/40 bg-red-500/10 text-red-100",d.tone==="info"&&"border-blue-500/40 bg-blue-500/10 text-blue-100"),children:d.message}),e.jsxs(Q,{children:[e.jsx(V,{children:e.jsx(H,{className:"text-lg",children:"Filter profiles"})}),e.jsxs(z,{className:"grid gap-3 md:max-w-sm",children:[e.jsx(x,{className:"text-sm text-muted-foreground",children:"Miner type"}),e.jsxs(q,{value:l,onValueChange:s=>t(s),children:[e.jsx(M,{children:e.jsx(E,{placeholder:"All types"})}),e.jsxs(k,{children:[e.jsx(C,{value:"",children:"All types"}),D.map(s=>e.jsx(C,{value:s.value,children:s.label},s.value))]})]})]})]}),se(),e.jsx(pe,{open:o,onOpenChange:s=>{c(s),s||(n(A),p(null))},form:a,onFormChange:n,onSubmit:W,isSubmitting:I.isPending,error:G}),e.jsx(ge,{profile:g,miners:U,isLoadingMiners:y.isFetching,selectedMinerId:P,onMinerChange:j,onClose:()=>{S(null),j("")},onApply:ee,isApplying:O.isPending})]})}function me({profile:r,onApply:l,onDelete:t,deleteDisabled:d,isDeleting:m}){return e.jsxs(Q,{className:"relative h-full border-border/60 bg-muted/5",children:[r.is_system&&e.jsx("span",{className:"absolute right-4 top-4 rounded-full bg-purple-500/20 px-3 py-1 text-xs font-semibold text-purple-200",children:"SYSTEM"}),e.jsx(V,{children:e.jsxs(H,{className:"space-y-1 text-lg",children:[e.jsx("p",{className:"text-foreground",children:r.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:$(r.miner_type)})]})}),e.jsxs(z,{className:"space-y-4 text-sm text-muted-foreground",children:[e.jsx("p",{children:r.description||"No description provided."}),e.jsxs("div",{className:"rounded-xl border border-border/60 bg-background/40 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Settings"}),e.jsx("dl",{className:"mt-2 space-y-1 text-foreground",children:Object.entries(r.settings).map(([o,c])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("dt",{className:"text-muted-foreground",children:xe(o)}),e.jsx("dd",{className:"font-medium",children:c})]},o))})]})]}),e.jsxs(oe,{className:"flex flex-wrap gap-2",children:[e.jsx(h,{className:"flex-1",onClick:l,children:"Apply to miner"}),e.jsxs(h,{type:"button",variant:"ghost",disabled:d,onClick:t,className:"flex-1 text-red-400 hover:bg-red-500/10 hover:text-red-200",children:[m?e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}function $(r){const l=D.find(t=>t.value===r);return l?l.label:r}function xe(r){return r==="mode"?"Mode":r==="frequency"?"Frequency (MHz)":r==="voltage"?"Voltage (mV)":r.replace(/_/g," ")}function pe({open:r,onOpenChange:l,form:t,onFormChange:d,onSubmit:m,isSubmitting:o,error:c}){const a=t.minerType==="avalon_nano";return e.jsx(K,{open:r,onOpenChange:l,children:e.jsxs(R,{className:"max-h-[90vh] overflow-y-auto border-border/70 bg-gray-900",children:[e.jsx(Y,{children:e.jsx(Z,{children:"Create tuning profile"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"profile-name",children:"Profile name"}),e.jsx("input",{id:"profile-name",type:"text",value:t.name,onChange:n=>d({...t,name:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"Eco mode, Turbo, etc."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Miner type"}),e.jsxs(q,{value:t.minerType,onValueChange:n=>d({...t,minerType:n,mode:n==="avalon_nano"?"med":"standard",frequency:"",voltage:""}),children:[e.jsx(M,{children:e.jsx(E,{placeholder:"Select miner type"})}),e.jsx(k,{children:D.map(n=>e.jsx(C,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Description (optional)"}),e.jsx("textarea",{value:t.description,onChange:n=>d({...t,description:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",rows:2,placeholder:"Explain what this profile is optimized for"})]}),t.minerType?e.jsxs("div",{className:"space-y-4 rounded-2xl border border-border/60 bg-muted/5 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx(le,{className:"h-4 w-4 text-blue-300"})," Tunable settings"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Mode"}),e.jsx("select",{value:t.mode,onChange:n=>d({...t,mode:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",children:a?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"med",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"eco",children:"Eco"}),e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"turbo",children:"Turbo"}),e.jsx("option",{value:"oc",children:"Overclock"})]})})]}),!a&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Frequency (MHz)"}),e.jsx("input",{type:"number",value:t.frequency,onChange:n=>d({...t,frequency:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"500",min:100,max:1e3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Voltage (mV)"}),e.jsx("input",{type:"number",value:t.voltage,onChange:n=>d({...t,voltage:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"1200",min:800,max:1500})]})]})]}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border/60 bg-muted/5 p-4 text-sm text-muted-foreground",children:"Choose a miner type to reveal the available settings."}),c&&e.jsx("p",{className:"text-sm text-red-300",children:c})]}),e.jsxs(J,{className:"pt-4",children:[e.jsx(h,{variant:"secondary",onClick:()=>l(!1),disabled:o,children:"Cancel"}),e.jsxs(h,{onClick:m,disabled:o,children:[o&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Save profile"]})]})]})})}function ge({profile:r,miners:l,isLoadingMiners:t,selectedMinerId:d,onMinerChange:m,onClose:o,onApply:c,isApplying:a}){return e.jsx(K,{open:!!r,onOpenChange:n=>!n&&o(),children:e.jsxs(R,{className:"border-border/70 bg-gray-900",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Apply profile"}),r&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.name," · ",$(r.miner_type)]})]}),t?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(w,{className:"h-4 w-4 animate-spin"})," Loading compatible miners…"]}):l.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No compatible miners found."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Select miner"}),e.jsxs(q,{value:d,onValueChange:m,children:[e.jsx(M,{children:e.jsx(E,{placeholder:"Choose a miner"})}),e.jsx(k,{children:l.map(n=>e.jsx(C,{value:String(n.id),children:n.name},n.id))})]})]}),e.jsxs(J,{className:"pt-4",children:[e.jsx(h,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsxs(h,{onClick:c,disabled:!d||a||l.length===0,children:[a&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Apply profile"]})]})]})})}function he(){return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[...Array(3)].map((r,l)=>e.jsxs("div",{className:"space-y-3 rounded-2xl border border-border/40 bg-muted/5 p-6",children:[e.jsx("div",{className:"h-5 w-2/3 animate-pulse rounded bg-muted/30"}),e.jsx("div",{className:"h-4 w-1/2 animate-pulse rounded bg-muted/20"}),e.jsx("div",{className:"h-20 animate-pulse rounded-xl bg-muted/20"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-9 w-full animate-pulse rounded bg-muted/20"}),e.jsx("div",{className:"h-9 w-full animate-pulse rounded bg-muted/20"})]})]},l))})}function fe({message:r,onRetry:l}){return e.jsxs("div",{className:"rounded-2xl border border-red-500/40 bg-red-500/10 p-4 text-sm text-red-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"})," ",r]}),e.jsx(h,{variant:"secondary",className:"mt-3",onClick:l,children:"Retry"})]})}export{Ne as default};
