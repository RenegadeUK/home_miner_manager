import{c as y,b as N,u as b,a as o,j as e,C as r,d as l,e as i,f as n,A as v}from"./index-Ck7jEKe2.js";import{L as w,C,a as _,b as S,P as A,c as L,p as H,d as k,e as F,T as I}from"./chartjs-adapter-date-fns.esm-B8eD_skf.js";import{h as m,f as M,a as E,b as T}from"./textFormatters-NadoA3a2.js";import{I as q}from"./info-CpISnL4H.js";import{A as O}from"./alert-triangle-CQwQaDpD.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=y("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);C.register(_,S,A,L,H,k,F,I);function G(){const{minerId:c}=N(),x=b(),{data:t,isLoading:h}=o({queryKey:["minerHealth",c],queryFn:async()=>{const s=await fetch(`/api/health/${c}`);if(!s.ok)throw new Error("Failed to fetch health data");return s.json()},refetchInterval:3e4}),{data:a}=o({queryKey:["minerHealthHistory",c],queryFn:async()=>{const s=await fetch(`/api/health/${c}/history?hours=24`);if(!s.ok)throw new Error("Failed to fetch history");return s.json()},refetchInterval:6e4});if(h)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})});if(!t)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"text-muted-foreground",children:"Miner not found"})});const u=s=>{switch(s.toLowerCase()){case"healthy":return"text-green-600";case"warning":return"text-yellow-600";case"critical":return"text-red-600";default:return"text-gray-600"}},p=s=>{switch(s.toLowerCase()){case"critical":return e.jsx(v,{className:"h-5 w-5"});case"warning":return e.jsx(O,{className:"h-5 w-5"});default:return e.jsx(q,{className:"h-5 w-5"})}},j=s=>{switch(s.toLowerCase()){case"critical":return"bg-red-100 text-red-800";case"warning":return"bg-yellow-100 text-yellow-800";case"info":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},g={labels:(a==null?void 0:a.map(s=>new Date(s.timestamp)))||[],datasets:[{label:"Health Score",data:(a==null?void 0:a.map(s=>s.health_score))||[],borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",yAxisID:"y"},{label:"Anomaly Score",data:(a==null?void 0:a.map(s=>s.anomaly_score||null))||[],borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",yAxisID:"y1",spanGaps:!0}]},f={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top"},title:{display:!0,text:"24-Hour Health Timeline"}},scales:{x:{type:"time",time:{unit:"hour"},title:{display:!0,text:"Time"}},y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"Health Score"},min:0,max:100},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"Anomaly Score"},min:0,max:1,grid:{drawOnChartArea:!1}}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>x("/health"),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium border rounded-md hover:bg-muted transition-colors",children:[e.jsx(R,{className:"h-4 w-4"}),"Back to Fleet"]}),e.jsx("h1",{className:"text-3xl font-bold",children:t.miner_name})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(r,{children:[e.jsx(l,{children:e.jsx(i,{children:"Health Score"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-4xl font-bold",children:t.health_score}),e.jsxs("div",{className:`flex items-center gap-2 mt-2 ${u(t.status)}`,children:[p(t.status),e.jsx("span",{className:"font-semibold uppercase",children:t.status})]})]})]}),e.jsxs(r,{children:[e.jsx(l,{children:e.jsx(i,{children:"ML Anomaly Score"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-4xl font-bold",children:t.anomaly_score!=null?t.anomaly_score.toFixed(3):"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-2",children:t.anomaly_score!=null?"Higher = more anomalous":"Not yet trained"})]})]}),e.jsxs(r,{children:[e.jsx(l,{children:e.jsx(i,{children:"Current Mode"})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-4xl font-bold uppercase",children:t.mode||"Unknown"}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["Last check: ",new Date(t.last_check).toLocaleString()]})]})]})]}),t.reasons&&t.reasons.length>0&&e.jsxs(r,{children:[e.jsx(l,{children:e.jsx(i,{children:"Issues Detected"})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-4",children:t.reasons.map((s,d)=>typeof s=="string"?e.jsx("div",{className:"border-l-4 border-yellow-500 pl-4 py-2",children:e.jsx("p",{className:"text-sm",children:m(s)})},d):e.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${j(s.severity)}`,children:m(s.severity)}),e.jsx("span",{className:"text-sm font-semibold",children:M(s.code)})]}),s.delta_pct!=null&&e.jsxs("span",{className:"text-sm font-semibold text-red-600",children:[s.delta_pct>0?"+":"",s.delta_pct.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-sm font-medium",children:E(s.metric)}),s.code==="SENSOR_MISSING"&&e.jsx("div",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded",children:"ℹ️ This miner is likely OFF due to Agile pricing. No telemetry available when miner is powered down."}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Actual"}),e.jsxs("div",{className:"font-semibold",children:[s.actual.toFixed(2)," ",s.unit]})]}),s.expected_min!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Expected Min"}),e.jsxs("div",{className:"font-semibold",children:[s.expected_min.toFixed(2)," ",s.unit]})]}),s.expected_max!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Expected Max"}),e.jsxs("div",{className:"font-semibold",children:[s.expected_max.toFixed(2)," ",s.unit]})]})]})]},d))})})]}),t.suggested_actions&&t.suggested_actions.length>0&&e.jsxs(r,{children:[e.jsx(l,{children:e.jsx(i,{children:"Suggested Actions"})}),e.jsx(n,{children:e.jsx("ul",{className:"space-y-2",children:t.suggested_actions.map((s,d)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{className:"text-sm",children:T(s)})]},d))})})]}),a&&a.length>0&&e.jsxs(r,{children:[e.jsx(l,{children:e.jsx(i,{children:"Health Timeline (24 Hours)"})}),e.jsx(n,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(w,{data:g,options:f})})})]})]})}export{G as default};
