import{r as c,j as e,R as v,C as h,d as f,e as g,f as b,P as C,B as l,Z as j,ah as k,U as A}from"./index-CExZIXGI.js";import{u as R}from"./useMutation-Clq0xfHR.js";import{S as p}from"./shield-alert-BF6GOtIL.js";import{L as w}from"./loader-2-C8glyB0y.js";import{A as P}from"./alert-triangle-DX5sLPxR.js";function F(){const[s,t]=c.useState("idle"),[n,a]=c.useState(null),[r,i]=c.useState(null),o=R({mutationFn:()=>k.restartContainer(),onSuccess:()=>{a({tone:"success",message:"Restart initiated. Hold tight while the container reboots."}),i(10),t("idle")},onError:d=>{const m=d instanceof Error?d.message:"Failed to restart container";a({tone:"error",message:m}),t("idle")}});c.useEffect(()=>{if(r===null)return;if(r<=0){window.location.reload();return}const d=window.setTimeout(()=>i(m=>(m??0)-1),1e3);return()=>window.clearTimeout(d)},[r]);const N=()=>{o.mutate()},y=()=>t("stage-one"),u=()=>t("idle");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(v,{className:"h-8 w-8 text-red-400"}),e.jsx("span",{children:"Restart Container"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Initiate a safe restart of the HMM container. All miners remain unaffected, but the dashboard and APIs will be unavailable for a brief period (~10 seconds) while the service restarts."})]}),n&&e.jsx(S,{tone:n.tone,message:n.message,onDismiss:()=>a(null)}),e.jsxs("div",{className:"grid gap-5 lg:grid-cols-2",children:[e.jsxs(h,{className:"border border-red-500/40 bg-red-500/5",children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-3 text-lg text-red-200",children:[e.jsx(p,{className:"h-5 w-5"}),"Before you restart"]})}),e.jsxs(b,{className:"space-y-4 text-sm text-red-100",children:[e.jsx(x,{label:"All API requests will fail during the restart window."}),e.jsx(x,{label:"Telemetry ingestion pauses until the container returns."}),e.jsx(x,{label:"CLI/Docker access is required if the restart does not complete."}),e.jsx("div",{className:"rounded-xl border border-red-500/50 bg-red-500/10 p-3 text-xs",children:"Safety tip: run restarts during low activity windows. Automations resume automatically once the container is back online."})]})]}),e.jsxs(h,{className:"border border-border/60",children:[e.jsx(f,{children:e.jsxs(g,{className:"flex items-center gap-3 text-lg",children:[e.jsx(C,{className:"h-5 w-5 text-red-300"}),"Controlled restart"]})}),e.jsxs(b,{className:"space-y-5",children:[e.jsx("div",{className:"rounded-2xl border border-border/60 bg-muted/5 p-4 text-sm text-muted-foreground",children:"This flow mirrors the legacy double confirmation + countdown overlay but keeps you inside the new React experience. Once confirmed, we POST to `/api/settings/restart` and give you a visual countdown until the page reloads."}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Restart impact"}),e.jsxs("ul",{className:"list-disc space-y-1 pl-5 text-muted-foreground",children:[e.jsx("li",{children:"Dashboard & API go offline for ~10 seconds"}),e.jsx("li",{children:"Miners continue hashing (they connect to pools directly)"}),e.jsx("li",{children:"Automation engine resumes pending jobs automatically"})]})]}),e.jsxs(l,{variant:"destructive",className:"w-full justify-center",onClick:y,disabled:o.isPending,children:[o.isPending?e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(j,{className:"mr-2 h-4 w-4"}),"Restart container"]}),r!==null&&e.jsx(T,{seconds:r})]})]})]}),e.jsx(I,{step:s,onCancel:u,onConfirm:()=>t("stage-two"),onRestart:()=>{u(),N()},isRestarting:o.isPending})]})}function x({label:s}){return e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-red-500/40 bg-red-500/10 px-3 py-2 text-xs",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:s})]})}function S({tone:s,message:t,onDismiss:n}){const a=s==="success"?"border-emerald-500/40 bg-emerald-500/10 text-emerald-100":s==="error"?"border-red-500/40 bg-red-500/10 text-red-100":"border-blue-500/40 bg-blue-500/10 text-blue-100";return e.jsxs("div",{className:A("flex items-center justify-between rounded-xl border px-4 py-3 text-sm",a),children:[e.jsx("span",{children:t}),e.jsx(l,{variant:"ghost",size:"sm",className:"text-current",onClick:n,children:"Dismiss"})]})}function I({step:s,onCancel:t,onConfirm:n,onRestart:a,isRestarting:r}){if(s==="idle")return null;const i=s==="stage-two";return e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 p-4",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl border border-border/60 bg-background p-6 text-sm text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-3 text-lg font-semibold text-red-300",children:[e.jsx(p,{className:"h-5 w-5"}),i?"Final confirmation":"Confirm restart"]}),e.jsx("p",{className:"mt-3 text-muted-foreground",children:i?"This is your last chance to cancel. The container restart takes all UI/API services offline temporarily.":"Restarting interrupts any active API calls and temporarily pauses telemetry ingestion. Continue?"}),e.jsxs("div",{className:"mt-5 flex flex-wrap justify-end gap-3",children:[e.jsx(l,{variant:"ghost",onClick:t,disabled:r,children:"Cancel"}),!i&&e.jsx(l,{variant:"secondary",onClick:n,children:"Continue"}),i&&e.jsxs(l,{variant:"destructive",onClick:a,disabled:r,children:[r?e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(j,{className:"mr-2 h-4 w-4"}),"Restart now"]})]})]})})}function T({seconds:s}){return e.jsx("div",{className:"fixed inset-0 z-30 flex items-center justify-center bg-black/70",children:e.jsxs("div",{className:"rounded-2xl border border-border/70 bg-background/95 p-6 text-center text-foreground",children:[e.jsxs("div",{className:"text-5xl font-bold text-red-300",children:[s,"s"]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Restart in progressâ€¦ page will refresh automatically."})]})})}export{F as default};
