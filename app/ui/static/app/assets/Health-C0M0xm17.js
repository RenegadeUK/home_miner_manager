import{u as F,a as M,j as t,C as c,M as S}from"./index-Cw5JvtJ_.js";import{h as H,f as E,a as I}from"./textFormatters-NadoA3a2.js";function R(){const f=F(),{data:a,isLoading:u,error:h}=M({queryKey:["health","all"],queryFn:async()=>{const e=await fetch("/api/health/all");if(!e.ok)throw new Error("Failed to fetch health data");return e.json()},refetchInterval:1e4});if(u)return t.jsxs("div",{className:"space-y-4",children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fleet Health"}),t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"text-muted-foreground",children:"Loading health data..."})})]});if(h)return t.jsxs("div",{className:"space-y-4",children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fleet Health"}),t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-destructive",children:["Error loading health data: ",h.message]})})]});const x=e=>e>=80?"text-green-500":e>=60?"text-yellow-500":e>=40?"text-orange-500":"text-red-500",g=e=>e>=80?"bg-green-500/10 border-green-500/20":e>=60?"bg-yellow-500/10 border-yellow-500/20":e>=40?"bg-orange-500/10 border-orange-500/20":"bg-red-500/10 border-red-500/20",N=e=>e>=80?"Excellent":e>=60?"Good":e>=40?"Fair":"Poor",j=e=>{const s=new Date(e),r=new Date().getTime()-s.getTime(),i=Math.floor(r/6e4);if(i<1)return"Just now";if(i<60)return`${i}m ago`;const o=Math.floor(i/60);return o<24?`${o}h ago`:`${Math.floor(o/24)}d ago`},d=e=>Math.abs(e)>=100?e.toFixed(0):Math.abs(e)>=10?e.toFixed(1):e.toFixed(2).replace(/\.00$/,""),p=e=>e.replace(/(\d)([A-Za-z])/g,"$1 $2"),b=(e,s)=>{if(e==null)return"";if(typeof e=="number"){const r=d(e);return s?`${r} ${s}`:r}const l=p(e);return s?`${l} ${s}`.trim():l},v=(e,s,l)=>{if(e!==void 0&&s!==void 0){const r=`${d(e)}–${d(s)}`;return l?`${r} ${l}`:r}if(e!==void 0){const r=`${d(e)}`;return l?`≥ ${r} ${l}`:`≥ ${r}`}if(s!==void 0){const r=`${d(s)}`;return l?`≤ ${r} ${l}`:`≤ ${r}`}return""},y=e=>{if(typeof e=="string")return H(e);const s=e.code||"";if(s==="INSUFFICIENT_DATA"){const w=e.expected_min||60;return`Collecting baseline — ${e.actual||0}/${w} samples`}const l=E(s||""),r=e.metric?I(e.metric):"",i=b(e.actual,e.unit)||(s==="SENSOR_MISSING"?"No samples":""),o=v(e.expected_min,e.expected_max,e.unit),m=r?`${l} — ${r}`:l,$=i?` ${i}`:"",_=o?` (target ${o})`:"";return`${m}${$}${_}`.trim()},n=[...(a==null?void 0:a.miners)||[]].sort((e,s)=>e.health_score-s.health_score);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fleet Health"}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[a==null?void 0:a.monitored_miners," of ",a==null?void 0:a.total_miners," miners monitored"]})]}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[t.jsxs(c,{className:"p-4",children:[t.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Excellent Health"}),t.jsx("div",{className:"mt-2 text-2xl font-bold text-green-500",children:n.filter(e=>e.health_score>=80).length})]}),t.jsxs(c,{className:"p-4",children:[t.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Good Health"}),t.jsx("div",{className:"mt-2 text-2xl font-bold text-yellow-500",children:n.filter(e=>e.health_score>=60&&e.health_score<80).length})]}),t.jsxs(c,{className:"p-4",children:[t.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Fair Health"}),t.jsx("div",{className:"mt-2 text-2xl font-bold text-orange-500",children:n.filter(e=>e.health_score>=40&&e.health_score<60).length})]}),t.jsxs(c,{className:"p-4",children:[t.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Poor Health"}),t.jsx("div",{className:"mt-2 text-2xl font-bold text-red-500",children:n.filter(e=>e.health_score<40).length})]})]}),n.filter(e=>e.reasons.some(s=>typeof s=="object"&&s.code==="SENSOR_MISSING")).length>0&&t.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"text-blue-600 text-xl",children:"ℹ️"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-blue-900",children:"Miners Powered Down"}),t.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"SENSOR_MISSING errors are expected when miners are OFF due to Agile pricing. They will automatically resume when electricity is cheaper."})]})]})}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:n.map(e=>t.jsxs(c,{className:`p-4 cursor-pointer hover:shadow-lg transition-shadow ${g(e.health_score)}`,onClick:()=>f(`/health/${e.miner_id}`),children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"font-semibold",children:e.miner_name}),t.jsx(S,{type:e.miner_type,size:"sm"})]}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.mode})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:`text-3xl font-bold ${x(e.health_score)}`,children:e.health_score}),t.jsx("div",{className:`text-xs font-medium ${x(e.health_score)}`,children:N(e.health_score)})]})]}),e.reasons.length>0&&t.jsx("div",{className:"mt-3 space-y-1",children:e.reasons.map((s,l)=>t.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-background/50",children:["⚠️ ",y(s)]},l))}),t.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-muted-foreground",children:[t.jsxs("span",{children:["Anomaly: ",e.anomaly_score!=null?e.anomaly_score.toFixed(2):"N/A"]}),t.jsx("span",{children:j(e.timestamp)})]})]},e.miner_id))}),n.length===0&&t.jsx(c,{className:"p-8 text-center",children:t.jsx("div",{className:"text-muted-foreground",children:"No health data available yet. Health monitoring will begin once miners report telemetry."})})]})}export{R as Health};
