import{c as M,b as O,u as U,k as W,r as F,a as x,j as e,C as m,f as u,A,B as h,R as Z,d as b,l as G,S as J,L as C,m as X,n as Y,o as ee,p as ae,q as se,s as P,N as te,P as re}from"./index-tLXKiwNj.js";import{u as N}from"./useMutation-DFDlM0BK.js";import{T as le}from"./trash-2-D-iqd6mu.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=M("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=M("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=M("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),i="http://10.200.204.22:8080";function me(){var E;const{minerId:r}=O(),w=U(),c=W(),[f,R]=F.useState(""),[j,T]=F.useState(null),[p,L]=F.useState(!0),{data:g}=x({queryKey:["miners"],queryFn:async()=>{const s=await fetch(`${i}/api/dashboard/all?dashboard_type=all`);if(!s.ok)throw new Error("Failed to fetch miners");return s.json()}}),n=g==null?void 0:g.miners.find(s=>s.id===parseInt(r||"0")),{data:d}=x({queryKey:["minerDetails",r],queryFn:async()=>{const s=await fetch(`${i}/api/miners/${r}`);if(!s.ok)throw new Error("Failed to fetch miner details");return s.json()},enabled:!!r}),{data:a,isLoading:K,error:V}=x({queryKey:["telemetry",r],queryFn:async()=>{const s=await fetch(`${i}/api/miners/${r}/telemetry`);if(!s.ok)throw new Error("Failed to fetch telemetry");return s.json()},refetchInterval:p?5e3:!1,enabled:!!r}),{data:S}=x({queryKey:["modes",r],queryFn:async()=>{const s=await fetch(`${i}/api/miners/${r}/modes`);if(!s.ok)throw new Error("Failed to fetch modes");return s.json()},enabled:!!r}),{data:B=[]}=x({queryKey:["pools"],queryFn:async()=>{const s=await fetch(`${i}/api/pools/`);if(!s.ok)throw new Error("Failed to fetch pools");return s.json()}});x({queryKey:["devicePools",r],queryFn:async()=>{const s=await fetch(`${i}/api/miners/${r}/device-pools`);return s.ok?s.json():[]},enabled:!!r});const y=N({mutationFn:async s=>{const l=await fetch(`${i}/api/miners/${r}/mode?mode=${s}`,{method:"POST"});if(!l.ok)throw new Error("Failed to set mode");return l.json()},onSuccess:()=>{c.invalidateQueries({queryKey:["telemetry",r]}),c.invalidateQueries({queryKey:["miners"]})}}),v=N({mutationFn:async s=>{const l=await fetch(`${i}/api/miners/${r}/pool?pool_id=${s}`,{method:"POST"});if(!l.ok)throw new Error("Failed to switch pool");return l.json()},onSuccess:()=>{c.invalidateQueries({queryKey:["telemetry",r]}),c.invalidateQueries({queryKey:["devicePools",r]})}}),_=N({mutationFn:async()=>{const s=await fetch(`${i}/api/miners/${r}/restart`,{method:"POST"});if(!s.ok)throw new Error("Failed to restart miner");return s.json()}}),q=N({mutationFn:async()=>{const s=await fetch(`${i}/api/miners/${r}`,{method:"DELETE"});if(!s.ok)throw new Error("Failed to delete miner");return s.json()},onSuccess:()=>{w("/miners")}}),I=()=>{f&&y.mutate(f)},D=()=>{j!==null&&v.mutate(j)},H=()=>{confirm("Are you sure you want to restart this miner?")&&_.mutate()},z=()=>{confirm(`Are you sure you want to delete ${n==null?void 0:n.name}? This cannot be undone.`)&&q.mutate()},Q=s=>{const l=Math.floor(s/86400),$=Math.floor(s%86400/3600),k=Math.floor(s%3600/60);return l>0?`${l}d ${$}h ${k}m`:$>0?`${$}h ${k}m`:`${k}m`},o=(s,l=2)=>s==null?"â€”":s>=1e9?`${(s/1e9).toFixed(2)}B`:s>=1e6?`${(s/1e6).toFixed(2)}M`:s>=1e3?`${(s/1e3).toFixed(2)}K`:s.toFixed(l);return g?n?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:n.name}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:n.miner_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>L(!p),className:"gap-2",children:[e.jsx(Z,{className:`h-4 w-4 ${p?"animate-spin":""}`}),p?"Auto":"Manual"]}),e.jsx(h,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:`/miners/${r}/edit`,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Edit"]})}),e.jsxs(h,{variant:"destructive",size:"sm",onClick:z,disabled:q.isPending,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(m,{children:[e.jsxs(b,{className:"flex flex-row items-center gap-3 pb-3",children:[e.jsx(de,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"font-semibold",children:"Configuration"})]}),e.jsxs(u,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Status"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${n.enabled?"bg-green-500/10 text-green-400 border border-green-500/20":"bg-gray-500/10 text-gray-400 border border-gray-500/20"}`,children:n.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Type"}),e.jsx("span",{className:"text-sm font-medium",children:n.miner_type})]}),(d==null?void 0:d.ip_address)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"IP Address"}),e.jsx("span",{className:"text-sm font-medium",children:d.ip_address})]}),(d==null?void 0:d.ip_address)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"URL"}),e.jsx("a",{href:`http://${d.ip_address}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-400 hover:text-blue-300 hover:underline",children:"Open Device"})]}),((E=a==null?void 0:a.extra_data)==null?void 0:E.current_mode)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Current Mode"}),e.jsx("span",{className:"text-sm font-medium",children:a.extra_data.current_mode})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Current Pool"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[150px]",children:(a==null?void 0:a.pool_in_use)||"â€”"})]})]})]}),e.jsxs(m,{className:"lg:col-span-2",children:[e.jsxs(b,{className:"flex flex-row items-center gap-3 pb-3",children:[e.jsx(G,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"font-semibold",children:"Live Telemetry"}),a&&e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[e.jsx(ie,{className:"h-3 w-3 inline mr-1"}),new Date(a.timestamp).toLocaleTimeString()]})]}),e.jsxs(u,{children:[K&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading telemetry..."}),V&&e.jsxs("div",{className:"flex items-center gap-3 text-red-400 p-4 bg-red-500/10 rounded-lg border border-red-500/20",children:[e.jsx(A,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:"Failed to load telemetry data"})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx(t,{label:"Hashrate",value:`${a.hashrate.toFixed(2)} ${a.hashrate_unit}`}),e.jsx(t,{label:"Temperature",value:`${a.temperature.toFixed(1)}Â°C`}),e.jsx(t,{label:"Power",value:`${a.power_watts.toFixed(1)} W`}),e.jsx(t,{label:"Accepted",value:a.shares_accepted.toString()}),e.jsx(t,{label:"Rejected",value:a.shares_rejected.toString()}),a.extra_data.uptime&&e.jsx(t,{label:"Uptime",value:Q(a.extra_data.uptime)})]})]})]})]}),a&&e.jsxs(m,{children:[e.jsx(b,{children:e.jsx("h3",{className:"font-semibold",children:"Extended Stats"})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[a.extra_data.frequency&&e.jsx(t,{label:"Frequency",value:`${a.extra_data.frequency} MHz`}),a.extra_data.voltage&&e.jsx(t,{label:"Voltage",value:`${(a.extra_data.voltage/1e3).toFixed(2)} V`}),a.extra_data.best_diff&&e.jsx(t,{label:"Best Diff",value:o(a.extra_data.best_diff)}),a.extra_data.best_session_diff&&e.jsx(t,{label:"Best Session",value:o(a.extra_data.best_session_diff)}),a.extra_data.difficulty&&e.jsx(t,{label:"Pool Difficulty",value:o(a.extra_data.difficulty)}),a.extra_data.network_difficulty&&e.jsx(t,{label:"Network Diff",value:o(a.extra_data.network_difficulty)}),a.extra_data.response_time!==void 0&&e.jsx(t,{label:"Pool Response",value:`${a.extra_data.response_time.toFixed(0)} ms`}),a.extra_data.error_percentage!==void 0&&e.jsx(t,{label:"Error Rate",value:`${a.extra_data.error_percentage.toFixed(2)}%`}),a.extra_data.wifi_rssi&&e.jsx(t,{label:"WiFi Signal",value:a.extra_data.wifi_rssi}),a.extra_data.version&&e.jsx(t,{label:"Firmware",value:a.extra_data.version}),a.extra_data.found_blocks!==void 0&&e.jsx(t,{label:"Found Blocks ðŸŽ‰",value:a.extra_data.found_blocks.toString()}),a.extra_data.hw_errors!==void 0&&e.jsx(t,{label:"HW Errors",value:a.extra_data.hw_errors.toString()}),a.extra_data.core_voltage&&e.jsx(t,{label:"Core Voltage",value:`${a.extra_data.core_voltage} mV`}),a.extra_data.core_voltage_actual&&e.jsx(t,{label:"Core V Actual",value:`${a.extra_data.core_voltage_actual} mV`}),a.extra_data.vr_temp!==void 0&&e.jsx(t,{label:"VR Temp",value:`${a.extra_data.vr_temp}Â°C`}),a.extra_data.small_core_count&&e.jsx(t,{label:"Small Cores",value:a.extra_data.small_core_count.toString()}),a.extra_data.asic_model&&e.jsx(t,{label:"ASIC Model",value:a.extra_data.asic_model}),a.extra_data.block_height&&e.jsx(t,{label:"Block Height",value:o(a.extra_data.block_height,0)}),a.extra_data.stratum_suggested_difficulty&&e.jsx(t,{label:"Stratum Diff",value:o(a.extra_data.stratum_suggested_difficulty)}),a.extra_data.free_heap&&e.jsx(t,{label:"Free Heap",value:`${(a.extra_data.free_heap/1024/1024).toFixed(1)} MB`}),a.extra_data.fan_rpm!==null&&a.extra_data.fan_rpm!==void 0&&e.jsx(t,{label:"Fan RPM",value:a.extra_data.fan_rpm.toString()})]})})]}),e.jsxs(m,{children:[e.jsxs(b,{className:"flex flex-row items-center gap-3 pb-3",children:[e.jsx(J,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"font-semibold",children:"Controls"})]}),e.jsxs(u,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(C,{children:"Operating Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{value:f,onValueChange:R,children:[e.jsx(Y,{className:"flex-1",children:e.jsx(ee,{placeholder:"Select mode..."})}),e.jsx(ae,{children:S==null?void 0:S.modes.map(s=>e.jsx(se,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsx(h,{onClick:I,disabled:!f||y.isPending,children:y.isPending?"Applying...":"Apply Mode"})]}),y.isSuccess&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx(P,{className:"h-4 w-4"}),"Mode updated successfully"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(C,{children:"Pool Selection"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:B.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border border-gray-700 hover:bg-gray-800/50 cursor-pointer transition-colors",children:[e.jsx("input",{type:"radio",name:"pool",value:s.id,checked:j===s.id,onChange:()=>T(s.id),className:"text-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-400 truncate",children:[s.url,":",s.port]})]})]},s.id))}),e.jsxs(h,{onClick:D,disabled:j===null||v.isPending,className:"w-full",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),v.isPending?"Switching...":"Switch Pool"]}),v.isSuccess&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx(P,{className:"h-4 w-4"}),"Pool switched successfully"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(C,{children:"Device Control"}),e.jsxs(h,{onClick:H,disabled:_.isPending,variant:"outline",className:"w-full gap-2 text-orange-400 hover:text-orange-300 border-orange-500/20",children:[e.jsx(re,{className:"h-4 w-4"}),_.isPending?"Restarting...":"Restart Miner"]}),_.isSuccess&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx(P,{className:"h-4 w-4"}),"Restart command sent"]})]})]})]})]}):e.jsx("div",{className:"p-6",children:e.jsx(m,{className:"border-red-500/20 bg-red-500/5",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-400",children:[e.jsx(A,{className:"h-5 w-5"}),e.jsx("p",{children:"Miner not found"})]})})})}):e.jsx("div",{className:"p-6",children:e.jsx(m,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-gray-400 border-t-transparent rounded-full"}),e.jsx("p",{children:"Loading..."})]})})})})}function t({label:r,value:w,className:c=""}){return e.jsxs("div",{className:`bg-gray-800/50 rounded-lg p-3 border border-gray-700/50 ${c}`,children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide mb-1",children:r}),e.jsx("div",{className:"font-semibold text-sm truncate",children:w})]})}export{me as default};
