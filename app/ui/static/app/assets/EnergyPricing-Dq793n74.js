import{c as $,k as G,r as f,a as g,j as e,O as R,C as p,d as m,e as b,f as y,n as Q,o as W,p as H,q as U,s as J,B as q,Q as V,U as z}from"./index-6k8Cl_mh.js";import{u as T}from"./useMutation-BCtpQNq2.js";import{P as Y}from"./plug-zap-3zmr174Y.js";import{A as Z}from"./alert-triangle-Bi4EHmMF.js";import{L}from"./loader-2-CuIrPQpo.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=$("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);async function c(t,n){const r=await fetch(t,{headers:{"Content-Type":"application/json",...(n==null?void 0:n.headers)||{}},...n});if(!r.ok){const l=await r.json().catch(()=>({})),i=l.detail||l.message||`Request failed (${r.status})`;throw new Error(i)}if(r.status!==204)return r.json()}const ee=[{value:"A",label:"A - Eastern England"},{value:"B",label:"B - East Midlands"},{value:"C",label:"C - London"},{value:"D",label:"D - Merseyside and Northern Wales"},{value:"E",label:"E - West Midlands"},{value:"F",label:"F - North Eastern England"},{value:"G",label:"G - North Western England"},{value:"H",label:"H - Southern England"},{value:"J",label:"J - South Eastern England"},{value:"K",label:"K - Southern Wales"},{value:"L",label:"L - South Western England"},{value:"M",label:"M - Yorkshire"},{value:"N",label:"N - Southern Scotland"},{value:"P",label:"P - Northern Scotland"}];function re(t,n){if(!t||!n)return"—";const r=new Date(t),l=new Date(n);return`${r.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})} → ${l.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}`}function te(t){return t<=0?{background:"linear-gradient(135deg, #60a5fa, #3b82f6)",color:"#ffffff"}:t<10?{background:"linear-gradient(135deg, #10b981, #059669)",color:"#000000"}:t<15?{background:"linear-gradient(135deg, #34d399, #10b981)",color:"#000000"}:t<20?{background:"linear-gradient(135deg, #6ee7b7, #34d399)",color:"#000000"}:t<25?{background:"linear-gradient(135deg, #fbbf24, #f59e0b)",color:"#ffffff"}:t<30?{background:"linear-gradient(135deg, #fb923c, #f97316)",color:"#ffffff"}:{background:"linear-gradient(135deg, #f87171, #ef4444)",color:"#ffffff"}}function se({enabled:t}){return t===void 0?e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs uppercase tracking-wide text-muted-foreground",children:"Loading…"}):e.jsx("span",{className:R("rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-wide",t?"bg-green-500/10 text-green-300":"bg-slate-700 text-slate-300"),children:t?"Enabled":"Disabled"})}function M({title:t,icon:n,summary:r}){var i;const l=(r==null?void 0:r.price_pence)!==null&&(r==null?void 0:r.price_pence)!==void 0;return e.jsxs(p,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:t}),e.jsx(b,{className:"text-3xl font-semibold",children:l?`${(i=r==null?void 0:r.price_pence)==null?void 0:i.toFixed(2)} p/kWh`:"No data"})]}),e.jsx(n,{className:"h-10 w-10 text-blue-300"})]}),e.jsx(y,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:l?re(r==null?void 0:r.valid_from,r==null?void 0:r.valid_to):"Waiting for latest slot"})})]})}function K({title:t,data:n}){const r=new Date,l=((n==null?void 0:n.prices)||[]).filter(i=>new Date(i.valid_to)>r);return e.jsxs(p,{className:"overflow-hidden",children:[e.jsxs(m,{className:"space-y-1 border-b border-border/50 bg-muted/10",children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-blue-300",children:t}),e.jsx(b,{className:"text-lg",children:(n==null?void 0:n.date)??"Waiting for Octopus data"})]}),e.jsx(y,{className:"p-6",children:l.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No upcoming half-hour slots yet."}):e.jsx("div",{className:"grid gap-2 md:grid-cols-3 lg:grid-cols-4",children:l.map(i=>{const s=te(i.price_pence),d=new Date(i.valid_from),u=d.toLocaleDateString("en-GB",{weekday:"short"}),x=d.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"rounded-lg p-3 text-center shadow-sm",style:{background:s.background,color:s.color},children:[e.jsx("p",{className:"text-xs opacity-80",children:`${u} ${x}`}),e.jsxs("p",{className:"text-lg font-semibold",children:[i.price_pence.toFixed(2),"p"]})]},i.valid_from)})})})]})}function de(){var S,E,C,P;const t=G(),[n,r]=f.useState(null),[l,i]=f.useState("H"),{data:s,isLoading:d,error:u}=g({queryKey:["energy-config"],queryFn:()=>c("/api/dashboard/energy/config"),refetchInterval:6e4}),{data:x,error:_}=g({queryKey:["energy-current"],queryFn:()=>c("/api/dashboard/energy/current"),refetchInterval:6e4}),{data:D,error:F}=g({queryKey:["energy-next"],queryFn:()=>c("/api/dashboard/energy/next"),refetchInterval:6e4}),{data:o,error:B}=g({queryKey:["energy-timeline"],queryFn:()=>c("/api/dashboard/energy/timeline"),refetchInterval:6e4});f.useEffect(()=>{s!=null&&s.region&&i(s.region)},[s==null?void 0:s.region]);const j=T({mutationFn:a=>c(`/api/dashboard/energy/region?region=${a}`,{method:"POST"}),onSuccess:(a,h)=>{r({type:"success",message:`Region saved: ${h}. Fetching latest slots…`}),t.invalidateQueries({queryKey:["energy-config"]}),t.invalidateQueries({queryKey:["energy-current"]}),t.invalidateQueries({queryKey:["energy-next"]}),t.invalidateQueries({queryKey:["energy-timeline"]})},onError:a=>{r({type:"error",message:a.message})}}),v=T({mutationFn:a=>c(`/api/dashboard/energy/toggle?enabled=${String(a)}`,{method:"POST"}),onSuccess:(a,h)=>{r({type:"success",message:h?"Energy pricing enabled.":"Energy pricing disabled."}),t.invalidateQueries({queryKey:["energy-config"]})},onError:a=>r({type:"error",message:a.message})}),N=[u,_,F,B].filter(Boolean),w=j.isPending,k=v.isPending,O=l!==(s==null?void 0:s.region),A=()=>{l&&j.mutate(l)},I=()=>{d||s===void 0||v.mutate(!s.enabled)};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm uppercase tracking-widest text-blue-300",children:[e.jsx(Y,{className:"h-5 w-5"}),e.jsx("span",{children:"Energy Pricing"})]}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Octopus Agile Pricing"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Configure your UK Agile region, review current and upcoming half-hour slots, and keep automation rules aligned with live tariffs."})]}),n&&e.jsx("div",{className:R("rounded-md border px-4 py-3 text-sm",n.type==="success"?"border-green-500/40 bg-green-500/10 text-green-200":"border-red-500/40 bg-red-500/10 text-red-200"),children:n.message}),N.length>0&&e.jsxs("div",{className:"flex items-center gap-3 rounded-md border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:N.map(a=>a instanceof Error?a.message:"Unable to load energy pricing").join(" • ")})]}),e.jsxs(p,{children:[e.jsxs(m,{className:"flex flex-col gap-4 border-b border-border/50 bg-muted/10 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-blue-300",children:"Configuration"}),e.jsx(b,{className:"text-xl",children:"Octopus Agile Region"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Half-hourly prices refresh every 30 minutes."})]}),e.jsx(se,{enabled:s==null?void 0:s.enabled})]}),e.jsxs(y,{className:"space-y-6 py-6",children:[e.jsx("div",{className:"rounded-md border border-amber-300/40 bg-amber-500/5 p-4 text-sm text-amber-200",children:"⚡ UK Octopus Agile customers only. Prices sourced from the official Agile Flex endpoint with no API key required."}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[2fr,1fr]",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",htmlFor:"region-select",children:"Select Region"}),e.jsxs(Q,{value:l,onValueChange:i,children:[e.jsx(W,{id:"region-select",className:"h-12 text-left",children:e.jsx(H,{placeholder:"Choose region"})}),e.jsx(U,{children:ee.map(a=>e.jsx(J,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-end",children:[e.jsx(q,{onClick:A,disabled:w||!O||d,className:"flex-1",children:w?e.jsx(L,{className:"h-4 w-4 animate-spin"}):"Save Region"}),e.jsx(q,{onClick:I,variant:s!=null&&s.enabled?"destructive":"secondary",disabled:k||d,className:"flex-1",children:k?e.jsx(L,{className:"h-4 w-4 animate-spin"}):s!=null&&s.enabled?"Disable Pricing":"Enable Pricing"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(M,{title:"Current Slot",icon:V,summary:x}),e.jsx(M,{title:"Next Slot",icon:z,summary:D})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm uppercase tracking-widest text-blue-300",children:[e.jsx(X,{className:"h-5 w-5"}),e.jsx("span",{children:"Upcoming Timeline"})]}),e.jsx(K,{title:"Today",data:{date:(S=o==null?void 0:o.today)==null?void 0:S.date,prices:(E=o==null?void 0:o.today)==null?void 0:E.prices}}),e.jsx(K,{title:"Tomorrow",data:{date:(C=o==null?void 0:o.tomorrow)==null?void 0:C.date,prices:(P=o==null?void 0:o.tomorrow)==null?void 0:P.prices}})]})]})}export{de as default};
