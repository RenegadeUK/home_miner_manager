import{c as g,l as F,r as i,a as q,j as e,Z as D,B as o,U as m,C as p,f as u,d as $,_ as O}from"./index-Ck7jEKe2.js";import{u as N}from"./useMutation-VQTUAiOn.js";import{h as z}from"./textFormatters-NadoA3a2.js";import{R as K}from"./refresh-ccw-CocuJVza.js";import{A as Q}from"./alert-triangle-CQwQaDpD.js";import{L as B}from"./loader-2-D2b0CBn8.js";import{C as J}from"./check-circle-2-uUDoeiwQ.js";import{T as U}from"./trash-2-DtTIxnXw.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=g("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=g("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=g("PauseCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=g("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);async function h(n,t){const l=await fetch(n,{headers:{"Content-Type":"application/json",...(t==null?void 0:t.headers)||{}},...t});if(!l.ok){const c=await l.json().catch(()=>({})),y=c.detail||c.message||`Request failed (${l.status})`;throw new Error(y)}if(l.status!==204)return l.json()}const V={price_threshold:"Energy Price Threshold",time_window:"Time Window",miner_overheat:"Miner Overheat"},W={apply_mode:"Apply Miner Mode",switch_pool:"Switch Pool",send_alert:"Send Alert",log_event:"Log Event"};function k(n,t){return n[t]||z(t)}function le(){const n=F(),[t,l]=i.useState("all"),[c,y]=i.useState(""),[E,R]=i.useState(new Set),[j,d]=i.useState(null),{data:x=[],isLoading:T,error:f}=q({queryKey:["automation-rules"],queryFn:()=>h("/api/automation/"),refetchInterval:6e4}),v=N({mutationFn:({id:s,enabled:a})=>h(`/api/automation/${s}`,{method:"PUT",body:JSON.stringify({enabled:a})}),onSuccess:(s,a)=>{d({type:"success",message:a.enabled?"Rule enabled":"Rule paused"}),n.invalidateQueries({queryKey:["automation-rules"]})},onError:s=>d({type:"error",message:s.message})}),w=N({mutationFn:s=>h(`/api/automation/${s}/duplicate`,{method:"POST"}),onSuccess:s=>{d({type:"success",message:`Duplicated as ${s.name}`}),n.invalidateQueries({queryKey:["automation-rules"]})},onError:s=>d({type:"error",message:s.message})}),C=N({mutationFn:s=>h(`/api/automation/${s}`,{method:"DELETE"}),onSuccess:()=>{d({type:"success",message:"Rule deleted"}),n.invalidateQueries({queryKey:["automation-rules"]})},onError:s=>d({type:"error",message:s.message})}),S=i.useMemo(()=>{const s=c.trim().toLowerCase();return[...x].filter(a=>t==="enabled"&&!a.enabled||t==="paused"&&a.enabled?!1:s?a.name.toLowerCase().includes(s)||a.trigger_type.toLowerCase().includes(s)||a.action_type.toLowerCase().includes(s):!0).sort((a,r)=>a.priority-r.priority)},[x,t,c]),b=i.useMemo(()=>{const s=x.length,a=x.filter(M=>M.enabled).length,r=s-a;return{total:s,enabled:a,paused:r}},[x]),_=s=>{R(a=>{const r=new Set(a);return r.has(s)?r.delete(s):r.add(s),r})},A=s=>{const a=!s.enabled,r=a?"enable":"pause";window.confirm(`Are you sure you want to ${r} "${s.name}"?`)&&v.mutate({id:s.id,enabled:a})},P=s=>{w.mutate(s.id)},L=s=>{window.confirm(`Delete "${s.name}"? This cannot be undone.`)&&C.mutate(s.id)};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm uppercase tracking-widest text-blue-300",children:[e.jsx(D,{className:"h-5 w-5"}),e.jsx("span",{children:"Automation"})]}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Automation Rules"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create deterministic responses to price events, miner health issues, and pool failures. Each rule executes in priority order."}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-4",children:[e.jsxs(o,{className:"flex items-center gap-2",onClick:()=>window.location.href="/automation/add",children:[e.jsx(H,{className:"h-4 w-4"}),"Add Rule"]}),e.jsxs(o,{variant:"outline",className:"flex items-center gap-2",onClick:()=>n.invalidateQueries({queryKey:["automation-rules"]}),children:[e.jsx(K,{className:"h-4 w-4"}),"Refresh"]})]})]}),j&&e.jsx("div",{className:m("rounded-md border px-4 py-3 text-sm",j.type==="success"?"border-green-500/40 bg-green-500/10 text-green-200":"border-red-500/40 bg-red-500/10 text-red-200"),children:j.message}),f&&e.jsxs("div",{className:"flex items-center gap-3 rounded-md border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:f instanceof Error?f.message:"Unable to load rules"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(p,{children:e.jsxs(u,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Rules"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold",children:b.total})]})}),e.jsx(p,{children:e.jsxs(u,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Enabled"}),e.jsxs("div",{className:"mt-2 flex items-baseline gap-2",children:[e.jsx("p",{className:"text-2xl font-semibold text-green-300",children:b.enabled}),e.jsx("span",{className:"text-sm text-gray-500",children:"active"})]})]})}),e.jsx(p,{children:e.jsxs(u,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Paused"}),e.jsxs("div",{className:"mt-2 flex items-baseline gap-2",children:[e.jsx("p",{className:"text-2xl font-semibold text-amber-300",children:b.paused}),e.jsx("span",{className:"text-sm text-gray-500",children:"waiting"})]})]})})]}),e.jsxs(p,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Rules"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Search, filter, and inspect trigger/action details."})]}),e.jsxs("div",{className:"flex w-full flex-col gap-3 md:flex-row md:items-center md:justify-end",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(I,{className:"h-4 w-4"}),"Status"]}),e.jsx("div",{className:"flex rounded-md border border-gray-800 bg-gray-900/40",children:[{label:"All",value:"all"},{label:"Enabled",value:"enabled"},{label:"Paused",value:"paused"}].map(s=>e.jsx("button",{onClick:()=>l(s.value),className:m("px-3 py-1 text-sm font-medium transition-colors",t===s.value?"bg-blue-500/20 text-blue-200":"text-gray-400 hover:text-gray-200"),children:s.label},s.value))}),e.jsx("input",{type:"search",value:c,onChange:s=>y(s.target.value),placeholder:"Search name, trigger, actionâ€¦",className:"w-full rounded-md border border-gray-800 bg-gray-950 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40 md:w-64"})]})]})}),e.jsx(u,{children:T?e.jsx("div",{className:"flex min-h-[280px] items-center justify-center text-gray-400",children:e.jsx(B,{className:"h-5 w-5 animate-spin"})}):S.length===0?e.jsxs("div",{className:"rounded-md border border-dashed border-gray-800 p-8 text-center",children:[e.jsx("p",{className:"text-gray-300 font-medium",children:"No rules match your filters"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Create a rule or adjust the search criteria."}),e.jsx(o,{className:"mt-4",onClick:()=>window.location.href="/automation/add",children:"Create Rule"})]}):e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-800",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-950/70 text-left text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Rule"}),e.jsx("th",{className:"px-4 py-3",children:"Trigger"}),e.jsx("th",{className:"px-4 py-3",children:"Action"}),e.jsx("th",{className:"px-4 py-3",children:"Priority"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:S.map(s=>{const a=E.has(s.id);return e.jsxs(i.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-900/60",children:[e.jsxs("td",{className:"px-4 py-3 text-gray-200",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs("button",{className:"mt-1 flex items-center gap-1 text-xs text-blue-300",onClick:()=>_(s.id),children:[e.jsx(O,{className:m("h-3.5 w-3.5 transition-transform",a&&"rotate-180")}),"Details"]})]}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:k(V,s.trigger_type)}),e.jsx("td",{className:"px-4 py-3 text-gray-400",children:k(W,s.action_type)}),e.jsxs("td",{className:"px-4 py-3 text-gray-300",children:["#",s.priority]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:m("rounded-full px-2 py-0.5 text-xs font-semibold",s.enabled?"bg-green-500/10 text-green-300":"bg-gray-700/40 text-gray-400"),children:s.enabled?"Enabled":"Paused"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(o,{variant:"secondary",size:"sm",className:"flex items-center gap-1",onClick:()=>A(s),disabled:v.isPending,children:s.enabled?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4"})," Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4"})," Enable"]})}),e.jsxs(o,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:()=>P(s),disabled:w.isPending,children:[e.jsx(G,{className:"h-4 w-4"})," Duplicate"]}),e.jsxs(o,{variant:"destructive",size:"sm",className:"flex items-center gap-1",onClick:()=>L(s),disabled:C.isPending,children:[e.jsx(U,{className:"h-4 w-4"})," Delete"]})]})})]}),a&&e.jsx("tr",{className:"border-t border-gray-900/60",children:e.jsx("td",{colSpan:6,className:"bg-gray-950/40 px-4 py-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded border border-gray-800 bg-gray-900/40 p-3",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Trigger Config"}),e.jsx("pre",{className:"mt-2 max-h-48 overflow-auto text-xs text-gray-300",children:JSON.stringify(s.trigger_config??{},null,2)})]}),e.jsxs("div",{className:"rounded border border-gray-800 bg-gray-900/40 p-3",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Action Config"}),e.jsx("pre",{className:"mt-2 max-h-48 overflow-auto text-xs text-gray-300",children:JSON.stringify(s.action_config??{},null,2)})]})]})})})]},s.id)})})]})})})]})]})}export{le as default};
