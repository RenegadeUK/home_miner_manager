import{c as v,a as l,j as e,Z as N,D as y,A as h,T as b}from"./index-1J6msMy7.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=v("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);function F(){var x;const{data:a}=l({queryKey:["dashboard-all-asic"],queryFn:async()=>{const s=await fetch("/api/dashboard/all?dashboard_type=asic");if(!s.ok)throw new Error("Failed to fetch dashboard data");return s.json()},refetchInterval:1e4}),{data:d}=l({queryKey:["health-all-analytics"],queryFn:async()=>{const s=await fetch("/api/health/all");if(!s.ok)throw new Error("Failed to fetch health data");return s.json()},refetchInterval:3e4}),{data:o}=l({queryKey:["analytics-historic-24h"],queryFn:async()=>{if(!(a!=null&&a.miners))return[];const s=a.miners.map(async r=>{try{const n=await fetch(`/api/analytics/miners/${r.id}/telemetry/stats?hours=24`);if(!n.ok)return null;const j=await n.json();return{miner_id:r.id,miner_name:r.name,...j}}catch{return null}});return(await Promise.all(s)).filter(r=>r!==null&&r.data_points>0)},enabled:!!(a!=null&&a.miners),refetchInterval:6e4}),t=a==null?void 0:a.stats,u=s=>s<50?"text-green-600":s<100?"text-yellow-600":"text-red-600",f=s=>s<50?"bg-green-100":s<100?"bg-yellow-100":"bg-red-100",g=s=>{switch(s){case"critical":return"bg-red-100 text-red-800";case"warning":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}},p=s=>new Date(s).toLocaleString("en-GB",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),m=o?[...o].filter(s=>s.avg_hashrate>0&&s.avg_power>0&&s.data_points>10).map(s=>({...s,efficiency_wth:s.avg_power/(s.avg_hashrate/1e3)})).sort((s,i)=>(s.efficiency_wth||0)-(i.efficiency_wth||0)):[],c=((x=d==null?void 0:d.miners)==null?void 0:x.filter(s=>s.has_issues))||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Analytics"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg border bg-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(N,{className:"h-4 w-4"}),"Total Power"]}),e.jsxs("div",{className:"mt-2 text-2xl font-bold",children:[(t==null?void 0:t.total_power_watts.toFixed(0))??"-"," W"]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[(t==null?void 0:t.online_miners)??0," / ",(t==null?void 0:t.total_miners)??0," miners online",(t==null?void 0:t.online_miners)===0?" (OFF due to pricing)":""]})]}),e.jsxs("div",{className:"rounded-lg border bg-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(y,{className:"h-4 w-4"}),"24h Cost"]}),e.jsxs("div",{className:"mt-2 text-2xl font-bold",children:["Â£",(t==null?void 0:t.total_cost_24h_pounds.toFixed(2))??"-"]}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"ASIC miners only"})]}),e.jsxs("div",{className:"rounded-lg border bg-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(w,{className:"h-4 w-4"}),"Avg Efficiency"]}),e.jsxs("div",{className:"mt-2 text-2xl font-bold",children:[t!=null&&t.avg_efficiency_wth?t.avg_efficiency_wth.toFixed(1):"-"," W/TH"]}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Fleet average"})]}),e.jsxs("div",{className:"rounded-lg border bg-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(h,{className:"h-4 w-4"}),"Alerts"]}),e.jsx("div",{className:"mt-2 text-2xl font-bold",children:c.length}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Miners with issues"})]})]}),e.jsxs("div",{className:"rounded-lg border bg-card",children:[e.jsxs("div",{className:"border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Efficiency Leaderboard (W/TH) - Last 24 Hours"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Based on 24h average performance. Lower is better."})]}),e.jsx("div",{className:"p-4",children:m.length>0?e.jsx("div",{className:"space-y-3",children:m.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-muted font-bold text-muted-foreground",children:i+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.miner_name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.avg_hashrate.toFixed(2)," ",s.hashrate_unit," Â· ",s.avg_power.toFixed(0),"W Â· ",s.uptime_percent.toFixed(0),"% uptime"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`rounded-full px-3 py-1 text-sm font-semibold ${f(s.efficiency_wth)} ${u(s.efficiency_wth)}`,children:[s.efficiency_wth.toFixed(1)," W/TH"]}),i===0&&e.jsx(b,{className:"h-5 w-5 text-green-600"})]})]},s.miner_id))}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"text-muted-foreground mb-2",children:"No historic data available yet"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Miners need to run for a while to collect 24h performance data"})]})})]}),e.jsxs("div",{className:"rounded-lg border bg-card",children:[e.jsxs("div",{className:"border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Current Health Issues"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Miners with detected anomalies"})]}),e.jsx("div",{className:"p-4",children:c.length>0?e.jsx("div",{className:"space-y-3",children:c.map((s,i)=>e.jsx("div",{className:"rounded-lg border p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.miner_name}),e.jsx("span",{className:"text-sm text-muted-foreground",children:p(s.timestamp)})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm",children:["Health: ",e.jsx("span",{className:"font-semibold",children:s.health_score})]}),s.anomaly_score!==null&&e.jsxs("span",{className:"text-sm",children:["Anomaly: ",e.jsx("span",{className:"font-semibold",children:s.anomaly_score.toFixed(2)})]})]}),s.reasons&&s.reasons.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:s.reasons.map((r,n)=>e.jsxs("div",{className:`inline-flex items-center gap-2 rounded px-2 py-1 text-sm ${g(r.severity)} mr-2`,children:[e.jsx(h,{className:"h-3 w-3"}),e.jsx("span",{className:"font-medium",children:r.code.replace(/_/g," ")}),r.metric&&r.actual!==void 0&&e.jsxs("span",{className:"text-xs",children:[r.metric,": ",r.actual,r.expected_min!==void 0&&r.expected_max!==void 0&&` (expected: ${r.expected_min}-${r.expected_max})`,r.unit&&` ${r.unit}`]})]},n))})]})})},`${s.miner_id}-${i}`))}):e.jsx("div",{className:"py-8 text-center",children:e.jsx("div",{className:"text-muted-foreground",children:(t==null?void 0:t.online_miners)===0?"All miners are OFF due to high electricity prices (no telemetry available)":"All systems healthy! ðŸŽ‰"})})})]})]})}export{F as Analytics};
