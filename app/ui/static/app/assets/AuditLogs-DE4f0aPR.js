import{c as L,r as o,a as j,j as e,O as R,C as A,d as T,e as E,B as i,f as F,ac as z,A as B,U as N,ae as g}from"./index-Ck7jEKe2.js";import{L as P}from"./loader-2-D2b0CBn8.js";import{R as M}from"./refresh-ccw-CocuJVza.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=L("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),I=[{label:"All resources",value:""},{label:"Miner",value:"miner"},{label:"Pool",value:"pool"},{label:"Strategy",value:"strategy"},{label:"Automation",value:"automation"},{label:"Discovery",value:"discovery"},{label:"Profile",value:"profile"}],U=[{label:"All actions",value:""},{label:"Create",value:"create"},{label:"Update",value:"update"},{label:"Delete",value:"delete"},{label:"Execute",value:"execute"},{label:"Enable",value:"enable"},{label:"Disable",value:"disable"}],q=[{label:"Last 24 hours",value:1},{label:"Last 7 days",value:7},{label:"Last 30 days",value:30},{label:"Last 90 days",value:90}];function X(){const[s,r]=o.useState(""),[t,d]=o.useState(""),[l,u]=o.useState(7),[w,h]=o.useState(null),n=j({queryKey:["audit-logs",s,t,l],queryFn:()=>g.getLogs({resourceType:s||void 0,action:t||void 0,days:l,limit:250})}),C=j({queryKey:["audit-stats",l],queryFn:()=>g.getStats(l)}),m=n.data??[],a=C.data,S=o.useMemo(()=>b(a==null?void 0:a.by_action),[a==null?void 0:a.by_action]),k=o.useMemo(()=>b(a==null?void 0:a.by_resource_type),[a==null?void 0:a.by_resource_type]),_=o.useMemo(()=>b(a==null?void 0:a.by_user),[a==null?void 0:a.by_user]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(R,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"Audit Logs"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Trace configuration changes, automation actions, and system activity. Use the filters to narrow down specific resources or actions."})]}),e.jsx(D,{stats:a,topAction:S,topResource:k,topUser:_}),e.jsxs(A,{className:"border-border/60 bg-muted/5",children:[e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx(E,{className:"text-lg",children:"Filters"}),e.jsxs(i,{variant:"secondary",size:"sm",onClick:()=>n.refetch(),disabled:n.isFetching,children:[n.isFetching?e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(M,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(p,{label:"Resource type",value:s,onChange:r,options:I}),e.jsx(p,{label:"Action",value:t,onChange:d,options:U}),e.jsx(p,{label:"Time range",value:String(l),onChange:c=>u(Number(c)),options:q.map(c=>({label:c.label,value:String(c.value)}))}),e.jsx("div",{className:"flex items-end",children:e.jsx(i,{type:"button",variant:"ghost",className:"w-full justify-center",onClick:()=>{r(""),d(""),u(7)},disabled:!s&&!t&&l===7,children:"Reset"})})]})]}),e.jsxs(F,{className:"space-y-4",children:[n.isError&&e.jsx(G,{message:"Failed to load audit logs.",onRetry:()=>n.refetch()}),n.isLoading&&e.jsx(H,{count:6}),!n.isLoading&&!n.isError&&m.length===0&&e.jsx(J,{icon:e.jsx(z,{className:"h-6 w-6"}),message:"No audit events match the current filters."}),!n.isLoading&&!n.isError&&m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(V,{logs:m,onViewChanges:h})}),e.jsx("div",{className:"space-y-3 lg:hidden",children:m.map(c=>e.jsx(Q,{log:c,onViewChanges:h},c.id))})]})]})]}),e.jsx(K,{log:w,onClose:()=>h(null)})]})}function D({stats:s,topAction:r,topResource:t,topUser:d}){var u;const l=s?`${s.success_rate.toFixed(1)}%`:"—";return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsx(x,{label:"Total events",value:((u=s==null?void 0:s.total_events)==null?void 0:u.toLocaleString())??"—"}),e.jsx(x,{label:"Success rate",value:l}),e.jsx(x,{label:"Most common action",value:r??"—",subtle:"From selected window"}),e.jsx(x,{label:"Most referenced resource",value:t??"—",subtle:"Based on by_resource"}),e.jsx(x,{label:"Busiest actor",value:d??"—",subtle:"Based on by_user counts"})]})}function x({label:s,value:r,subtle:t}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-muted/5 p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),e.jsx("p",{className:"text-xl font-semibold leading-tight text-foreground break-words",children:r}),t&&e.jsx("p",{className:"text-[0.7rem] text-muted-foreground",children:t})]})}function p({label:s,value:r,onChange:t,options:d}){return e.jsxs("label",{className:"text-sm text-muted-foreground",children:[e.jsx("span",{className:"mb-1 block text-xs uppercase tracking-wide",children:s}),e.jsx("select",{value:r,onChange:l=>t(l.target.value),className:"w-full rounded-xl border border-border/60 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",children:d.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value||"all"))})]})}function V({logs:s,onViewChanges:r}){return e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border/60",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/10 text-xs uppercase tracking-wide text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Timestamp"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Action"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Resource"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"IP"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Changes"})]})}),e.jsx("tbody",{children:s.map(t=>e.jsxs("tr",{className:"border-t border-border/50",children:[e.jsx("td",{className:"px-4 py-3 align-top text-muted-foreground",children:f(t.timestamp)}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsx(y,{action:t.action})}),e.jsxs("td",{className:"px-4 py-3 align-top",children:[e.jsx("div",{className:"font-semibold text-foreground capitalize",children:t.resource_type||"system"}),t.resource_name&&e.jsx("div",{className:"text-xs text-muted-foreground",children:t.resource_name})]}),e.jsx("td",{className:"px-4 py-3 align-top text-foreground",children:t.user}),e.jsx("td",{className:"px-4 py-3 align-top text-muted-foreground",children:t.ip_address||"—"}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsx(v,{status:t.status})}),e.jsx("td",{className:"px-4 py-3 align-top",children:t.changes?e.jsx(i,{variant:"link",className:"px-0",onClick:()=>r(t),children:"View"}):e.jsx("span",{className:"text-muted-foreground",children:"—"})})]},t.id))})]})})}function Q({log:s,onViewChanges:r}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-background/60 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s.user}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f(s.timestamp)})]}),e.jsx(y,{action:s.action})]}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm",children:[e.jsxs("p",{className:"text-muted-foreground",children:[e.jsx("span",{className:"text-foreground",children:"Resource:"})," ",s.resource_type,s.resource_name&&e.jsxs("span",{className:"text-muted-foreground",children:[" · ",s.resource_name]})]}),e.jsxs("p",{className:"text-muted-foreground",children:[e.jsx("span",{className:"text-foreground",children:"Status:"})," ",e.jsx(v,{status:s.status})]}),e.jsxs("p",{className:"text-muted-foreground",children:[e.jsx("span",{className:"text-foreground",children:"IP:"})," ",s.ip_address||"—"]}),s.error_message&&e.jsx("p",{className:"text-xs text-red-300",children:s.error_message})]}),s.changes&&e.jsxs(i,{variant:"ghost",className:"mt-3 w-full justify-between",onClick:()=>r(s),children:["View changes",e.jsx(O,{className:"h-4 w-4"})]})]})}function y({action:s}){const r=s==="create"?"bg-emerald-500/20 text-emerald-200":s==="update"?"bg-blue-500/20 text-blue-200":s==="delete"?"bg-red-500/20 text-red-200":s==="execute"?"bg-amber-500/20 text-amber-100":s==="enable"?"bg-purple-500/20 text-purple-200":"bg-slate-500/20 text-slate-200";return e.jsx("span",{className:N("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold capitalize",r),children:s||"unknown"})}function v({status:s}){const t=(s||"").toLowerCase()==="failure"?"bg-red-500/20 text-red-200":"bg-emerald-500/20 text-emerald-200";return e.jsx("span",{className:N("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold capitalize",t),children:s||"unknown"})}function K({log:s,onClose:r}){return s!=null&&s.changes?e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 p-4",role:"dialog","aria-modal":"true",onClick:r,children:e.jsxs("div",{className:"max-h-[80vh] w-full max-w-2xl overflow-y-auto rounded-2xl border border-border/60 bg-background p-6",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:"Change details"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f(s.timestamp)})]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:r,children:"Close"})]}),e.jsx("pre",{className:"max-h-[60vh] overflow-auto rounded-xl bg-muted/10 px-4 py-3 text-xs text-muted-foreground",children:JSON.stringify(s.changes,null,2)})]})}):null}function G({message:s,onRetry:r}){return e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:s})]}),e.jsx(i,{variant:"secondary",size:"sm",onClick:r,children:"Retry"})]})}function H({count:s}){return e.jsx("div",{className:"space-y-3",children:Array.from({length:s}).map((r,t)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted/20"},t))})}function J({icon:s,message:r}){return e.jsxs("div",{className:"flex flex-col items-center gap-3 rounded-2xl border border-dashed border-border/60 bg-background/40 p-8 text-center text-sm text-muted-foreground",children:[e.jsx("div",{className:"rounded-full border border-border/50 p-3 text-foreground",children:s}),e.jsx("p",{className:"text-base font-semibold text-foreground",children:"Nothing to show"}),e.jsx("p",{children:r})]})}function f(s){const r=new Date(s);return Number.isNaN(r.getTime())?s:r.toLocaleString()}function b(s){if(!s)return null;const r=Object.entries(s).sort((t,d)=>d[1]-t[1]);return r.length>0?r[0][0]:null}export{X as default};
