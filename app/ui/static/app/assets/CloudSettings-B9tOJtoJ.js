import{c as R,l as F,r as m,a as T,j as e,U as x,a1 as M,C as p,d as b,e as f,f as h,B as y,R as H,a2 as q,a3 as j}from"./index-Ck7jEKe2.js";import{u as w}from"./useMutation-VQTUAiOn.js";import{C as B}from"./check-circle-2-uUDoeiwQ.js";import{A as E}from"./alert-triangle-CQwQaDpD.js";import{L as k}from"./loader-2-D2b0CBn8.js";import{I as U}from"./info-CpISnL4H.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=R("UploadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]),_=[{label:"Staging (stage-ingest.miningpool.uk)",value:"https://stage-ingest.miningpool.uk/ingest"},{label:"Production (cloud-ingest.miningpool.uk)",value:"https://cloud-ingest.miningpool.uk/ingest"},{label:"Local development",value:"http://localhost:8082/ingest"}],D={enabled:!1,apiKey:"",endpoint:_[0].value,installationName:"My Home Mining Setup",installationLocation:"",pushIntervalMinutes:5};function X(){const i=F(),[n,o]=m.useState(D),[I,d]=m.useState(null),[c,S]=m.useState(null),u=T({queryKey:["cloud-config"],queryFn:j.getConfig}),t=u.data;m.useEffect(()=>{t&&o(s=>({...s,enabled:t.enabled,endpoint:t.endpoint,installationName:t.installation_name,installationLocation:t.installation_location??"",pushIntervalMinutes:t.push_interval_minutes,apiKey:""}))},[t]);const l=(s,a)=>{S({tone:s,message:a}),setTimeout(()=>S(null),5e3)},g=s=>{if(s instanceof q){if(s.data&&typeof s.data=="object"){const a=s.data.detail;if(typeof a=="string")return a}return s.message}return s instanceof Error?s.message:"Something went wrong"},N=w({mutationFn:s=>j.updateConfig(s),onSuccess:s=>{l("success",s.message||"Cloud configuration saved"),i.invalidateQueries({queryKey:["cloud-config"]}),o(a=>({...a,apiKey:""}))},onError:s=>{l("error",g(s))}}),v=w({mutationFn:()=>j.testConnection(),onSuccess:s=>{l(s.success?"success":"error",s.message||"Connection test completed")},onError:s=>l("error",g(s))}),C=w({mutationFn:()=>j.manualPush(),onSuccess:s=>{const a=s.status==="success"?"success":"error";l(a,s.message||"Manual push triggered")},onError:s=>l("error",g(s))}),r=s=>a=>{o(K=>({...K,[s]:a}))},A=s=>{if(s.preventDefault(),d(null),!n.installationName.trim()){d("Installation name is required");return}if(!n.endpoint.trim()){d("Cloud endpoint is required");return}if(n.pushIntervalMinutes<1||n.pushIntervalMinutes>60){d("Push interval must be between 1 and 60 minutes");return}if(n.enabled&&!n.apiKey.trim()){d("Enter your API key to enable cloud sync");return}const a={enabled:n.enabled,api_key:n.apiKey.trim()?n.apiKey.trim():null,endpoint:n.endpoint.trim(),installation_name:n.installationName.trim(),installation_location:n.installationLocation.trim()||null,push_interval_minutes:n.pushIntervalMinutes};N.mutate(a)},L=m.useMemo(()=>{if(!t)return null;const s=t.enabled;return e.jsxs("span",{className:x("inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold",s?"bg-emerald-500/15 text-emerald-300":"bg-amber-500/15 text-amber-200"),children:[s?e.jsx(B,{className:"h-4 w-4"}):e.jsx(E,{className:"h-4 w-4"}),s?"Enabled":"Disabled"]})},[t]);return u.isLoading?e.jsx(Q,{}):u.isError?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-2xl font-semibold",children:[e.jsx(M,{className:"h-8 w-8 text-blue-400"}),"Cloud Settings"]}),e.jsx(z,{message:g(u.error),onRetry:()=>u.refetch()})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(M,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"Cloud Settings"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Push telemetry to HMM Cloud Aggregator and monitor every installation from one centralized dashboard."})]}),c&&e.jsx("div",{className:x("rounded-xl border px-4 py-3 text-sm",c.tone==="success"&&"border-emerald-500/40 bg-emerald-500/10 text-emerald-100",c.tone==="error"&&"border-red-500/40 bg-red-500/10 text-red-100",c.tone==="info"&&"border-blue-500/40 bg-blue-500/10 text-blue-100"),children:c.message}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.5fr,1fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsx(b,{children:e.jsxs(f,{className:"flex items-center gap-3 text-lg",children:[e.jsx(P,{className:"h-5 w-5 text-blue-300"})," Connection status"]})}),e.jsxs(h,{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t!=null&&t.enabled?"Cloud sync enabled":"Cloud sync disabled"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t!=null&&t.enabled?`Telemetry pushes every ${(t==null?void 0:t.push_interval_minutes)??5} minutes`:"Enable to begin pushing miner telemetry to HMM Cloud"})]}),L]}),e.jsxs("dl",{className:"grid gap-4 text-sm md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Endpoint"}),e.jsx("dd",{className:"font-semibold text-foreground",children:t==null?void 0:t.endpoint})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Push interval"}),e.jsxs("dd",{className:"font-semibold text-foreground",children:[t==null?void 0:t.push_interval_minutes," min"]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Installation name"}),e.jsx("dd",{className:"font-semibold text-foreground",children:t==null?void 0:t.installation_name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"API key"}),e.jsx("dd",{className:"font-semibold text-foreground",children:t!=null&&t.api_key?"Stored securely":"Not configured"})]})]})]})]}),e.jsxs(p,{children:[e.jsx(b,{children:e.jsx(f,{className:"text-lg",children:"Configuration"})}),e.jsx(h,{children:e.jsxs("form",{className:"space-y-6",onSubmit:A,children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 rounded-xl border border-border/60 bg-muted/5 px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Enable cloud sync"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"When enabled, miner telemetry and events are pushed to the selected endpoint."})]}),e.jsx("button",{type:"button",onClick:()=>r("enabled")(!n.enabled),className:x("flex h-6 w-12 items-center rounded-full border border-border px-0.5 transition-colors",n.enabled?"bg-blue-500/80 border-blue-400":"bg-gray-800"),"aria-pressed":n.enabled,children:e.jsx("span",{className:x("h-5 w-5 rounded-full bg-white shadow transition-transform",n.enabled?"translate-x-6":"translate-x-0")})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"API key"}),e.jsx("input",{type:"password",value:n.apiKey,onChange:s=>r("apiKey")(s.target.value),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"sk_live_xxx"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"API keys are never shown. Re-enter the key whenever you update settings."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Endpoint URL"}),e.jsx("input",{type:"text",value:n.endpoint,onChange:s=>r("endpoint")(s.target.value),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"https://stage-ingest.miningpool.uk/ingest"}),e.jsx("div",{className:"flex flex-wrap gap-2 pt-1",children:_.map(s=>e.jsx("button",{type:"button",onClick:()=>r("endpoint")(s.value),className:x("rounded-full border px-3 py-1 text-xs font-medium transition-colors",n.endpoint===s.value?"border-blue-400 bg-blue-500/20 text-blue-100":"border-border/70 text-muted-foreground hover:border-blue-400 hover:text-blue-200"),children:s.label},s.value))})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Installation name"}),e.jsx("input",{type:"text",value:n.installationName,onChange:s=>r("installationName")(s.target.value),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"Garage ASIC Fleet"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Location (optional)"}),e.jsx("input",{type:"text",value:n.installationLocation,onChange:s=>r("installationLocation")(s.target.value),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"Home office, Shed, etc."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Push interval (minutes)"}),e.jsx("input",{type:"number",min:1,max:60,value:n.pushIntervalMinutes,onChange:s=>r("pushIntervalMinutes")(Number(s.target.value)),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Between 1 and 60 minutes. Default: every 5 minutes."})]}),I&&e.jsx("p",{className:"text-sm text-red-300",children:I}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(y,{type:"submit",disabled:N.isPending,children:[N.isPending&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Save configuration"]}),e.jsxs(y,{type:"button",variant:"secondary",disabled:v.isPending,onClick:()=>v.mutate(),children:[v.isPending?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(H,{className:"mr-2 h-4 w-4"}),"Test connection"]}),e.jsxs(y,{type:"button",variant:"outline",disabled:!(t!=null&&t.enabled)||C.isPending,onClick:()=>C.mutate(),children:[C.isPending?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(P,{className:"mr-2 h-4 w-4"}),"Manual push"]})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{className:"h-fit",children:[e.jsx(b,{children:e.jsxs(f,{className:"flex items-center gap-2 text-base",children:[e.jsx(U,{className:"h-4 w-4 text-blue-300"})," How to set up"]})}),e.jsx(h,{children:e.jsxs("ol",{className:"space-y-4 text-sm text-muted-foreground",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold text-foreground",children:"1. Register on HMM Cloud"}),e.jsx("p",{children:"Create your account with WebAuthn passkeys and add a device to generate an API key."})]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold text-foreground",children:"2. Paste the API key"}),e.jsx("p",{children:"Re-enter the key any time you update settings. Keys are stored securely on disk."})]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold text-foreground",children:"3. Select an ingest endpoint"}),e.jsx("p",{children:"Use staging for tests, production for live monitoring, or point to your own ingest service."})]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold text-foreground",children:"4. Test and verify"}),e.jsx("p",{children:"Use the test and manual push buttons to confirm the connection before enabling automation."})]})]})})]}),e.jsxs(p,{className:"h-fit",children:[e.jsx(b,{children:e.jsx(f,{className:"text-base",children:"Need to restart?"})}),e.jsx(h,{className:"space-y-3 text-sm text-muted-foreground",children:e.jsx("p",{children:"After changing endpoints or API keys, allow one interval for telemetry to appear in the cloud. If data still does not arrive, restart the container from the Restart page and try another manual push."})})]})]})]})]})}function Q(){return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 w-64 animate-pulse rounded bg-muted/40"}),e.jsx("div",{className:"grid gap-6 lg:grid-cols-[1.5fr,1fr]",children:[1,2,3].map(i=>e.jsxs("div",{className:"space-y-3 rounded-2xl border border-border/40 bg-muted/5 p-6",children:[e.jsx("div",{className:"h-5 w-1/3 animate-pulse rounded bg-muted/40"}),e.jsx("div",{className:"space-y-2",children:[...Array(4)].map((n,o)=>e.jsx("div",{className:"h-10 animate-pulse rounded bg-muted/30"},o))})]},i))})]})}function z({message:i,onRetry:n}){return e.jsx(p,{className:"border-red-500/40 bg-red-500/10",children:e.jsxs(h,{className:"flex flex-col gap-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-100",children:[e.jsx(E,{className:"h-5 w-5"}),i]}),e.jsx("div",{children:e.jsx(y,{variant:"secondary",onClick:n,children:"Retry"})})]})})}export{X as default};
