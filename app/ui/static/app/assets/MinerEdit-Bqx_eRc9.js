import{b as k,u as M,k as q,r as n,a as A,j as e,C as u,f as m,A as F,d as L,L as i,B as P,X as I}from"./index-6k8Cl_mh.js";import{u as $}from"./useMutation-BCtpQNq2.js";import{S as D}from"./save-BvrU1VmK.js";function W(){const{minerId:t}=k(),p=M(),x=q(),[g,h]=n.useState(""),[y,f]=n.useState(""),[j,b]=n.useState(""),[v,w]=n.useState(!0),[d,N]=n.useState(""),[c,S]=n.useState(""),{data:a,isLoading:_}=A({queryKey:["minerDetails",t],queryFn:async()=>{const s=await fetch(`/api/miners/${t}`);if(!s.ok)throw new Error("Failed to fetch miner details");return s.json()},enabled:!!t});n.useEffect(()=>{var s,r,l,C;a&&(h(a.name||""),f(a.ip_address||""),b(((s=a.port)==null?void 0:s.toString())||((r=a.effective_port)==null?void 0:r.toString())||""),w(a.enabled??!0),N(((l=a.manual_power_watts)==null?void 0:l.toString())||""),S(((C=a.config)==null?void 0:C.admin_password)||""))},[a]);const o=$({mutationFn:async s=>{const r=await fetch(`/api/miners/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const l=await r.json();throw new Error(l.detail||"Failed to update miner")}return r.json()},onSuccess:()=>{x.invalidateQueries({queryKey:["miners"]}),x.invalidateQueries({queryKey:["telemetry",t]}),p(`/miners/${t}`)}}),E=s=>{s.preventDefault();const r={name:g,ip_address:y,port:parseInt(j),enabled:v};d&&(r.manual_power_watts=parseInt(d)),(a==null?void 0:a.miner_type)==="avalon_nano"&&c&&(r.config={admin_password:c}),o.mutate(r)};return _?e.jsx("div",{className:"p-6",children:e.jsx(u,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-gray-400 border-t-transparent rounded-full"}),e.jsx("p",{children:"Loading miner data..."})]})})})}):a?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(u,{children:[e.jsx(L,{children:e.jsx("h2",{className:"text-xl font-semibold",children:"Edit Miner"})}),e.jsx(m,{children:e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"name",children:"Miner Name"}),e.jsx("input",{type:"text",id:"name",value:g,onChange:s=>h(s.target.value),required:!0,className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Friendly name for this miner"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"miner-type",children:"Miner Type"}),e.jsx("input",{type:"text",id:"miner-type",value:a.miner_type,disabled:!0,className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-gray-500 cursor-not-allowed"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Miner type cannot be changed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"ip-address",children:"IP Address"}),e.jsx("input",{type:"text",id:"ip-address",value:y,onChange:s=>f(s.target.value),required:!0,pattern:"^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"port",children:"Port"}),e.jsx("input",{type:"number",id:"port",value:j,onChange:s=>b(s.target.value),required:!0,min:"1",max:"65535",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"enabled",children:"Status"}),e.jsxs("select",{id:"enabled",value:v.toString(),onChange:s=>w(s.target.value==="true"),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Disabled miners are not monitored"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"manual-power-watts",children:"Estimated Power Usage (W)"}),e.jsx("input",{type:"number",id:"manual-power-watts",value:d,onChange:s=>N(s.target.value),min:"1",max:"5000",placeholder:"e.g., 75",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Optional: For miners without auto-detection. Leave blank if power is auto-detected."})]}),a.miner_type==="avalon_nano"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"admin-password",children:"Avalon Nano Admin Password"}),e.jsx("input",{type:"password",id:"admin-password",value:c,onChange:s=>S(s.target.value),placeholder:"Leave blank to keep existing password",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Password for remote pool configuration. Leave blank to keep the current password unchanged."})]}),o.isError&&e.jsxs("div",{className:"flex items-center gap-3 text-red-400 p-4 bg-red-500/10 rounded-lg border border-red-500/20",children:[e.jsx(F,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:o.error instanceof Error?o.error.message:"Failed to update miner"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(P,{type:"submit",disabled:o.isPending,className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),o.isPending?"Saving...":"Save Changes"]}),e.jsxs(P,{type:"button",variant:"secondary",onClick:()=>p(`/miners/${t}`),className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Cancel"]})]})]})})]})})}):e.jsx("div",{className:"p-6",children:e.jsx(u,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-400",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("p",{children:"Miner not found"})]})})})})}export{W as default};
