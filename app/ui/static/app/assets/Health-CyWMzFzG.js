import{u as b,a as y,j as e,C as d}from"./index-BzPQRpk0.js";function w(){const g=b(),{data:l,isLoading:j,error:o}=y({queryKey:["health","all"],queryFn:async()=>{const t=await fetch("/api/health/all");if(!t.ok)throw new Error("Failed to fetch health data");return t.json()},refetchInterval:1e4});if(j)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fleet Health"}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading health data..."})})]});if(o)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fleet Health"}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-destructive",children:["Error loading health data: ",o.message]})})]});const h=t=>t>=80?"text-green-500":t>=60?"text-yellow-500":t>=40?"text-orange-500":"text-red-500",N=t=>t>=80?"bg-green-500/10 border-green-500/20":t>=60?"bg-yellow-500/10 border-yellow-500/20":t>=40?"bg-orange-500/10 border-orange-500/20":"bg-red-500/10 border-red-500/20",v=t=>t>=80?"Excellent":t>=60?"Good":t>=40?"Fair":"Poor",p=t=>{const s=new Date(t),n=new Date().getTime()-s.getTime(),r=Math.floor(n/6e4);if(r<1)return"Just now";if(r<60)return`${r}m ago`;const a=Math.floor(r/60);return a<24?`${a}h ago`:`${Math.floor(a/24)}d ago`},i=[...(l==null?void 0:l.miners)||[]].sort((t,s)=>t.health_score-s.health_score);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fleet Health"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[l==null?void 0:l.monitored_miners," of ",l==null?void 0:l.total_miners," miners monitored"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(d,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Excellent Health"}),e.jsx("div",{className:"mt-2 text-2xl font-bold text-green-500",children:i.filter(t=>t.health_score>=80).length})]}),e.jsxs(d,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Good Health"}),e.jsx("div",{className:"mt-2 text-2xl font-bold text-yellow-500",children:i.filter(t=>t.health_score>=60&&t.health_score<80).length})]}),e.jsxs(d,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Fair Health"}),e.jsx("div",{className:"mt-2 text-2xl font-bold text-orange-500",children:i.filter(t=>t.health_score>=40&&t.health_score<60).length})]}),e.jsxs(d,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Poor Health"}),e.jsx("div",{className:"mt-2 text-2xl font-bold text-red-500",children:i.filter(t=>t.health_score<40).length})]})]}),i.filter(t=>t.reasons.some(s=>typeof s=="object"&&s.code==="SENSOR_MISSING")).length>0&&e.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-blue-600 text-xl",children:"ℹ️"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-blue-900",children:"Miners Powered Down"}),e.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"SENSOR_MISSING errors are expected when miners are OFF due to Agile pricing. They will automatically resume when electricity is cheaper."})]})]})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map(t=>e.jsxs(d,{className:`p-4 cursor-pointer hover:shadow-lg transition-shadow ${N(t.health_score)}`,onClick:()=>g(`/health/${t.miner_id}`),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t.miner_name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.miner_type," • ",t.mode]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-3xl font-bold ${h(t.health_score)}`,children:t.health_score}),e.jsx("div",{className:`text-xs font-medium ${h(t.health_score)}`,children:v(t.health_score)})]})]}),t.reasons.length>0&&e.jsx("div",{className:"mt-3 space-y-1",children:t.reasons.map((s,x)=>{let n="";if(typeof s=="string")n=s;else{const r=s.code||"";if(r==="INSUFFICIENT_DATA"){const a=s.expected_min||60;n=`Collecting baseline data (${s.actual||0}/${a} samples)`}else{const a=s.metric||"",c=s.actual!==void 0?s.actual:"N/A",m=s.unit||"",f=s.expected_min,u=s.expected_max;f!==void 0&&u!==void 0?n=`${r}: ${a} ${c}${m} (expected: ${f}-${u})`:n=`${r} ${a}: ${c} ${m}`.trim()}}return e.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-background/50",children:["⚠️ ",n]},x)})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Anomaly: ",t.anomaly_score!=null?t.anomaly_score.toFixed(2):"N/A"]}),e.jsx("span",{children:p(t.timestamp)})]})]},t.miner_id))}),i.length===0&&e.jsx(d,{className:"p-8 text-center",children:e.jsx("div",{className:"text-muted-foreground",children:"No health data available yet. Health monitoring will begin once miners report telemetry."})})]})}export{w as Health};
