import{u as A,a as H,j as t,C as c,M as F}from"./index-CExZIXGI.js";function R(){const u=A(),{data:l,isLoading:g,error:m}=H({queryKey:["health","all"],queryFn:async()=>{const e=await fetch("/api/health/all");if(!e.ok)throw new Error("Failed to fetch health data");return e.json()},refetchInterval:1e4});if(g)return t.jsxs("div",{className:"space-y-4",children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fleet Health"}),t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"text-muted-foreground",children:"Loading health data..."})})]});if(m)return t.jsxs("div",{className:"space-y-4",children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fleet Health"}),t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-destructive",children:["Error loading health data: ",m.message]})})]});const x=e=>e>=80?"text-green-500":e>=60?"text-yellow-500":e>=40?"text-orange-500":"text-red-500",p=e=>e>=80?"bg-green-500/10 border-green-500/20":e>=60?"bg-yellow-500/10 border-yellow-500/20":e>=40?"bg-orange-500/10 border-orange-500/20":"bg-red-500/10 border-red-500/20",N=e=>e>=80?"Excellent":e>=60?"Good":e>=40?"Fair":"Poor",j=e=>{const s=new Date(e),r=new Date().getTime()-s.getTime(),n=Math.floor(r/6e4);if(n<1)return"Just now";if(n<60)return`${n}m ago`;const o=Math.floor(n/60);return o<24?`${o}h ago`:`${Math.floor(o/24)}d ago`},_={SENSOR_MISSING:"Telemetry offline",HASHRATE_DROP:"Hashrate low",TEMP_SPIKE:"Temp spike",FAN_FAILURE:"Fan fault",POWER_DROP:"Power drop",NETWORK_LOSS:"Network loss",OVERHEAT:"Overheat",INSULATED_TEMP:"Temp drift",VOLTAGE_ANOMALY:"Voltage swing",BEST_SHARE_DROP:"Share quality"},b={hashrate_th:"Hashrate",temperature_hotspot:"Hotspot temp",temperature:"Temperature",fan_speed:"Fan speed",telemetry:"Telemetry",power_w:"Power draw",shares:"Shares"},h=e=>e.replace(/_/g," ").replace(/\s+/g," ").trim().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" "),d=e=>Math.abs(e)>=100?e.toFixed(0):Math.abs(e)>=10?e.toFixed(1):e.toFixed(2).replace(/\.00$/,""),v=e=>e.replace(/(\d)([A-Za-z])/g,"$1 $2"),y=(e,s)=>{if(e==null)return"";if(typeof e=="number"){const r=d(e);return s?`${r} ${s}`:r}const a=v(e);return s?`${a} ${s}`.trim():a},$=(e,s,a)=>{if(e!==void 0&&s!==void 0){const r=`${d(e)}–${d(s)}`;return a?`${r} ${a}`:r}if(e!==void 0){const r=`${d(e)}`;return a?`≥ ${r} ${a}`:`≥ ${r}`}if(s!==void 0){const r=`${d(s)}`;return a?`≤ ${r} ${a}`:`≤ ${r}`}return""},w=e=>{if(typeof e=="string")return h(e);const s=e.code||"";if(s==="INSUFFICIENT_DATA"){const T=e.expected_min||60;return`Collecting baseline — ${e.actual||0}/${T} samples`}const a=_[s]||h(s||"Alert"),r=e.metric?b[e.metric]||h(e.metric):"",n=y(e.actual,e.unit)||(s==="SENSOR_MISSING"?"No samples":""),o=$(e.expected_min,e.expected_max,e.unit),f=r?`${a} — ${r}`:a,S=n?` ${n}`:"",E=o?` (target ${o})`:"";return`${f}${S}${E}`.trim()},i=[...(l==null?void 0:l.miners)||[]].sort((e,s)=>e.health_score-s.health_score);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Fleet Health"}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[l==null?void 0:l.monitored_miners," of ",l==null?void 0:l.total_miners," miners monitored"]})]}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[t.jsxs(c,{className:"p-4",children:[t.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Excellent Health"}),t.jsx("div",{className:"mt-2 text-2xl font-bold text-green-500",children:i.filter(e=>e.health_score>=80).length})]}),t.jsxs(c,{className:"p-4",children:[t.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Good Health"}),t.jsx("div",{className:"mt-2 text-2xl font-bold text-yellow-500",children:i.filter(e=>e.health_score>=60&&e.health_score<80).length})]}),t.jsxs(c,{className:"p-4",children:[t.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Fair Health"}),t.jsx("div",{className:"mt-2 text-2xl font-bold text-orange-500",children:i.filter(e=>e.health_score>=40&&e.health_score<60).length})]}),t.jsxs(c,{className:"p-4",children:[t.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Poor Health"}),t.jsx("div",{className:"mt-2 text-2xl font-bold text-red-500",children:i.filter(e=>e.health_score<40).length})]})]}),i.filter(e=>e.reasons.some(s=>typeof s=="object"&&s.code==="SENSOR_MISSING")).length>0&&t.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"text-blue-600 text-xl",children:"ℹ️"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-blue-900",children:"Miners Powered Down"}),t.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"SENSOR_MISSING errors are expected when miners are OFF due to Agile pricing. They will automatically resume when electricity is cheaper."})]})]})}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map(e=>t.jsxs(c,{className:`p-4 cursor-pointer hover:shadow-lg transition-shadow ${p(e.health_score)}`,onClick:()=>u(`/health/${e.miner_id}`),children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"font-semibold",children:e.miner_name}),t.jsx(F,{type:e.miner_type,size:"sm"})]}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.mode})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:`text-3xl font-bold ${x(e.health_score)}`,children:e.health_score}),t.jsx("div",{className:`text-xs font-medium ${x(e.health_score)}`,children:N(e.health_score)})]})]}),e.reasons.length>0&&t.jsx("div",{className:"mt-3 space-y-1",children:e.reasons.map((s,a)=>t.jsxs("div",{className:"text-xs px-2 py-1 rounded bg-background/50",children:["⚠️ ",w(s)]},a))}),t.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-muted-foreground",children:[t.jsxs("span",{children:["Anomaly: ",e.anomaly_score!=null?e.anomaly_score.toFixed(2):"N/A"]}),t.jsx("span",{children:j(e.timestamp)})]})]},e.miner_id))}),i.length===0&&t.jsx(c,{className:"p-8 text-center",children:t.jsx("div",{className:"text-muted-foreground",children:"No health data available yet. Health monitoring will begin once miners report telemetry."})})]})}export{R as Health};
