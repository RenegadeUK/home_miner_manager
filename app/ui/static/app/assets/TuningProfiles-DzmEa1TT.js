import{l as ne,r as u,a as B,j as e,a7 as te,U as ae,C as Q,d as H,e as K,f as z,L as x,o as q,p as M,q as _,s as k,t as C,a8 as N,K as le,x as R,y as Y,z as U,E as Z,Z as de,J,B as h,a2 as ie,A as oe,a9 as ce,a6 as ue}from"./index-l4FVxNnM.js";import{u as T}from"./useMutation-DoMZb3N0.js";import{L as S}from"./loader-2-CvfV_zVc.js";import{T as me}from"./trash-2-DL6eM_ZX.js";const D=[{value:"avalon_nano",label:"Avalon Nano 3/3S"},{value:"bitaxe",label:"Bitaxe 601"},{value:"nerdqaxe",label:"NerdQaxe++"}],A="all",E={name:"",minerType:"",description:"",mode:"standard",frequency:"",voltage:""};function Ce(){const r=ne(),[a,t]=u.useState(A),[d,m]=u.useState(null),[o,c]=u.useState(!1),[l,n]=u.useState(E),[G,p]=u.useState(null),[g,w]=u.useState(null),[P,j]=u.useState(""),[F,I]=u.useState(null),f=B({queryKey:["tuning-profiles",a],queryFn:()=>N.getProfiles(a===A?void 0:a)}),y=B({queryKey:["miners-for-apply"],queryFn:()=>ue.getAll(),enabled:!!g}),b=(s,i)=>{m({tone:s,message:i}),window.setTimeout(()=>m(null),5e3)},v=s=>{if(s instanceof ie){if(s.data&&typeof s.data=="object"){const i=s.data.detail;if(typeof i=="string")return i}return s.message}return s instanceof Error?s.message:"Something went wrong"},L=T({mutationFn:N.createProfile,onSuccess:()=>{b("success","Tuning profile created"),r.invalidateQueries({queryKey:["tuning-profiles"]}),c(!1),n(E)},onError:s=>p(v(s))}),O=T({mutationFn:s=>N.deleteProfile(s),onSuccess:()=>{b("success","Profile deleted"),r.invalidateQueries({queryKey:["tuning-profiles"]})},onError:s=>b("error",v(s)),onSettled:()=>I(null)}),V=T({mutationFn:({profileId:s,minerId:i})=>N.applyProfile(s,i),onSuccess:s=>{b("success",s.message||"Profile applied successfully"),w(null),j("")},onError:s=>b("error",v(s))}),W=u.useMemo(()=>!g||!y.data?[]:y.data.filter(s=>s.type===g.miner_type),[g,y.data]),X=()=>{if(p(null),!l.name.trim()){p("Profile name is required");return}if(!l.minerType){p("Select a miner type");return}const s={};if(l.minerType==="avalon_nano"?s.mode=l.mode||"med":(l.mode&&(s.mode=l.mode),l.frequency&&(s.frequency=Number(l.frequency)),l.voltage&&(s.voltage=Number(l.voltage))),Object.keys(s).length===0){p("Configure at least one setting");return}L.mutate({name:l.name.trim(),miner_type:l.minerType,description:l.description.trim()||null,settings:s})},ee=s=>{s.is_system||window.confirm(`Delete tuning profile "${s.name}"?`)&&(I(s.id),O.mutate(s.id))},se=()=>{!g||!P||V.mutate({profileId:g.id,minerId:Number(P)})},re=()=>{if(f.isLoading)return e.jsx(fe,{});if(f.isError)return e.jsx(be,{message:v(f.error),onRetry:()=>f.refetch()});const s=f.data??[];return s.length===0?e.jsx("div",{className:"rounded-2xl border border-dashed border-border/60 bg-muted/5 p-10 text-center text-sm text-muted-foreground",children:"No tuning profiles found. Create a profile to get started."}):e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[s.map(i=>e.jsx(xe,{profile:i,onApply:()=>{w(i),j("")},onDelete:()=>ee(i),deleteDisabled:i.is_system||F===i.id,isDeleting:F===i.id&&O.isPending},i.id)),e.jsxs("button",{type:"button",onClick:()=>{c(!0),p(null)},className:"flex min-h-[220px] flex-col items-center justify-center rounded-2xl border border-dashed border-border/70 bg-muted/5 text-sm text-muted-foreground transition hover:border-blue-500 hover:text-blue-200",children:[e.jsx(le,{className:"mb-2 h-6 w-6"}),"Create profile"]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(te,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"Tuning Profiles"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Save and reuse safe tuning presets across Avalon Nano, Bitaxe, and NerdQaxe miners. Apply profiles with two clicks and keep your fleet consistent."})]}),d&&e.jsx("div",{className:ae("rounded-xl border px-4 py-3 text-sm",d.tone==="success"&&"border-emerald-500/40 bg-emerald-500/10 text-emerald-100",d.tone==="error"&&"border-red-500/40 bg-red-500/10 text-red-100",d.tone==="info"&&"border-blue-500/40 bg-blue-500/10 text-blue-100"),children:d.message}),e.jsxs(Q,{children:[e.jsx(H,{children:e.jsx(K,{className:"text-lg",children:"Filter profiles"})}),e.jsxs(z,{className:"grid gap-3 md:max-w-sm",children:[e.jsx(x,{className:"text-sm text-muted-foreground",children:"Miner type"}),e.jsxs(q,{value:a,onValueChange:s=>t(s),children:[e.jsx(M,{children:e.jsx(_,{placeholder:"All types"})}),e.jsxs(k,{children:[e.jsx(C,{value:A,children:"All types"}),D.map(s=>e.jsx(C,{value:s.value,children:s.label},s.value))]})]})]})]}),re(),e.jsx(ge,{open:o,onOpenChange:s=>{c(s),s||(n(E),p(null))},form:l,onFormChange:n,onSubmit:X,isSubmitting:L.isPending,error:G}),e.jsx(he,{profile:g,miners:W,isLoadingMiners:y.isFetching,selectedMinerId:P,onMinerChange:j,onClose:()=>{w(null),j("")},onApply:se,isApplying:V.isPending})]})}function xe({profile:r,onApply:a,onDelete:t,deleteDisabled:d,isDeleting:m}){return e.jsxs(Q,{className:"relative h-full border-border/60 bg-muted/5",children:[r.is_system&&e.jsx("span",{className:"absolute right-4 top-4 rounded-full bg-purple-500/20 px-3 py-1 text-xs font-semibold text-purple-200",children:"SYSTEM"}),e.jsx(H,{children:e.jsxs(K,{className:"space-y-1 text-lg",children:[e.jsx("p",{className:"text-foreground",children:r.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:$(r.miner_type)})]})}),e.jsxs(z,{className:"space-y-4 text-sm text-muted-foreground",children:[e.jsx("p",{children:r.description||"No description provided."}),e.jsxs("div",{className:"rounded-xl border border-border/60 bg-background/40 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Settings"}),e.jsx("dl",{className:"mt-2 space-y-1 text-foreground",children:Object.entries(r.settings).map(([o,c])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("dt",{className:"text-muted-foreground",children:pe(o)}),e.jsx("dd",{className:"font-medium",children:c})]},o))})]})]}),e.jsxs(ce,{className:"flex flex-wrap gap-2",children:[e.jsx(h,{className:"flex-1",onClick:a,children:"Apply to miner"}),e.jsxs(h,{type:"button",variant:"ghost",disabled:d,onClick:t,className:"flex-1 text-red-400 hover:bg-red-500/10 hover:text-red-200",children:[m?e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(me,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}function $(r){const a=D.find(t=>t.value===r);return a?a.label:r}function pe(r){return r==="mode"?"Mode":r==="frequency"?"Frequency (MHz)":r==="voltage"?"Voltage (mV)":r.replace(/_/g," ")}function ge({open:r,onOpenChange:a,form:t,onFormChange:d,onSubmit:m,isSubmitting:o,error:c}){const l=t.minerType==="avalon_nano";return e.jsx(R,{open:r,onOpenChange:a,children:e.jsxs(Y,{className:"max-h-[90vh] overflow-y-auto border-border/70 bg-gray-900",children:[e.jsx(U,{children:e.jsx(Z,{children:"Create tuning profile"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"profile-name",children:"Profile name"}),e.jsx("input",{id:"profile-name",type:"text",value:t.name,onChange:n=>d({...t,name:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"Eco mode, Turbo, etc."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Miner type"}),e.jsxs(q,{value:t.minerType,onValueChange:n=>d({...t,minerType:n,mode:n==="avalon_nano"?"med":"standard",frequency:"",voltage:""}),children:[e.jsx(M,{children:e.jsx(_,{placeholder:"Select miner type"})}),e.jsx(k,{children:D.map(n=>e.jsx(C,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Description (optional)"}),e.jsx("textarea",{value:t.description,onChange:n=>d({...t,description:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",rows:2,placeholder:"Explain what this profile is optimized for"})]}),t.minerType?e.jsxs("div",{className:"space-y-4 rounded-2xl border border-border/60 bg-muted/5 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx(de,{className:"h-4 w-4 text-blue-300"})," Tunable settings"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Mode"}),e.jsx("select",{value:t.mode,onChange:n=>d({...t,mode:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",children:l?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"med",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"eco",children:"Eco"}),e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"turbo",children:"Turbo"}),e.jsx("option",{value:"oc",children:"Overclock"})]})})]}),!l&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Frequency (MHz)"}),e.jsx("input",{type:"number",value:t.frequency,onChange:n=>d({...t,frequency:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"500",min:100,max:1e3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Voltage (mV)"}),e.jsx("input",{type:"number",value:t.voltage,onChange:n=>d({...t,voltage:n.target.value}),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"1200",min:800,max:1500})]})]})]}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border/60 bg-muted/5 p-4 text-sm text-muted-foreground",children:"Choose a miner type to reveal the available settings."}),c&&e.jsx("p",{className:"text-sm text-red-300",children:c})]}),e.jsxs(J,{className:"pt-4",children:[e.jsx(h,{variant:"secondary",onClick:()=>a(!1),disabled:o,children:"Cancel"}),e.jsxs(h,{onClick:m,disabled:o,children:[o&&e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Save profile"]})]})]})})}function he({profile:r,miners:a,isLoadingMiners:t,selectedMinerId:d,onMinerChange:m,onClose:o,onApply:c,isApplying:l}){return e.jsx(R,{open:!!r,onOpenChange:n=>!n&&o(),children:e.jsxs(Y,{className:"border-border/70 bg-gray-900",children:[e.jsxs(U,{children:[e.jsx(Z,{children:"Apply profile"}),r&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.name," · ",$(r.miner_type)]})]}),t?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(S,{className:"h-4 w-4 animate-spin"})," Loading compatible miners…"]}):a.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No compatible miners found."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Select miner"}),e.jsxs(q,{value:d,onValueChange:m,children:[e.jsx(M,{children:e.jsx(_,{placeholder:"Choose a miner"})}),e.jsx(k,{children:a.map(n=>e.jsx(C,{value:String(n.id),children:n.name},n.id))})]})]}),e.jsxs(J,{className:"pt-4",children:[e.jsx(h,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsxs(h,{onClick:c,disabled:!d||l||a.length===0,children:[l&&e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Apply profile"]})]})]})})}function fe(){return e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[...Array(3)].map((r,a)=>e.jsxs("div",{className:"space-y-3 rounded-2xl border border-border/40 bg-muted/5 p-6",children:[e.jsx("div",{className:"h-5 w-2/3 animate-pulse rounded bg-muted/30"}),e.jsx("div",{className:"h-4 w-1/2 animate-pulse rounded bg-muted/20"}),e.jsx("div",{className:"h-20 animate-pulse rounded-xl bg-muted/20"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-9 w-full animate-pulse rounded bg-muted/20"}),e.jsx("div",{className:"h-9 w-full animate-pulse rounded bg-muted/20"})]})]},a))})}function be({message:r,onRetry:a}){return e.jsxs("div",{className:"rounded-2xl border border-red-500/40 bg-red-500/10 p-4 text-sm text-red-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"})," ",r]}),e.jsx(h,{variant:"secondary",className:"mt-3",onClick:a,children:"Retry"})]})}export{Ce as default};
