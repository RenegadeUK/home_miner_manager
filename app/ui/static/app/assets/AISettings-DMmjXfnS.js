import{c as ie,k as ce,r as d,a as ue,j as e,ad as W,O as v,C as _,d as P,e as L,K as me,f as U,B as h,a0 as xe,ae as N,A as pe}from"./index-6k8Cl_mh.js";import{u as K}from"./useMutation-BCtpQNq2.js";import{P as X}from"./plug-zap-3zmr174Y.js";import{L as k}from"./loader-2-CuIrPQpo.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=ie("Cable",[["path",{d:"M4 9a2 2 0 0 1-2-2V5h6v2a2 2 0 0 1-2 2Z",key:"1s6oa5"}],["path",{d:"M3 5V3",key:"1k5hjh"}],["path",{d:"M7 5V3",key:"1t1388"}],["path",{d:"M19 15V6.5a3.5 3.5 0 0 0-7 0v11a3.5 3.5 0 0 1-7 0V9",key:"1ytv72"}],["path",{d:"M17 21v-2",key:"ds4u3f"}],["path",{d:"M21 21v-2",key:"eo0ou"}],["path",{d:"M22 19h-6v-2a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2Z",key:"sdz6o8"}]]),F=[{value:"gpt-4o",label:"GPT-4o (recommended)"},{value:"gpt-4o-mini",label:"GPT-4o Mini (cheaper)"},{value:"gpt-4-turbo",label:"GPT-4 Turbo"}],w=[{value:"qwen2.5-coder:7b",label:"Qwen 2.5 Coder 7B (function calling)"},{value:"llama3.1:8b",label:"Llama 3.1 8B"},{value:"mistral:7b",label:"Mistral 7B"},{value:"qwen2.5:7b",label:"Qwen 2.5 7B"},{value:"custom",label:"Custom model…"}],J="https://api.openai.com/v1",te="http://localhost:11434/v1",B=100,R=4e3,Y={enabled:!1,apiKey:"",model:F[0].value,maxTokens:1e3},be={enabled:!1,baseUrl:te,model:w[0].value,customModel:"",maxTokens:1e3};function Ne(){const r=ce(),[l,o]=d.useState(null),[t,c]=d.useState(Y),[n,x]=d.useState(be),[q,O]=d.useState(!1),[D,Q]=d.useState(null),[V,S]=d.useState(null),[I,p]=d.useState(null),[M,u]=d.useState(null),[G,Z]=d.useState(null),i=ue({queryKey:["ai-config"],queryFn:N.getConfig});d.useEffect(()=>{i.data&&re(i.data)},[i.data]);const re=s=>{if(s.provider==="openai")c(a=>({...a,enabled:s.enabled,model:s.model??F[0].value,maxTokens:f(s.max_tokens??1e3),apiKey:""})),O(!!s.api_key);else{O(!1),c(()=>({...Y}));const a=s.model??w[0].value,m=w.some(g=>g.value===a);x(g=>({...g,enabled:s.enabled,baseUrl:s.base_url??te,model:m?a:"custom",customModel:m?"":a,maxTokens:f(s.max_tokens??1e3)}))}},C=(s,a)=>{o({tone:s,message:a}),window.setTimeout(()=>o(null),5e3)},j=s=>{if(s instanceof xe){if(s.data&&typeof s.data=="object"&&"detail"in s.data){const a=s.data.detail;if(typeof a=="string")return a}return s.message}return s instanceof Error?s.message:"Something went wrong"},y=K({mutationFn:s=>N.saveConfig(s),onMutate:s=>{Z(s.provider)},onSuccess:(s,a)=>{if(!s.success){C("error",s.error||"Failed to save AI settings");return}C("success",`${a.provider==="openai"?"OpenAI":"Ollama"} settings saved`),r.invalidateQueries({queryKey:["ai-config"]}),a.provider==="openai"&&(c(m=>({...m,apiKey:""})),a.api_key&&O(!0))},onError:s=>C("error",j(s)),onSettled:()=>Z(null)}),T=K({mutationFn:s=>N.testConnection(s),onMutate:()=>p({tone:"info",message:"Testing OpenAI connection…"}),onSuccess:s=>{p({tone:s.success?"success":"error",message:s.success?s.message??"OpenAI connection ok":s.error??"OpenAI test failed"})},onError:s=>p({tone:"error",message:j(s)})}),E=K({mutationFn:s=>N.testConnection(s),onMutate:()=>u({tone:"info",message:"Checking Ollama host…"}),onSuccess:s=>{u({tone:s.success?"success":"error",message:s.success?s.message??"Ollama connection ok":s.error??"Ollama test failed"})},onError:s=>u({tone:"error",message:j(s)})}),le=s=>{if(s.preventDefault(),Q(null),t.enabled&&!q&&!t.apiKey.trim()){Q("Enter your OpenAI API key to enable the integration.");return}const a={enabled:t.enabled,provider:"openai",model:t.model,max_tokens:f(t.maxTokens),base_url:J};t.apiKey.trim()&&(a.api_key=t.apiKey.trim()),y.mutate(a,{onSuccess:()=>p(null)})},ne=s=>{s.preventDefault(),S(null);const a=n.baseUrl.trim();if(!a){S("Enter the Ollama base URL (http://host:11434/v1).");return}const m=n.model==="custom"?n.customModel.trim():n.model;if(!m){S("Select or enter the model name to use.");return}const g={enabled:n.enabled,provider:"ollama",model:m,max_tokens:f(n.maxTokens),base_url:a,api_key:"ollama"};y.mutate(g,{onSuccess:()=>u(null)})},oe=()=>{if(p(null),!t.apiKey.trim()){p({tone:"error",message:"Enter your API key to test connectivity."});return}T.mutate({provider:"openai",api_key:t.apiKey.trim(),model:t.model,base_url:J})},de=()=>{u(null);const s=n.baseUrl.trim();if(!s){u({tone:"error",message:"Enter the Ollama base URL first."});return}const a=n.model==="custom"?n.customModel.trim():n.model;if(!a){u({tone:"error",message:"Select or enter a model before testing."});return}E.mutate({provider:"ollama",model:a,base_url:s})},b=d.useMemo(()=>{const s=i.data;return s?{providerLabel:s.provider==="ollama"?"Ollama (local)":"OpenAI (cloud)",enabled:s.enabled,model:s.model,baseUrl:s.base_url}:null},[i.data]),z=y.isPending&&G==="openai",H=y.isPending&&G==="ollama";return i.isLoading?e.jsx(he,{}):i.isError?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(W,{className:"h-8 w-8 text-blue-400"}),"AI Settings"]}),e.jsx(ge,{message:j(i.error),onRetry:()=>i.refetch()})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(W,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"AI Settings"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Wire up OpenAI or Ollama for AI-powered automation, anomaly detection, and future copilots. Only one provider is active at a time—configure both so you can switch instantly."})]}),l&&e.jsx("div",{className:v("rounded-xl border px-4 py-3 text-sm",l.tone==="success"&&"border-emerald-500/40 bg-emerald-500/10 text-emerald-100",l.tone==="error"&&"border-red-500/40 bg-red-500/10 text-red-100",l.tone==="info"&&"border-blue-500/40 bg-blue-500/10 text-blue-100"),children:l.message}),b&&e.jsxs(_,{children:[e.jsx(P,{children:e.jsxs(L,{className:"flex items-center gap-3 text-lg",children:[e.jsx(me,{className:"h-5 w-5 text-blue-300"}),"Active provider"]})}),e.jsxs(U,{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(A,{label:"Provider",value:b.providerLabel}),e.jsx(A,{label:"Status",value:b.enabled?"Enabled":"Disabled"}),e.jsx(A,{label:"Model",value:b.model||"Not configured"}),b.baseUrl&&e.jsx(A,{label:"Base URL",value:b.baseUrl,spanFull:!0})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(_,{className:"border border-border/60",children:[e.jsx(P,{children:e.jsxs(L,{className:"flex items-center gap-3 text-lg",children:[e.jsx(X,{className:"h-5 w-5 text-blue-300"}),"OpenAI (cloud)"]})}),e.jsx(U,{children:e.jsxs("form",{className:"space-y-5",onSubmit:le,children:[e.jsx(ee,{label:"Enable OpenAI",description:"Use GPT models via OpenAI's hosted API.",checked:t.enabled,onChange:s=>c(a=>({...a,enabled:s}))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"API key"}),e.jsx("input",{type:"password",value:t.apiKey,onChange:s=>c(a=>({...a,apiKey:s.target.value})),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"sk-...",autoComplete:"off"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Keys are stored encrypted and never shown. Re-enter to rotate.",q&&!t.apiKey&&" Existing key detected."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Model"}),e.jsx("select",{value:t.model,onChange:s=>c(a=>({...a,model:s.target.value})),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",children:F.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsx(se,{label:"Max response tokens",value:t.maxTokens,onChange:s=>c(a=>({...a,maxTokens:s}))}),D&&e.jsx("p",{className:"text-sm text-red-300",children:D}),I&&e.jsx(ae,{tone:I.tone,message:I.message}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(h,{type:"submit",disabled:z,children:[z&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Save OpenAI config"]}),e.jsxs(h,{type:"button",variant:"secondary",disabled:T.isPending,onClick:oe,children:[T.isPending?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx($,{className:"mr-2 h-4 w-4"}),"Test connection"]})]})]})})]}),e.jsxs(_,{className:"border border-border/60",children:[e.jsx(P,{children:e.jsxs(L,{className:"flex items-center gap-3 text-lg",children:[e.jsx($,{className:"h-5 w-5 text-blue-300"}),"Ollama (local)"]})}),e.jsx(U,{children:e.jsxs("form",{className:"space-y-5",onSubmit:ne,children:[e.jsx(ee,{label:"Enable Ollama",description:"Use local models without cloud costs.",checked:n.enabled,onChange:s=>x(a=>({...a,enabled:s}))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Base URL"}),e.jsx("input",{type:"text",value:n.baseUrl,onChange:s=>x(a=>({...a,baseUrl:s.target.value})),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"http://localhost:11434/v1"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Use ",e.jsx("code",{children:"http://ollama:11434/v1"})," when both services run in Docker."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Model"}),e.jsx("select",{value:n.model,onChange:s=>x(a=>({...a,model:s.target.value,customModel:s.target.value==="custom"?a.customModel:""})),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",children:w.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),n.model==="custom"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Custom model name"}),e.jsx("input",{type:"text",value:n.customModel,onChange:s=>x(a=>({...a,customModel:s.target.value})),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40",placeholder:"e.g., llama3.1:70b"})]}),e.jsx(se,{label:"Max response tokens",value:n.maxTokens,onChange:s=>x(a=>({...a,maxTokens:s}))}),V&&e.jsx("p",{className:"text-sm text-red-300",children:V}),M&&e.jsx(ae,{tone:M.tone,message:M.message}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(h,{type:"submit",disabled:H,children:[H&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Ollama config"]}),e.jsxs(h,{type:"button",variant:"secondary",disabled:E.isPending,onClick:de,children:[E.isPending?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(X,{className:"mr-2 h-4 w-4"}),"Test connection"]})]}),e.jsxs("div",{className:"rounded-xl border border-border/60 bg-muted/5 p-3 text-xs text-muted-foreground",children:["Tip: run ",e.jsx("code",{children:"ollama pull qwen2.5-coder:7b"})," before enabling so the model is available locally."]})]})})]})]})]})}function f(r){return Number.isNaN(r)?1e3:Math.min(R,Math.max(B,r))}function A({label:r,value:l,spanFull:o}){return e.jsxs("div",{className:v("space-y-1",o&&"md:col-span-3"),children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:r}),e.jsx("p",{className:"text-sm font-semibold text-foreground break-words",children:l||"—"})]})}function ee({label:r,description:l,checked:o,onChange:t}){return e.jsxs("div",{className:"flex items-start justify-between gap-4 rounded-xl border border-border/60 bg-muted/5 px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:r}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l})]}),e.jsx("button",{type:"button",onClick:()=>t(!o),className:v("flex h-6 w-12 items-center rounded-full border border-border px-0.5 transition-colors",o?"bg-blue-500/80 border-blue-400":"bg-gray-800"),"aria-pressed":o,children:e.jsx("span",{className:v("h-5 w-5 rounded-full bg-white shadow transition-transform",o?"translate-x-6":"translate-x-0")})})]})}function se({label:r,value:l,onChange:o}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:r}),e.jsx("input",{type:"number",min:B,max:R,step:100,value:l,onChange:t=>o(f(Number(t.target.value))),className:"w-full rounded-lg border border-border/70 bg-background px-3 py-2 text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-blue-500/40"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Between ",B," and ",R," tokens."]})]})}function ae({tone:r,message:l}){return e.jsx("div",{className:v("rounded-xl border px-3 py-2 text-xs",r==="success"&&"border-emerald-500/40 bg-emerald-500/10 text-emerald-100",r==="error"&&"border-red-500/40 bg-red-500/10 text-red-100",r==="info"&&"border-blue-500/40 bg-blue-500/10 text-blue-100"),children:l})}function ge({message:r,onRetry:l}){return e.jsxs("div",{className:"rounded-2xl border border-red-500/40 bg-red-500/10 p-4 text-sm text-red-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:r})]}),e.jsx(h,{variant:"secondary",size:"sm",className:"mt-3",onClick:l,children:"Retry"})]})}function he(){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 w-48 animate-pulse rounded bg-muted/20"}),e.jsx("div",{className:"h-4 w-3/4 animate-pulse rounded bg-muted/20"}),e.jsx("div",{className:"grid gap-4 lg:grid-cols-2",children:Array.from({length:2}).map((r,l)=>e.jsxs("div",{className:"space-y-3 rounded-2xl border border-border/60 p-4",children:[e.jsx("div",{className:"h-5 w-40 animate-pulse rounded bg-muted/20"}),e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((o,t)=>e.jsx("div",{className:"h-10 w-full animate-pulse rounded bg-muted/20"},t))})]},l))})]})}export{Ne as default};
