import{c as ne,r as n,j as e,w as L,x as R,y as K,z as Q,E as $,L as j,n as je,o as fe,p as be,q as ve,F as Ne,G as Se,s as we,H as ie,A as G,I as W,B as d,k as Pe,a as H,W as Ce,J as ke,l as te,C as P,f as C,d as ae}from"./index-CytrZ8q2.js";import{u as O}from"./useMutation-B-ZiKrG3.js";import{I as z}from"./info-xyT4Ynz6.js";import{S as Be}from"./shield-check-RiUflETJ.js";import{S as Ee}from"./shield-alert-C2BFmkqV.js";import{T as De}from"./trash-2-Cu9WZGFA.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=ne("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ne("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),oe=[{label:"Solopool.org · Bitcoin (BTC)",options:[{key:"btc-eu3",name:"Solopool.org BTC (EU3)",url:"eu3.solopool.org",port:8005,group:"Solopool.org · Bitcoin (BTC)",subtitle:"Europe · Solo mining"}]},{label:"Solopool.org · Bitcoin Cash (BCH)",options:[{key:"bch-eu2",name:"Solopool.org BCH (EU2)",url:"eu2.solopool.org",port:8002,group:"Solopool.org · Bitcoin Cash (BCH)",subtitle:"Europe · Solo mining"},{key:"bch-us1",name:"Solopool.org BCH (US1)",url:"us1.solopool.org",port:8002,group:"Solopool.org · Bitcoin Cash (BCH)",subtitle:"United States · Solo mining"}]},{label:"Solopool.org · Bitcoin II (BC2)",options:[{key:"bc2-eu3",name:"Solopool.org BC2 (EU3)",url:"eu3.solopool.org",port:8001,group:"Solopool.org · Bitcoin II (BC2)",subtitle:"Europe · Solo mining"}]},{label:"Solopool.org · DigiByte (DGB)",options:[{key:"dgb-eu1",name:"Solopool.org DGB (EU1)",url:"eu1.solopool.org",port:8004,group:"Solopool.org · DigiByte (DGB)",subtitle:"Europe · Solo mining"},{key:"dgb-us1",name:"Solopool.org DGB (US1)",url:"us1.solopool.org",port:8004,group:"Solopool.org · DigiByte (DGB)",subtitle:"United States · Solo mining"}]},{label:"Braiins Pool · Bitcoin (BTC)",options:[{key:"braiins-btc",name:"Braiins Pool BTC",url:"stratum.braiins.com",port:3333,group:"Braiins Pool · Bitcoin (BTC)",subtitle:"Global · FPPS payouts"}]}],le=oe.reduce((r,l)=>(l.options.forEach(t=>{r[t.key]=t}),r),{});function Ae({open:r,mode:l,pool:t,isSubmitting:f,onOpenChange:u,onSubmit:I}){const[x,k]=n.useState(""),[b,o]=n.useState(""),[B,N]=n.useState(!0),[E,h]=n.useState(null),g=n.useMemo(()=>x?le[x]:void 0,[x]);n.useEffect(()=>{r?(l==="edit"&&t?(o(t.user||""),N(t.enabled)):(o(""),N(!0),k("")),h(null)):(o(""),k(""),h(null))},[r,l,t]);const S=async c=>{c.preventDefault();const i=b.trim();if(l==="add"&&!x){h("Select an approved pool provider to continue.");return}if(!i){h("Wallet address / username is required.");return}let y;if(l==="add"&&(y=le[x],!y)){h("Invalid pool preset selected.");return}const U={id:t==null?void 0:t.id,name:l==="add"?y.name:(t==null?void 0:t.name)||"",url:l==="add"?y.url:(t==null?void 0:t.url)||"",port:l==="add"?y.port:(t==null?void 0:t.port)||0,user:i,password:(t==null?void 0:t.password)||"x",enabled:B};try{await I(U),u(!1)}catch(T){h(T instanceof Error?T.message:"Failed to save pool settings.")}},A=l==="add"?"Add Mining Pool":"Edit Pool",D=l==="add"?"Select an approved provider and supply the wallet address or username you use with that pool.":"Update the wallet address / username and status for this pool. Provider settings remain locked for safety.",M=l==="edit"&&t;return e.jsx(L,{open:r,onOpenChange:u,children:e.jsxs(R,{className:"max-w-2xl",children:[e.jsxs(K,{children:[e.jsxs(Q,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-blue-400"}),A]}),e.jsx($,{className:"text-gray-400",children:D})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[l==="add"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{htmlFor:"provider",children:"1️⃣ Pool Provider"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(z,{className:"h-4 w-4"}),"Approved providers only"]})]}),e.jsxs(je,{value:x,onValueChange:k,children:[e.jsx(fe,{id:"provider",children:e.jsx(be,{placeholder:"Choose a pool"})}),e.jsx(ve,{children:oe.map(c=>e.jsxs(Ne,{children:[e.jsx(Se,{children:c.label}),c.options.map(i=>e.jsx(we,{value:i.key,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:i.name}),i.subtitle&&e.jsx("span",{className:"text-xs text-gray-400",children:i.subtitle})]})},i.key))]},c.label))})]}),g&&e.jsxs("div",{className:"rounded-lg border border-gray-700 bg-gray-900/60 p-4 text-sm",children:[e.jsx("p",{className:"text-gray-300 font-medium",children:g.name}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[g.url,":",g.port]}),e.jsx("p",{className:"text-gray-500 mt-2",children:"These connection details are locked to ensure reliability."})]})]}),M&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Pool Name"}),e.jsx("input",{type:"text",value:t.name,disabled:!0,className:"mt-2 w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-400"})]}),e.jsxs("div",{children:[e.jsx(j,{children:"URL"}),e.jsx("input",{type:"text",value:t.url,disabled:!0,className:"mt-2 w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-400"})]}),e.jsxs("div",{children:[e.jsx(j,{children:"Port"}),e.jsx("input",{type:"text",value:t.port,disabled:!0,className:"mt-2 w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-400"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(j,{htmlFor:"wallet",children:"2️⃣ Wallet Address / Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"wallet",type:"text",value:b,onChange:c=>o(c.target.value),placeholder:"paste your Braiins username or Solopool wallet",className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40"}),e.jsx(re,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:'This is the only editable field per pool. Passwords default to "x" for all approved providers.'})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{id:"enabled",checked:B,onCheckedChange:c=>N(!!c)}),e.jsx(j,{htmlFor:"enabled",className:"text-sm",children:"Pool enabled"})]}),E&&e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-300",children:[e.jsx(G,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:E})]}),e.jsxs(W,{className:"gap-3 sm:gap-2",children:[e.jsx(d,{type:"button",variant:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(d,{type:"submit",disabled:f,className:"min-w-[140px]",children:f?"Saving…":l==="add"?"Add Pool":"Save Changes"})]})]})]})})}async function v(r,l){const t=await fetch(r,{headers:{"Content-Type":"application/json",...(l==null?void 0:l.headers)||{}},...l});if(!t.ok){const f=await t.json().catch(()=>({})),u=f.detail||f.message||`Request failed (${t.status})`;throw new Error(u)}if(t.status!==204)return t.json()}function Me(r){return typeof r!="number"?{label:"No data",className:"text-gray-400"}:r>=70?{label:"Healthy",className:"text-green-400"}:r>=40?{label:"Fair",className:"text-yellow-400"}:{label:"Critical",className:"text-red-400"}}function q(r,l=""){return r==null?"—":`${r}${l}`}function He(){const r=Pe(),[l,t]=n.useState("add"),[f,u]=n.useState(!1),[I,x]=n.useState(null),[k,b]=n.useState(!1),[o,B]=n.useState(null),[N,E]=n.useState(null),[h,g]=n.useState(!1),[S,A]=n.useState(!1),[D,M]=n.useState(""),[c,i]=n.useState(null),{data:y=[],isLoading:U,error:T}=H({queryKey:["pools"],queryFn:()=>v("/api/pools/")}),{data:m,isLoading:de,error:J}=H({queryKey:["pool-health-overview"],queryFn:()=>v("/api/pools/health/overview"),refetchInterval:6e4}),{data:p,refetch:ce}=H({queryKey:["braiins-settings"],queryFn:()=>v("/api/settings/braiins")});n.useEffect(()=>{p&&(A(!!p.enabled),M(p.api_token||""))},[p==null?void 0:p.enabled,p==null?void 0:p.api_token]);const xe=n.useMemo(()=>{const s=new Map;return m==null||m.pools.forEach(a=>s.set(a.pool_id,a)),s},[m]),V=O({mutationFn:s=>{const{id:a,...w}=s;return v("/api/pools/",{method:"POST",body:JSON.stringify(w)})},onSuccess:()=>{r.invalidateQueries({queryKey:["pools"]}),r.invalidateQueries({queryKey:["pool-health-overview"]})}}),Y=O({mutationFn:s=>{if(!s.id)throw new Error("Pool ID missing");const{id:a,...w}=s;return v(`/api/pools/${a}`,{method:"PUT",body:JSON.stringify(w)})},onSuccess:()=>{r.invalidateQueries({queryKey:["pools"]}),r.invalidateQueries({queryKey:["pool-health-overview"]})}}),_=O({mutationFn:s=>v(`/api/pools/${s}`,{method:"DELETE"}),onSuccess:()=>{r.invalidateQueries({queryKey:["pools"]}),r.invalidateQueries({queryKey:["pool-health-overview"]})}}),F=O({mutationFn:s=>v("/api/settings/braiins",{method:"POST",body:JSON.stringify(s)}),onSuccess:()=>{r.invalidateQueries({queryKey:["braiins-settings"]}),i("Settings saved"),setTimeout(()=>i(null),4e3)},onError:s=>{i(s.message),setTimeout(()=>i(null),5e3)}}),me=V.isPending||Y.isPending,X=n.useMemo(()=>[...y].sort((s,a)=>s.name.toLowerCase().localeCompare(a.name.toLowerCase())),[y]),Z=()=>{t("add"),x(null),u(!0)},ue=s=>{t("edit"),x(s),u(!0)},pe=async s=>{l==="add"?await V.mutateAsync(s):await Y.mutateAsync(s)},he=s=>{B(s),E(null),b(!0)},ge=async()=>{if(o)try{await _.mutateAsync(o.id),b(!1),B(null)}catch(s){E(s instanceof Error?s.message:"Unable to delete pool")}},ye=async()=>{if(S&&!D.trim()){i("API token is required when integration is enabled"),setTimeout(()=>i(null),4e3);return}try{await F.mutateAsync({enabled:S,api_token:D.trim()})}catch{}},ee=T instanceof Error?T.message:null,se=J instanceof Error?J.message:null;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm uppercase tracking-widest text-blue-300",children:[e.jsx(Ce,{className:"h-5 w-5"}),e.jsx("span",{children:"Pools"})]}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Pool Management"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Review pool health, manage approved providers, and keep Braiins Pool telemetry in sync."}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-4",children:[e.jsxs(d,{onClick:Z,className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Add Pool"]}),e.jsxs(d,{variant:"outline",onClick:()=>r.invalidateQueries({queryKey:["pool-health-overview"]}),className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Refresh Health"]})]})]}),m&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(P,{children:e.jsxs(C,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Pools"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:m.total_pools})]})}),e.jsx(P,{children:e.jsxs(C,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Healthy"}),e.jsxs("div",{className:"flex items-baseline gap-2 mt-2",children:[e.jsx("p",{className:"text-2xl font-semibold text-green-400",children:m.healthy_pools}),e.jsxs("span",{className:"text-sm text-gray-500",children:["/",m.total_pools]})]})]})}),e.jsx(P,{children:e.jsxs(C,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Avg Response Time"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:q(m.avg_response_time_ms,"ms")})]})}),e.jsx(P,{children:e.jsxs(C,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Avg Reject Rate"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:q(m.avg_reject_rate,"%")})]})})]}),(ee||se)&&e.jsxs("div",{className:"flex items-center gap-3 rounded-md border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:ee||se})]}),e.jsxs(P,{children:[e.jsx(ae,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configured Pools"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Only approved Solopool and Braiins providers are shown."})]})}),e.jsx(C,{children:U||de?e.jsx("div",{className:"flex min-h-[200px] items-center justify-center text-gray-400",children:"Loading pools…"}):X.length===0?e.jsxs("div",{className:"rounded-md border border-dashed border-gray-700 p-8 text-center",children:[e.jsx("p",{className:"text-gray-300 font-medium",children:"No pools configured yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Use the Add Pool button to connect your preferred provider."}),e.jsx(d,{onClick:Z,className:"mt-4",children:"Add Pool"})]}):e.jsx("div",{className:"grid gap-4 lg:grid-cols-2",children:X.map(s=>{const a=xe.get(s.id),w=Me(a==null?void 0:a.health_score);return e.jsxs("div",{className:"rounded-xl border border-gray-800 bg-gray-950/60 p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-semibold",children:s.name}),e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${s.enabled?"bg-green-500/10 text-green-300":"bg-gray-600/20 text-gray-400"}`,children:s.enabled?"Enabled":"Disabled"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.url,":",s.port]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Worker: ",s.user]})]}),e.jsx("div",{className:`text-sm font-medium ${w.className}`,children:w.label})]}),e.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Health Score"}),e.jsx("p",{className:"text-lg font-semibold",children:(a==null?void 0:a.health_score)??"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Response"}),e.jsx("p",{className:"text-lg font-semibold",children:q(a==null?void 0:a.response_time_ms,"ms")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Reject Rate"}),e.jsx("p",{className:"text-lg font-semibold",children:q(a==null?void 0:a.reject_rate,"%")})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"h-3.5 w-3.5"}),"Active miners: ",(a==null?void 0:a.active_miners)??0]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3.5 w-3.5"}),a!=null&&a.last_checked?new Date(a.last_checked).toLocaleTimeString():"No checks yet"]}),(a==null?void 0:a.error_message)&&e.jsxs("div",{className:"flex items-center gap-1 text-red-300",children:[e.jsx(Ee,{className:"h-3.5 w-3.5"}),a.error_message]})]}),e.jsxs("div",{className:"mt-5 flex flex-wrap gap-3",children:[e.jsxs(d,{variant:"secondary",size:"sm",className:"flex items-center gap-2",onClick:()=>ue(s),children:[e.jsx(Te,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(d,{variant:"destructive",size:"sm",className:"flex items-center gap-2",onClick:()=>he(s),disabled:_.isPending&&(o==null?void 0:o.id)===s.id,children:[e.jsx(De,{className:"h-4 w-4"}),"Delete"]})]})]},s.id)})})})]}),e.jsxs(P,{children:[e.jsxs(ae,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Braiins Pool Integration"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Provide the API token to surface Braiins payouts and worker stats inside HMM."})]}),e.jsxs(d,{variant:"ghost",onClick:()=>g(!0),className:"flex items-center gap-2 text-blue-300",children:[e.jsx(z,{className:"h-4 w-4"}),"How it works"]})]}),e.jsxs(C,{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{id:"braiins-enabled",checked:S,onCheckedChange:s=>A(!!s)}),e.jsx(j,{htmlFor:"braiins-enabled",children:"Enable Braiins Pool telemetry"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"braiins-token",children:"API Token"}),e.jsx("input",{id:"braiins-token",type:"password",value:D,onChange:s=>M(s.target.value),disabled:!S,placeholder:"Access token from pool.braiins.com → Access Management",className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40 disabled:opacity-60"}),e.jsx("p",{className:"text-xs text-gray-500",children:"We store tokens locally under /config and never send them outside your network."})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-200",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{children:c})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(d,{onClick:ye,disabled:F.isPending,children:F.isPending?"Saving…":"Save Settings"}),e.jsx(d,{variant:"ghost",onClick:()=>ce(),disabled:F.isPending,children:"Reload"})]})]})]}),e.jsx(Ae,{open:f,mode:l,pool:I,isSubmitting:me,onOpenChange:s=>{u(s),s||(x(null),t("add"))},onSubmit:pe}),e.jsx(L,{open:k,onOpenChange:b,children:e.jsxs(R,{children:[e.jsxs(K,{children:[e.jsx(Q,{className:"text-lg font-semibold",children:"Delete pool"}),e.jsx($,{children:"This action removes the pool from every miner and automation rule. You can re-add it later using the approved presets."})]}),e.jsx("p",{className:"text-sm text-gray-300",children:o?`${o.name} (${o.url}:${o.port})`:""}),N&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-300",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:N})]}),e.jsxs(W,{className:"gap-3",children:[e.jsx(d,{variant:"secondary",onClick:()=>b(!1),children:"Cancel"}),e.jsx(d,{variant:"destructive",onClick:ge,disabled:_.isPending,children:_.isPending?"Deleting…":"Delete Pool"})]})]})}),e.jsx(L,{open:h,onOpenChange:g,children:e.jsxs(R,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Braiins Pool API Help"}),e.jsx($,{children:"Follow these steps to generate your token."})]}),e.jsxs("ol",{className:"list-decimal space-y-2 pl-6 text-sm text-gray-200",children:[e.jsx("li",{children:"Visit pool.braiins.com and sign in."}),e.jsx("li",{children:"Navigate to Settings → Access Management."}),e.jsx("li",{children:"Create a new Access Profile with read scope."}),e.jsx("li",{children:"Copy the generated API token and paste it here."})]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tokens stay inside your HMM instance under /config/config.yaml so you remain in full control."}),e.jsx(W,{children:e.jsx(d,{variant:"secondary",onClick:()=>g(!1),children:"Close"})})]})})]})}export{He as default};
