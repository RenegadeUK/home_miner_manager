import{c as Q,b as O,u as z,k as U,r as $,a as c,j as e,C as x,f as m,A as q,B as u,R as W,d as v,S as Z,l as G,m as J,L as k,n as X,o as Y,p as ee,q as ae,s as se,t as C,N as te,P as re}from"./index-BDHxGOPF.js";import{u as b}from"./useMutation-B23Z8kbb.js";import{T as le}from"./trash-2-DadHp0ph.js";import{C as ie}from"./clock-DFQqy2ko.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=Q("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);function me(){var M;const{minerId:r}=O(),N=z(),d=U(),[h,E]=$.useState(""),[f,R]=$.useState(null),[j,A]=$.useState(!0),{data:p}=c({queryKey:["miners"],queryFn:async()=>{const s=await fetch("/api/dashboard/all?dashboard_type=all");if(!s.ok)throw new Error("Failed to fetch miners");return s.json()}}),i=p==null?void 0:p.miners.find(s=>s.id===parseInt(r||"0")),{data:n}=c({queryKey:["minerDetails",r],queryFn:async()=>{const s=await fetch(`/api/miners/${r}`);if(!s.ok)throw new Error("Failed to fetch miner details");return s.json()},enabled:!!r}),{data:a,isLoading:T,error:L}=c({queryKey:["telemetry",r],queryFn:async()=>{const s=await fetch(`/api/miners/${r}/telemetry`);if(!s.ok)throw new Error("Failed to fetch telemetry");return s.json()},refetchInterval:j?5e3:!1,enabled:!!r}),{data:w}=c({queryKey:["modes",r],queryFn:async()=>{const s=await fetch(`/api/miners/${r}/modes`);if(!s.ok)throw new Error("Failed to fetch modes");return s.json()},enabled:!!r}),{data:K=[]}=c({queryKey:["pools"],queryFn:async()=>{const s=await fetch("/api/pools/");if(!s.ok)throw new Error("Failed to fetch pools");return s.json()}});c({queryKey:["devicePools",r],queryFn:async()=>{const s=await fetch(`/api/miners/${r}/device-pools`);return s.ok?s.json():[]},enabled:!!r});const g=b({mutationFn:async s=>{const l=await fetch(`/api/miners/${r}/mode?mode=${s}`,{method:"POST"});if(!l.ok)throw new Error("Failed to set mode");return l.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["telemetry",r]}),d.invalidateQueries({queryKey:["miners"]})}}),y=b({mutationFn:async s=>{const l=await fetch(`/api/miners/${r}/pool?pool_id=${s}`,{method:"POST"});if(!l.ok)throw new Error("Failed to switch pool");return l.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["telemetry",r]}),d.invalidateQueries({queryKey:["devicePools",r]})}}),_=b({mutationFn:async()=>{const s=await fetch(`/api/miners/${r}/restart`,{method:"POST"});if(!s.ok)throw new Error("Failed to restart miner");return s.json()}}),P=b({mutationFn:async()=>{const s=await fetch(`/api/miners/${r}`,{method:"DELETE"});if(!s.ok)throw new Error("Failed to delete miner");return s.json()},onSuccess:()=>{N("/miners")}}),B=()=>{h&&g.mutate(h)},D=()=>{f!==null&&y.mutate(f)},I=()=>{confirm("Are you sure you want to restart this miner?")&&_.mutate()},V=()=>{confirm(`Are you sure you want to delete ${i==null?void 0:i.name}? This cannot be undone.`)&&P.mutate()},H=s=>{const l=Math.floor(s/86400),S=Math.floor(s%86400/3600),F=Math.floor(s%3600/60);return l>0?`${l}d ${S}h ${F}m`:S>0?`${S}h ${F}m`:`${F}m`},o=(s,l=2)=>s==null?"â€”":s>=1e9?`${(s/1e9).toFixed(2)}B`:s>=1e6?`${(s/1e6).toFixed(2)}M`:s>=1e3?`${(s/1e3).toFixed(2)}K`:s.toFixed(l);return p?i?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:i.name}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:i.miner_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>A(!j),className:"gap-2",children:[e.jsx(W,{className:`h-4 w-4 ${j?"animate-spin":""}`}),j?"Auto":"Manual"]}),e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:`/miners/${r}/edit`,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Edit"]})}),e.jsxs(u,{variant:"destructive",size:"sm",onClick:V,disabled:P.isPending,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(x,{children:[e.jsxs(v,{className:"flex flex-row items-center gap-3 pb-3",children:[e.jsx(Z,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"font-semibold",children:"Configuration"})]}),e.jsxs(m,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Status"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${i.enabled?"bg-green-500/10 text-green-400 border border-green-500/20":"bg-gray-500/10 text-gray-400 border border-gray-500/20"}`,children:i.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Type"}),e.jsx("span",{className:"text-sm font-medium",children:i.miner_type})]}),(n==null?void 0:n.ip_address)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"IP Address"}),e.jsx("span",{className:"text-sm font-medium",children:n.ip_address})]}),(n==null?void 0:n.ip_address)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"URL"}),e.jsx("a",{href:`http://${n.ip_address}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-400 hover:text-blue-300 hover:underline",children:"Open Device"})]}),((M=a==null?void 0:a.extra_data)==null?void 0:M.current_mode)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Current Mode"}),e.jsx("span",{className:"text-sm font-medium",children:a.extra_data.current_mode})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Current Pool"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[150px]",children:(a==null?void 0:a.pool_in_use)||"â€”"})]})]})]}),e.jsxs(x,{className:"lg:col-span-2",children:[e.jsxs(v,{className:"flex flex-row items-center gap-3 pb-3",children:[e.jsx(G,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"font-semibold",children:"Live Telemetry"}),a&&e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[e.jsx(ie,{className:"h-3 w-3 inline mr-1"}),new Date(a.timestamp).toLocaleTimeString()]})]}),e.jsxs(m,{children:[T&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading telemetry..."}),L&&e.jsxs("div",{className:"flex items-center gap-3 text-red-400 p-4 bg-red-500/10 rounded-lg border border-red-500/20",children:[e.jsx(q,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:"Failed to load telemetry data"})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx(t,{label:"Hashrate",value:`${a.hashrate.toFixed(2)} ${a.hashrate_unit}`}),e.jsx(t,{label:"Temperature",value:`${a.temperature.toFixed(1)}Â°C`}),e.jsx(t,{label:"Power",value:`${a.power_watts.toFixed(1)} W`}),e.jsx(t,{label:"Accepted",value:a.shares_accepted.toString()}),e.jsx(t,{label:"Rejected",value:a.shares_rejected.toString()}),a.extra_data.uptime&&e.jsx(t,{label:"Uptime",value:H(a.extra_data.uptime)})]})]})]})]}),a&&e.jsxs(x,{children:[e.jsx(v,{children:e.jsx("h3",{className:"font-semibold",children:"Extended Stats"})}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[a.extra_data.frequency&&e.jsx(t,{label:"Frequency",value:`${a.extra_data.frequency} MHz`}),a.extra_data.voltage&&e.jsx(t,{label:"Voltage",value:`${(a.extra_data.voltage/1e3).toFixed(2)} V`}),a.extra_data.best_diff&&e.jsx(t,{label:"Best Diff",value:o(a.extra_data.best_diff)}),a.extra_data.best_session_diff&&e.jsx(t,{label:"Best Session",value:o(a.extra_data.best_session_diff)}),a.extra_data.difficulty&&e.jsx(t,{label:"Pool Difficulty",value:o(a.extra_data.difficulty)}),a.extra_data.network_difficulty&&e.jsx(t,{label:"Network Diff",value:o(a.extra_data.network_difficulty)}),a.extra_data.response_time!==void 0&&e.jsx(t,{label:"Pool Response",value:`${a.extra_data.response_time.toFixed(0)} ms`}),a.extra_data.error_percentage!==void 0&&e.jsx(t,{label:"Error Rate",value:`${a.extra_data.error_percentage.toFixed(2)}%`}),a.extra_data.wifi_rssi&&e.jsx(t,{label:"WiFi Signal",value:a.extra_data.wifi_rssi}),a.extra_data.version&&e.jsx(t,{label:"Firmware",value:a.extra_data.version}),a.extra_data.found_blocks!==void 0&&e.jsx(t,{label:"Found Blocks ðŸŽ‰",value:a.extra_data.found_blocks.toString()}),a.extra_data.hw_errors!==void 0&&e.jsx(t,{label:"HW Errors",value:a.extra_data.hw_errors.toString()}),a.extra_data.core_voltage&&e.jsx(t,{label:"Core Voltage",value:`${a.extra_data.core_voltage} mV`}),a.extra_data.core_voltage_actual&&e.jsx(t,{label:"Core V Actual",value:`${a.extra_data.core_voltage_actual} mV`}),a.extra_data.vr_temp!==void 0&&e.jsx(t,{label:"VR Temp",value:`${a.extra_data.vr_temp}Â°C`}),a.extra_data.small_core_count&&e.jsx(t,{label:"Small Cores",value:a.extra_data.small_core_count.toString()}),a.extra_data.asic_model&&e.jsx(t,{label:"ASIC Model",value:a.extra_data.asic_model}),a.extra_data.block_height&&e.jsx(t,{label:"Block Height",value:o(a.extra_data.block_height,0)}),a.extra_data.stratum_suggested_difficulty&&e.jsx(t,{label:"Stratum Diff",value:o(a.extra_data.stratum_suggested_difficulty)}),a.extra_data.free_heap&&e.jsx(t,{label:"Free Heap",value:`${(a.extra_data.free_heap/1024/1024).toFixed(1)} MB`}),a.extra_data.fan_rpm!==null&&a.extra_data.fan_rpm!==void 0&&e.jsx(t,{label:"Fan RPM",value:a.extra_data.fan_rpm.toString()})]})})]}),e.jsxs(x,{children:[e.jsxs(v,{className:"flex flex-row items-center gap-3 pb-3",children:[e.jsx(J,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"font-semibold",children:"Controls"})]}),e.jsxs(m,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{children:"Operating Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{value:h,onValueChange:E,children:[e.jsx(Y,{className:"flex-1",children:e.jsx(ee,{placeholder:"Select mode..."})}),e.jsx(ae,{children:w==null?void 0:w.modes.map(s=>e.jsx(se,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsx(u,{onClick:B,disabled:!h||g.isPending,children:g.isPending?"Applying...":"Apply Mode"})]}),g.isSuccess&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx(C,{className:"h-4 w-4"}),"Mode updated successfully"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{children:"Pool Selection"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:K.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border border-gray-700 hover:bg-gray-800/50 cursor-pointer transition-colors",children:[e.jsx("input",{type:"radio",name:"pool",value:s.id,checked:f===s.id,onChange:()=>R(s.id),className:"text-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-400 truncate",children:[s.url,":",s.port]})]})]},s.id))}),e.jsxs(u,{onClick:D,disabled:f===null||y.isPending,className:"w-full",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),y.isPending?"Switching...":"Switch Pool"]}),y.isSuccess&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx(C,{className:"h-4 w-4"}),"Pool switched successfully"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{children:"Device Control"}),e.jsxs(u,{onClick:I,disabled:_.isPending,variant:"outline",className:"w-full gap-2 text-orange-400 hover:text-orange-300 border-orange-500/20",children:[e.jsx(re,{className:"h-4 w-4"}),_.isPending?"Restarting...":"Restart Miner"]}),_.isSuccess&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx(C,{className:"h-4 w-4"}),"Restart command sent"]})]})]})]})]}):e.jsx("div",{className:"p-6",children:e.jsx(x,{className:"border-red-500/20 bg-red-500/5",children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-400",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("p",{children:"Miner not found"})]})})})}):e.jsx("div",{className:"p-6",children:e.jsx(x,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-gray-400 border-t-transparent rounded-full"}),e.jsx("p",{children:"Loading..."})]})})})})}function t({label:r,value:N,className:d=""}){return e.jsxs("div",{className:`bg-gray-800/50 rounded-lg p-3 border border-gray-700/50 ${d}`,children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide mb-1",children:r}),e.jsx("div",{className:"font-semibold text-sm truncate",children:N})]})}export{me as default};
