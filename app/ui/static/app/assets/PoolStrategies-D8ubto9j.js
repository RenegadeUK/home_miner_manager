import{c as I,k as L,r as o,a as R,j as e,B as d,Y as p,C as x,f as h,d as w,w as F,x as z,y as B,z as O,E as q,Z as G}from"./index-BGy3dVUV.js";import{u as v}from"./useMutation-D798RsZJ.js";import{A as S}from"./alert-triangle-BQY07VbV.js";import{L as f}from"./loader-2-CxE49JNx.js";import{C as H}from"./check-circle-2-B3sNNmii.js";import{P as Q}from"./play-circle-O5JP-HYD.js";import{I as _}from"./info-D5UyM7L5.js";import{T as K}from"./trash-2-C_6GmbKT.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=I("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),U={round_robin:{label:"Round Robin",tone:"bg-sky-500/10 text-sky-300 border-sky-500/30",description:"Rotates miners through pools at fixed intervals"},load_balance:{label:"Load Balance",tone:"bg-purple-500/10 text-purple-300 border-purple-500/30",description:"Distributes miners based on pool health and latency"},pro_mode:{label:"Pro Mode",tone:"bg-amber-500/10 text-amber-300 border-amber-500/30",description:"Switches pools based on Agile pricing bands"}},C={active:"bg-emerald-500/15 text-emerald-300 border-emerald-500/30",inactive:"bg-slate-700/40 text-slate-300 border-slate-600/60"},E=[{title:"Round Robin",accent:"text-sky-300",icon:e.jsx(p,{className:"h-4 w-4"}),body:["Rotates all enrolled miners through the selected pools on a timer.","Ideal for sharing hashrate between multiple solo pools to reduce variance.","Keeps the fleet together so every miner hits the same pool simultaneously."],tip:"Set the interval to align with pool payout cadence (e.g., every 60 minutes)."},{title:"Load Balance",accent:"text-purple-300",icon:e.jsx(G,{className:"h-4 w-4"}),body:["Scores pools based on health, latency, and reject rate to keep miners on the best performers.","Distributes miners proportionally so the healthiest pools receive more hashrate.","Great for minimizing downtime and keeping Avalon + Bitaxe rigs productive."],tip:"Increase the minimum health threshold if you only want near-perfect pools considered."},{title:"Pro Mode",accent:"text-amber-300",icon:e.jsx(_,{className:"h-4 w-4"}),body:["Pairs with Energy Optimization to switch between “cheap” and “expensive” pools.","Requires Agile pricing to be enabled and configured.","Perfect for separating efficient pools from higher-paying high-risk pools."],tip:"Use aggressive dwell hours so miners are not flapping during brief price spikes."}];function Y(a){if(!a)return"Never";const r=new Date(a);return Number.isNaN(r.getTime())?a:`${r.toLocaleDateString()} · ${r.toLocaleTimeString()}`}function Z(a){var r,c,l;return a.strategy_type==="round_robin"?`${((r=a.config)==null?void 0:r.interval_minutes)||60} min interval`:a.strategy_type==="load_balance"?`Min health ${((c=a.config)==null?void 0:c.min_health_threshold)??50}`:a.strategy_type==="pro_mode"?`Threshold ${((l=a.config)==null?void 0:l.price_threshold)??15} p/kWh`:"Custom strategy"}async function W(){const a=await fetch("/api/pools/strategies");if(!a.ok){const r=await a.json().catch(()=>({}));throw new Error(r.detail||"Failed to load strategies")}return a.json()}function ne(){const a=L(),[r,c]=o.useState(!1),[l,n]=o.useState(null),[j,b]=o.useState(null),{data:m=[],isLoading:T,error:u}=R({queryKey:["pool-strategies"],queryFn:W,refetchInterval:6e4}),[N,y]=o.useState(null),A=v({mutationFn:async s=>{const t=await fetch(`/api/pools/strategies/${s}/execute`,{method:"POST"});if(!t.ok){const i=await t.json().catch(()=>({}));throw new Error(i.detail||"Failed to execute strategy")}return t.json()},onMutate:s=>y(s),onSuccess:()=>{n({type:"success",message:"Strategy execution triggered"}),a.invalidateQueries({queryKey:["pool-strategies"]})},onError:s=>{n({type:"error",message:s.message})},onSettled:()=>y(null)}),M=v({mutationFn:async s=>{const t=await fetch(`/api/pools/strategies/${s}`,{method:"DELETE"});if(!t.ok){const i=await t.json().catch(()=>({}));throw new Error(i.detail||"Failed to delete strategy")}return t.json()},onMutate:s=>b(s),onSuccess:()=>{n({type:"success",message:"Strategy deleted"}),a.invalidateQueries({queryKey:["pool-strategies"]})},onError:s=>n({type:"error",message:s.message}),onSettled:()=>b(null)}),g=o.useMemo(()=>{const s=m.length,t=m.filter($=>$.enabled).length,i=s-t;return{total:s,active:t,inactive:i}},[m]),D=s=>{s.enabled&&window.confirm(`Execute "${s.name}" now? Miners will switch immediately.`)&&A.mutate(s.id)},P=s=>{window.confirm(`Delete "${s.name}"? This cannot be undone.`)&&M.mutate(s.id)};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-blue-300",children:"Miner Management"}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Pool Strategies"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Automate pool switching with round robin, load balancing, or price-aware flows."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(d,{variant:"outline",className:"gap-2",onClick:()=>c(!0),children:[e.jsx(k,{className:"h-4 w-4"})," Strategy Guide"]}),e.jsx(d,{asChild:!0,className:"gap-2",children:e.jsxs("a",{href:"/pools/strategies/add",children:[e.jsx(p,{className:"h-4 w-4"})," Add Strategy"]})})]})]}),l&&e.jsx("div",{className:`rounded-md border px-4 py-3 text-sm ${l.type==="success"?"border-emerald-500/40 bg-emerald-500/10 text-emerald-100":"border-red-500/40 bg-red-500/10 text-red-100"}`,children:l.message}),u&&e.jsxs("div",{className:"flex items-center gap-3 rounded-md border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{children:u instanceof Error?u.message:"Unable to load strategies"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Total Strategies"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold",children:g.total})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Active"}),e.jsxs("div",{className:"mt-2 flex items-baseline gap-2",children:[e.jsx("p",{className:"text-3xl font-semibold text-emerald-300",children:g.active}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"running"})]})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Paused"}),e.jsxs("div",{className:"mt-2 flex items-baseline gap-2",children:[e.jsx("p",{className:"text-3xl font-semibold text-amber-300",children:g.inactive}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"waiting"})]})]})})]}),e.jsxs(x,{children:[e.jsx(w,{children:e.jsx("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Strategies"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor automation flows and trigger manual runs when needed."})]})})}),e.jsx(h,{children:T?e.jsx("div",{className:"flex min-h-[240px] items-center justify-center text-muted-foreground",children:e.jsx(f,{className:"h-5 w-5 animate-spin"})}):m.length===0?e.jsxs("div",{className:"rounded-lg border border-dashed border-border bg-background p-10 text-center",children:[e.jsx(p,{className:"mx-auto mb-4 h-10 w-10 text-muted-foreground"}),e.jsx("p",{className:"text-lg font-medium",children:"No pool strategies yet"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Combine multiple pools with automation logic to keep miners productive."}),e.jsx(d,{className:"mt-4",asChild:!0,children:e.jsx("a",{href:"/pools/strategies/add",children:"Add Your First Strategy"})})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/40 text-left text-xs uppercase tracking-wide text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Strategy"}),e.jsx("th",{className:"px-4 py-3",children:"Type"}),e.jsx("th",{className:"px-4 py-3",children:"Pools / Miners"}),e.jsx("th",{className:"px-4 py-3",children:"Last Switch"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:m.map(s=>{const t=U[s.strategy_type]||{label:s.strategy_type,tone:"bg-slate-700/40 text-slate-200 border-slate-600/50"},i=s.enabled?C.active:C.inactive;return e.jsxs("tr",{className:"border-b border-border/60",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"font-semibold text-foreground",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Z(s)})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs font-medium ${t.tone}`,children:t.label})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm text-foreground",children:[s.pool_ids.length," pools"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.miner_ids.length>0?`${s.miner_ids.length} miners`:"Applies to all miners"})]}),e.jsx("td",{className:"px-4 py-4 text-sm text-muted-foreground",children:Y(s.last_switch)}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs font-semibold ${i}`,children:s.enabled?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-3.5 w-3.5"})," Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-3.5 w-3.5"})," Paused"]})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(d,{variant:"secondary",size:"sm",className:"gap-1",disabled:!s.enabled||N===s.id,onClick:()=>D(s),children:[N===s.id?e.jsx(f,{className:"h-4 w-4 animate-spin"}):e.jsx(Q,{className:"h-4 w-4"}),"Run"]}),e.jsx(d,{variant:"outline",size:"sm",className:"gap-1",asChild:!0,children:e.jsxs("a",{href:`/pools/strategies/${s.id}/edit`,children:[e.jsx(_,{className:"h-4 w-4"})," Edit"]})}),e.jsxs(d,{variant:"destructive",size:"sm",className:"gap-1",disabled:j===s.id,onClick:()=>P(s),children:[j===s.id?e.jsx(f,{className:"h-4 w-4 animate-spin"}):e.jsx(K,{className:"h-4 w-4"}),"Delete"]})]})})]},s.id)})})]})})})]}),e.jsxs(x,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5 text-blue-300"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Strategy Primer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Quick comparisons to decide which automation fits your fleet."})]})]})}),e.jsx(h,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:E.map(s=>e.jsxs("div",{className:"rounded-xl border border-border/80 bg-muted/10 p-4",children:[e.jsxs("div",{className:`flex items-center gap-2 text-sm font-semibold ${s.accent}`,children:[s.icon,s.title]}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm text-muted-foreground",children:s.body.map(t=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-1 h-1.5 w-1.5 rounded-full bg-muted-foreground/60"}),e.jsx("span",{children:t})]},t))}),e.jsxs("div",{className:"mt-3 rounded-md border border-dashed border-border/70 bg-background/60 p-3 text-xs text-muted-foreground",children:[e.jsx("strong",{className:"font-semibold text-foreground",children:"Tip:"})," ",s.tip]})]},s.title))})})]}),e.jsx(F,{open:r,onOpenChange:c,children:e.jsxs(z,{className:"max-h-[80vh] overflow-y-auto",children:[e.jsxs(B,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"})," Pool Strategy Guide"]}),e.jsx(q,{children:"Deep dive into how each automation mode behaves and when to use it."})]}),e.jsx("div",{className:"space-y-6 text-sm text-muted-foreground",children:E.map(s=>e.jsx(o.Fragment,{children:e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[s.icon,s.title]}),e.jsx("ul",{className:"mt-2 space-y-2",children:s.body.map(t=>e.jsx("li",{className:"leading-relaxed",children:t},t))}),e.jsxs("div",{className:"mt-3 rounded-md border border-info/30 bg-info/5 p-3 text-sm text-foreground",children:[e.jsx("strong",{children:"Pro tip:"})," ",s.tip]})]})},s.title))})]})})]})}export{ne as default};
