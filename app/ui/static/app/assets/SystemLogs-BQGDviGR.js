import{l as B,r as o,a as I,j as e,ac as D,C as q,d as Q,e as U,B as g,U as u,f as K,ad as E,A as k,_ as O}from"./index-Cw5JvtJ_.js";import{u as W}from"./useMutation-CE1HzA7S.js";import{h as H}from"./textFormatters-NadoA3a2.js";import{L as S}from"./loader-2-DPIbUHXL.js";import{R as G}from"./refresh-ccw-CwT3vXUH.js";import{T as J}from"./trash-2-BHPXMfGz.js";import{C as V}from"./check-circle-2-zqZpQSvT.js";const y=200,X=[{label:"All",value:"all"},{label:"Info",value:"info"},{label:"Success",value:"success"},{label:"Warning",value:"warning"},{label:"Error",value:"error"}];function ue(){const t=B(),[s,l]=o.useState("all"),[n,c]=o.useState(1),[m,R]=o.useState(!0),[x,N]=o.useState(null),a=I({queryKey:["system-logs"],queryFn:()=>E.getEvents(1e3).then(r=>r.events),refetchInterval:m?3e4:!1}),d=o.useMemo(()=>a.data??[],[a.data]);o.useEffect(()=>{c(1)},[s,d.length]),o.useEffect(()=>{if(!x)return;const r=window.setTimeout(()=>N(null),4e3);return()=>window.clearTimeout(r)},[x]);const w=(r,i)=>{N({tone:r,message:i})},C=o.useMemo(()=>{const r={all:d.length,info:0,success:0,warning:0,error:0};return d.forEach(i=>{const p=v(i.event_type);r[p]+=1}),r},[d]),h=o.useMemo(()=>s==="all"?d:d.filter(r=>v(r.event_type)===s),[d,s]),b=Math.max(1,Math.ceil(h.length/y)),f=o.useMemo(()=>{const r=(n-1)*y;return h.slice(r,r+y)},[h,n]),M=()=>t.invalidateQueries({queryKey:["system-logs"]}),j=W({mutationFn:E.clearEvents,onSuccess:()=>{M(),c(1),w("success","All events cleared")},onError:()=>w("error","Failed to clear events")}),P=()=>{d.length!==0&&window.confirm("Clear all system events? This cannot be undone.")&&j.mutate()},_=r=>{c(i=>{const p=i+r;return p<1||p>b?i:p})},z=a.dataUpdatedAt?new Date(a.dataUpdatedAt).toLocaleTimeString():"—";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(D,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"System Logs"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Inspect miner activity, automation outcomes, and integration events without leaving the new dashboard."})]}),e.jsxs(q,{className:"border-border/60 bg-muted/5",children:[e.jsxs(Q,{className:"space-y-4",children:[x&&e.jsx(te,{tone:x.tone,message:x.message}),e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx(U,{className:"text-lg",children:"Recent Events"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(ne,{checked:m,onCheckedChange:R}),e.jsxs(g,{variant:"secondary",size:"sm",onClick:()=>void a.refetch(),disabled:a.isFetching,children:[a.isFetching?e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(G,{className:"mr-2 h-4 w-4"}),"Refresh"]}),e.jsxs(g,{variant:"destructive",size:"sm",onClick:P,disabled:d.length===0||j.isPending,children:[j.isPending?e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(J,{className:"mr-2 h-4 w-4"}),"Clear all"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm text-muted-foreground sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("span",{children:["Showing ",f.length," of ",h.length," events · Last updated ",z]}),e.jsx("span",{children:"Auto-refresh every 30s when enabled"})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-3 lg:grid-cols-5",children:X.map(r=>{const i=r.value!=="all"&&C[r.value]===0;return e.jsxs("button",{type:"button",onClick:()=>l(r.value),className:u("rounded-xl border border-border/60 bg-background/60 px-4 py-3 text-left transition",s===r.value&&"border-blue-500/80 bg-blue-500/10 shadow-inner",i&&"opacity-60"),children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:r.label}),e.jsx("div",{className:"text-2xl font-semibold text-foreground",children:C[r.value]})]},r.value)})})]}),e.jsxs(K,{className:"space-y-6",children:[a.isLoading&&e.jsx(ee,{}),a.isError&&e.jsx(re,{onRetry:()=>void a.refetch(),message:"Failed to load events."}),!a.isLoading&&!a.isError&&f.length===0&&e.jsx(se,{}),!a.isLoading&&!a.isError&&f.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(Y,{events:f})}),e.jsx("div",{className:"space-y-3 lg:hidden",children:f.map(r=>e.jsx(Z,{event:r},r.id))})]}),b>1&&e.jsx($,{currentPage:n,totalPages:b,totalEvents:h.length,onPageChange:_})]})]})]})}function v(t){const s=(t||"").toLowerCase();return s.includes("error")?"error":s.includes("warning")?"warning":s.includes("success")?"success":"info"}function T(t){var n;const s=t.data??{},l=["miner_name","miner","target","source"];for(const c of l){const m=s[c];if(typeof m=="string"&&m.trim())return m.trim()}return(n=t.source)!=null&&n.startsWith("miner:")?t.source.split(":")[1]||"Miner":t.source||"System"}function A(t){const s=new Date(t);return Number.isNaN(s.getTime())?t:s.toLocaleString()}function Y({events:t}){return e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border/60",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/10 text-xs uppercase tracking-wide text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Source"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Event"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Details"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-t border-border/50",children:[e.jsx("td",{className:"px-4 py-3 align-top text-muted-foreground",children:A(s.timestamp)}),e.jsx("td",{className:"px-4 py-3 align-top text-foreground",children:T(s)}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsx(L,{eventType:s.event_type})}),e.jsxs("td",{className:"px-4 py-3 align-top text-sm text-muted-foreground",children:[e.jsx("p",{className:"whitespace-pre-line text-foreground",children:s.message}),e.jsx(F,{data:s.data})]})]},s.id))})]})})}function Z({event:t}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-background/60 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:T(t)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:A(t.timestamp)})]}),e.jsx(L,{eventType:t.event_type})]}),e.jsx("p",{className:"mt-3 text-sm text-foreground",children:t.message}),e.jsx(F,{data:t.data})]})}function L({eventType:t}){const s=v(t),l=s==="error"?"bg-red-500/20 text-red-200":s==="warning"?"bg-amber-500/20 text-amber-200":s==="success"?"bg-emerald-500/20 text-emerald-200":"bg-blue-500/20 text-blue-200",n=H(t||s);return e.jsx("span",{className:u("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold capitalize",l),children:n})}function $({currentPage:t,totalPages:s,totalEvents:l,onPageChange:n}){return e.jsxs("div",{className:"flex flex-col gap-3 border-t border-border/40 pt-4 text-sm text-muted-foreground sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("span",{children:["Page ",t," of ",s," · ",l," event",l===1?"":"s"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>n(-1),disabled:t===1,children:"Previous"}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>n(1),disabled:t===s,children:"Next"})]})]})}function ee(){return e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((t,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted/20"},s))})}function se(){return e.jsxs("div",{className:"rounded-2xl border border-dashed border-border/60 bg-background/40 p-6 text-center",children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:"No events yet"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"When miners change pools, automations fire, or integrations respond, entries will appear here."})]})}function te({tone:t,message:s}){const l=t==="success"?"border-emerald-500/40 bg-emerald-500/10 text-emerald-100":"border-red-500/40 bg-red-500/10 text-red-100",n=t==="success"?V:k;return e.jsxs("div",{className:u("flex items-center gap-2 rounded-2xl border px-4 py-2 text-sm",l),children:[e.jsx(n,{className:"h-4 w-4"}),e.jsx("span",{children:s})]})}function F({data:t}){const[s,l]=o.useState(!1);if(!t)return null;const n=JSON.stringify(t,null,2);return e.jsxs("div",{className:"mt-3 rounded-xl border border-border/40 bg-muted/10",children:[e.jsxs("button",{type:"button",onClick:()=>l(c=>!c),className:"flex w-full items-center justify-between px-3 py-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground","aria-expanded":s,children:[e.jsx("span",{children:s?"Hide payload":"Show payload"}),e.jsx(O,{className:u("h-4 w-4 transition-transform",s&&"rotate-180")})]}),s&&e.jsx("pre",{className:"max-h-64 overflow-auto border-t border-border/40 px-3 py-2 text-xs text-muted-foreground",children:n})]})}function re({message:t,onRetry:s}){return e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-red-500/50 bg-red-500/10 px-4 py-3 text-sm text-red-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:t})]}),e.jsx(g,{variant:"secondary",size:"sm",onClick:s,children:"Retry"})]})}function ne({checked:t,onCheckedChange:s}){return e.jsxs("button",{type:"button",onClick:()=>s(!t),className:u("relative inline-flex items-center rounded-full border border-border/70 bg-gray-800 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-muted-foreground transition",t&&"border-emerald-400/70 bg-emerald-500/10 text-emerald-100"),children:[e.jsx("span",{className:u("mr-2 inline-flex h-5 w-5 items-center justify-center rounded-full border border-border/50 bg-background text-[10px] font-bold",t&&"border-emerald-400/70 text-emerald-200"),children:t?"ON":"OFF"}),"Auto-refresh"]})}export{ue as default};
